# ç®—æ³•å¿«é—ª å¿«é€Ÿå›é¡¾æ¨¡æ¿

day1

## å¿«è¯»å¿«å†™

```C++
std::ios::sync_with_stdio(false); cin.tie(0); cout.tie(0);
```

æœ€å¥½åˆ«ç”¨

## æœ€çŸ­è·¯é—®é¢˜

### dijkstraæ¨¡æ¿ | [USACO09OCT] Heat Wave G

æœ‰ä¸€ä¸ª $n$ ä¸ªç‚¹ $m$ æ¡è¾¹çš„æ— å‘å›¾ï¼Œè¯·æ±‚å‡ºä» $s$ åˆ° $t$ çš„æœ€çŸ­è·¯é•¿åº¦ã€‚

ã€æ•°æ®èŒƒå›´ã€‘
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n \le 2500$ï¼Œ$1\le m \le 6200$ï¼Œ$1\le w \le 1000$ã€‚

ã€æ ·ä¾‹è¯´æ˜ã€‘
$5 \to 6 \to 1 \to 4$ ä¸ºæœ€çŸ­è·¯ï¼Œé•¿åº¦ä¸º $3+1+3 = 7$ã€‚

---

dijkstra

é”™è¯¯å†™æ³•ï¼ˆçŠ¯é”™ è¿™é‡Œï¼ï¼‰

```C++

void djstr(int s){
	//åŸé›†åˆVï¼Œæœ€çŸ­è·¯é›†åˆS
	priority_queue<pii> pq;
	for(int i=1;i<=n;i++)dis[i]=INF;
	dis[s]=0;
	pq.push(mp(-dis[s],s));
	while(pq.size()){
		int u=pq.top().ps;
		pq.pop();
		
		for(auto [v,w]:e[u]){
			if(vis[v])continue;//å·²ç»åœ¨Sä¸­
			if(dis[v]>dis[u]+w){
				dis[v]=dis[u]+w;
                vis[v]=1;//<-here
				pq.push(mp(-dis[v],v));
			}
		}
	}
}

```

æ­£ç¡®

æˆ‘ä»¬è¦ä¿è¯ä»pqä¸­å–å‡ºçš„uä¸€å®šä¸åœ¨Sä¸­ï¼å³æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªç‚¹éƒ½æ”¾ç¼©ä¸€æ¬¡ï¼Œvisæ ‡è®°æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªç‚¹æ”¾ç¼©è¿‡ï¼è€Œä¸æ˜¯æ ‡è®°æ˜¯ä¸æ˜¯åœ¨Sä¸­ï¼

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define mp make_pair
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


// void solve(){

//     cerr<<"\nlong longrr[][]=";
//     for(int i=1;i<=n;i++)cerr<<t[i].lst<<' '<<t[i].r<<endl;
// }



const int N=5e5+5;
 const int M=5e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

int n,m,k,s,t,cnt,ans,dis[N],vis[N];
struct node{
	int v,w;
};
vector<node> e[N];

void add(int a,int b,int c){
	e[a].push_back({b,c});
	e[b].push_back({a,c});
}

void djstr(int s){
	//åŸé›†åˆVï¼Œæœ€çŸ­è·¯é›†åˆS
	priority_queue<pii> pq;
	for(int i=1;i<=n;i++)dis[i]=INF;
	dis[s]=0;
	pq.push(mp(-dis[s],s));
	while(pq.size()){
		int u=pq.top().ps;
		pq.pop();
		if(vis[u])continue;
		vis[u]=1;
		for(auto [v,w]:e[u]){
			//if(vis[v])continue;//å·²ç»åœ¨Sä¸­//ä¸è¦åˆ¤ï¼
			if(dis[v]>dis[u]+w){
				dis[v]=dis[u]+w;
				
				pq.push(mp(-dis[v],v));
			}
		}
	}
}

signed main(){
	
	n=rd,m=rd,s=rd,t=rd;
	for(int i=1;i<=m;i++){
		int a=rd,b=rd,c=rd;
		add(a,b,c);
	}

	djstr(s);

	cout<<dis[t]<<endl;
	return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### Floyd | [NOIP2012 æ™®åŠç»„] æ–‡åŒ–ä¹‹æ—…

æœ‰ä¸€ä½ä½¿è€…è¦æ¸¸å†å„å›½ï¼Œä»–æ¯åˆ°ä¸€ä¸ªå›½å®¶ï¼Œéƒ½èƒ½å­¦åˆ°ä¸€ç§æ–‡åŒ–ï¼Œä½†ä»–ä¸æ„¿æ„å­¦ä¹ ä»»ä½•ä¸€ç§æ–‡åŒ–è¶…è¿‡ä¸€æ¬¡ï¼ˆå³å¦‚æœä»–å­¦ä¹ äº†æŸç§æ–‡åŒ–ï¼Œåˆ™ä»–å°±ä¸èƒ½åˆ°è¾¾å…¶ä»–æœ‰è¿™ç§æ–‡åŒ–çš„å›½å®¶ï¼‰ã€‚ä¸åŒçš„å›½å®¶å¯èƒ½æœ‰ç›¸åŒçš„æ–‡åŒ–ã€‚ä¸åŒæ–‡åŒ–çš„å›½å®¶å¯¹å…¶ä»–æ–‡åŒ–çš„çœ‹æ³•ä¸åŒï¼Œæœ‰äº›æ–‡åŒ–ä¼šæ’æ–¥å¤–æ¥æ–‡åŒ–ï¼ˆå³å¦‚æœä»–å­¦ä¹ äº†æŸç§æ–‡åŒ–ï¼Œåˆ™ä»–ä¸èƒ½åˆ°è¾¾æ’æ–¥è¿™ç§æ–‡åŒ–çš„å…¶ä»–å›½å®¶ï¼‰ã€‚

ç°ç»™å®šå„ä¸ªå›½å®¶é—´çš„åœ°ç†å…³ç³»ï¼Œå„ä¸ªå›½å®¶çš„æ–‡åŒ–ï¼Œæ¯ç§æ–‡åŒ–å¯¹å…¶ä»–æ–‡åŒ–çš„çœ‹æ³•ï¼Œä»¥åŠè¿™ä½ä½¿è€…æ¸¸å†çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆåœ¨èµ·ç‚¹å’Œç»ˆç‚¹ä¹Ÿä¼šå­¦ä¹ å½“åœ°çš„æ–‡åŒ–ï¼‰ï¼Œå›½å®¶é—´çš„é“è·¯è·ç¦»ï¼Œè¯•æ±‚ä»èµ·ç‚¹åˆ°ç»ˆç‚¹æœ€å°‘éœ€èµ°å¤šå°‘è·¯ã€‚

å¯¹äº 100%çš„æ•°æ®ï¼Œæœ‰$ 2â‰¤Nâ‰¤100$

$1â‰¤Kâ‰¤100$

$1â‰¤Mâ‰¤N^2$

$1â‰¤k_iâ‰¤K$

$1â‰¤u, vâ‰¤N$

$1â‰¤dâ‰¤1000,Sâ‰ T,1â‰¤S,Tâ‰¤N$

NOIP 2012 æ™®åŠç»„ ç¬¬å››é¢˜

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define mp make_pair
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


// void solve(){

//     cerr<<"\nlong longrr[][]=";
//     for(int i=1;i<=n;i++)cerr<<t[i].lst<<' '<<t[i].r<<endl;
// }



const int N=2e2+5;
 const int M=5e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

int n,m,k,s,t,cnt,ans,dis[N][N],c[N],used[N][N][N],a[N][N];
struct node{
	int v,w;
};
vector<node> e[N];

void add(int u,int v,int w){

	if(!a[c[v]][c[u]]&&c[v]!=c[u])dis[u][v]=min(dis[u][v],w);
	if(!a[c[u]][c[v]]&&c[v]!=c[u])dis[v][u]=min(dis[v][u],w);//å¸¦çº¦æŸçš„è¿è¾¹
}

void flyd(){
	for(int k=1;k<=n;k++){
		for(int i=1;i<=n;i++){
			for(int j=1;j<=n;j++){
				if(dis[i][j]>dis[i][k]+dis[k][j] && !a[c[k]][c[i]] && !a[c[j]][c[k]] && !used[i][k][c[j]] && !used[k][j][c[i]]){//ç†è§£ä»¥ä¸‹æœ€åä¸¤ä¸ªçº¦æŸæ¡ä»¶ã€‚è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„
				///////////////////////////////////æ³¨æ„ä»iåˆ°kè¦çœ‹c[k]æ˜¯å¦æ’é™¤c[i]è€Œä¸æ˜¯åè¿‡æ¥ï¼
					for(int c=1;c<=n;c++)used[i][j][c]=used[i][k][c]|used[k][j][c];//ä¸èƒ½|=
					used[i][j][c[k]]=1;//used[i][j][c[k]]è¡¨ç¤ºiåˆ°jçš„è·¯å¾„ï¼ˆåŒ…å«ç«¯ç‚¹ï¼‰ä¸Šæ˜¯å¦ç»è¿‡äº†é¢œè‰²ä¸ºc[k]çš„ç‚¹
					
					dis[i][j]=dis[i][k]+dis[k][j];
				}
			}
		}
	}
}


signed main(){
	
	n=rd,k=rd,m=rd,s=rd,t=rd;

	for(int i=1;i<=n;i++){//åˆå§‹åŒ–
		for(int j=1;j<=n;j++)dis[i][j]=INF;
		dis[i][i]=0;
	}
	
	for(int i=1;i<=n;i++)c[i]=rd;
	for(int i=1;i<=k;i++){
		for(int j=1;j<=k;j++){
			a[i][j]=rd;
		}
	}
	
	for(int i=1;i<=m;i++){
		int a=rd,b=rd,c=rd;
		add(a,b,c);
	}


	for(int i=1;i<=n;i++){//åˆå§‹åŒ–çº¦æŸ
		for(int j=1;j<=n;j++)used[i][j][c[i]]=1,used[i][j][c[j]]=1;
	}

	
	
	flyd();
	if(dis[s][t]==INF)cout<<-1;
	else cout<<dis[s][t];

	
	return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

ï¼ï¼æ³¨æ„ä¸è¦æŠŠ==æ‰“æˆ= 

### SPFAåˆ†å±‚å›¾ | [NOIP2009 æé«˜ç»„] æœ€ä¼˜è´¸æ˜“

$C$ å›½æœ‰ $n$ ä¸ªå¤§åŸå¸‚å’Œ $m$ æ¡é“è·¯ï¼Œæ¯æ¡é“è·¯è¿æ¥è¿™ $n$ ä¸ªåŸå¸‚ä¸­çš„æŸä¸¤ä¸ªåŸå¸‚ã€‚ä»»æ„ä¸¤ä¸ªåŸå¸‚ä¹‹é—´æœ€å¤šåªæœ‰ä¸€æ¡é“è·¯ç›´æ¥ç›¸è¿ã€‚è¿™ $m$ æ¡é“è·¯ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸ºå•å‘é€šè¡Œçš„é“è·¯ï¼Œä¸€éƒ¨åˆ†ä¸ºåŒå‘é€šè¡Œçš„é“è·¯ï¼ŒåŒå‘é€šè¡Œçš„é“è·¯åœ¨ç»Ÿè®¡æ¡æ•°æ—¶ä¹Ÿè®¡ä¸º $1$ æ¡ã€‚

$C$ å›½å¹…å‘˜è¾½é˜”ï¼Œå„åœ°çš„èµ„æºåˆ†å¸ƒæƒ…å†µå„ä¸ç›¸åŒï¼Œè¿™å°±å¯¼è‡´äº†åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼ä¸ä¸€å®šç›¸åŒã€‚ä½†æ˜¯ï¼ŒåŒä¸€ç§å•†å“åœ¨åŒä¸€ä¸ªåŸå¸‚çš„ä¹°å…¥ä»·å’Œå–å‡ºä»·å§‹ç»ˆæ˜¯ç›¸åŒçš„ã€‚

å•†äººé˜¿é¾™æ¥åˆ° $C$ å›½æ—…æ¸¸ã€‚å½“ä»–å¾—çŸ¥åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼å¯èƒ½ä¼šä¸åŒè¿™ä¸€ä¿¡æ¯ä¹‹åï¼Œä¾¿å†³å®šåœ¨æ—…æ¸¸çš„åŒæ—¶ï¼Œåˆ©ç”¨å•†å“åœ¨ä¸åŒåŸå¸‚ä¸­çš„å·®ä»·èµšå›ä¸€ç‚¹æ—…è´¹ã€‚è®¾ $C$ å›½ $n$ ä¸ªåŸå¸‚çš„æ ‡å·ä» $1\sim n$ï¼Œé˜¿é¾™å†³å®šä» $1$ å·åŸå¸‚å‡ºå‘ï¼Œå¹¶æœ€ç»ˆåœ¨ $n$ å·åŸå¸‚ç»“æŸè‡ªå·±çš„æ—…è¡Œã€‚åœ¨æ—…æ¸¸çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•åŸå¸‚å¯ä»¥é‡å¤ç»è¿‡å¤šæ¬¡ï¼Œä½†ä¸è¦æ±‚ç»è¿‡æ‰€æœ‰ $n$ ä¸ªåŸå¸‚ã€‚é˜¿é¾™é€šè¿‡è¿™æ ·çš„è´¸æ˜“æ–¹å¼èµšå–æ—…è´¹ï¼šä»–ä¼šé€‰æ‹©ä¸€ä¸ªç»è¿‡çš„åŸå¸‚ä¹°å…¥ä»–æœ€å–œæ¬¢çš„å•†å“â€•â€•æ°´æ™¶çƒï¼Œå¹¶åœ¨ä¹‹åç»è¿‡çš„å¦ä¸€ä¸ªåŸå¸‚å–å‡ºè¿™ä¸ªæ°´æ™¶çƒï¼Œç”¨èµšå–çš„å·®ä»·å½“åšæ—…è´¹ã€‚ç”±äºé˜¿é¾™ä¸»è¦æ˜¯æ¥ $C$ å›½æ—…æ¸¸ï¼Œä»–å†³å®šè¿™ä¸ªè´¸æ˜“åªè¿›è¡Œæœ€å¤šä¸€æ¬¡ï¼Œå½“ç„¶ï¼Œåœ¨èµšä¸åˆ°å·®ä»·çš„æƒ…å†µä¸‹ä»–å°±æ— éœ€è¿›è¡Œè´¸æ˜“ã€‚

å‡è®¾ $C$ å›½æœ‰ $5$ ä¸ªå¤§åŸå¸‚ï¼ŒåŸå¸‚çš„ç¼–å·å’Œé“è·¯è¿æ¥æƒ…å†µå¦‚ä¸‹å›¾ï¼Œå•å‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºå•å‘é€šè¡Œï¼ŒåŒå‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºåŒå‘é€šè¡Œã€‚

![https://cdn.luogu.com.cn/upload/image_hosting/797buvf7.png](ç®—æ³•å¿«é—ª/797buvf7.png)

å‡è®¾ $1\sim n$ å·åŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼åˆ†åˆ«ä¸º $4,3,5,6,1$ã€‚

é˜¿é¾™å¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to2\to3\to5$ï¼Œå¹¶åœ¨ $2$ å·åŸå¸‚ä»¥ $3$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ $3$ å·åŸå¸‚ä»¥ $5$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $2$ã€‚

é˜¿é¾™ä¹Ÿå¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to4\to5\to4\to5$ï¼Œå¹¶åœ¨ç¬¬ $1$ æ¬¡åˆ°è¾¾ $5$ å·åŸå¸‚æ—¶ä»¥ $1$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ç¬¬ $2$ æ¬¡åˆ°è¾¾ $4$ å·åŸå¸‚æ—¶ä»¥ $6$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $5$ã€‚

ç°åœ¨ç»™å‡º $n$ ä¸ªåŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼ï¼Œ$m$ æ¡é“è·¯çš„ä¿¡æ¯ï¼ˆæ¯æ¡é“è·¯æ‰€è¿æ¥çš„ä¸¤ä¸ªåŸå¸‚çš„ç¼–å·ä»¥åŠè¯¥æ¡é“è·¯çš„é€šè¡Œæƒ…å†µï¼‰ã€‚è¯·ä½ å‘Šè¯‰é˜¿é¾™ï¼Œä»–æœ€å¤šèƒ½èµšå–å¤šå°‘æ—…è´¹ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 100000$ï¼Œ$1\leq m\leq 500000$ï¼Œ$1\leq  x,y\leq  n$ï¼Œ$1\leq  z\leq  2$ï¼Œ$1\leq $ å„åŸå¸‚çš„ç¼–å· $\leq  n$ã€‚

æ°´æ™¶çƒä»·æ ¼ $\leq 100$ã€‚

NOIP 2009 æé«˜ç»„ ç¬¬ä¸‰é¢˜

---

ç”±äºå¯ä»¥ä»»æ„èµ°åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ºä¸€å¼ å›¾ï¼Œä»¤å›¾ä¸Šçš„è¾¹å…¨éƒ½æ˜¯ 0 ï¼Œè¡¨ç¤ºæˆ‘çš„èµ°åŠ¨å¯¹æˆ‘æœ€ç»ˆçš„ç»“æœæ²¡æœ‰å½±å“ã€‚

è€ƒè™‘æŸä¸ªç‚¹ i ï¼Œå®ƒä¹°å…¥æˆ–è€…å–å‡ºæ°´æ™¶çƒçš„èŠ±è´¹æ˜¯ viâ€‹ ã€‚

é‚£ä¹ˆï¼š **å½“æˆ‘ä»¬è¿›è¡Œä¹°å…¥æ“ä½œ**ï¼Œæˆ‘ä»¬å°±å»ºç«‹ä¸€æ¡**æœ‰å‘è¾¹**è½¬ç§»åˆ°ä¸€å¼ æ–°å›¾ä¸Šï¼Œè¾¹çš„å¤§å°ä¸º âˆ’viâ€‹ ï¼Œå®ƒä»ç¬¬ä¸€å±‚çš„ç‚¹ i0â€‹ æŒ‡å‘ç¬¬äºŒå±‚çš„ç‚¹ i1â€‹ ã€‚è€Œè¿™å¼ æ–°å›¾å°±æ˜¯æˆ‘ä»¬çš„ç¬¬äºŒå±‚å›¾ã€‚

å®ƒè¡¨ç¤ºï¼šå‡å¦‚æˆ‘é€‰æ‹©èµ°äº†è¿™æ¡è¾¹ï¼Œå°±æ˜¯æˆ‘åœ¨è¿™ä¸ªç‚¹ä¹°äº†è¿™ä¸ªæ°´æ™¶çƒï¼Œæˆ‘ä¸ä¼šåæ‚”ï¼Œå¹¶ä¸”æˆ‘æ¥ä¸‹æ¥è€ƒè™‘åœ¨æŸä¸ªç‚¹å–å®ƒã€‚

**å½“æˆ‘ä»¬è¿›è¡Œå–å‡ºæ“ä½œ**ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€æ¡æœ‰å‘è¾¹è½¬ç§»åˆ°ç¬¬ä¸‰å±‚å›¾ä¸Šï¼Œè¾¹çš„å¤§å°ä¸º viâ€‹ï¼Œå®ƒä»ç¬¬äºŒå±‚çš„ç‚¹ i1æŒ‡å‘ç¬¬ä¸‰å±‚çš„ç‚¹ i2â€‹ ã€‚

å®ƒè¡¨ç¤ºï¼šå‡å¦‚æˆ‘é€‰æ‹©èµ°äº†è¿™æ¡è¾¹ï¼Œå°±æ˜¯æˆ‘åœ¨è¿™ä¸ªç‚¹å–äº†è¿™ä¸ªæ°´æ™¶çƒï¼Œæˆ‘ä¸ä¼šåæ‚”ï¼Œå¹¶ä¸”æˆ‘æ¥ä¸‹æ¥è€ƒè™‘èµ°å‘ç»ˆç‚¹ã€‚

> æ³¨ï¼šä¸èƒ½æŒ‡å‘ i ä¸‹ä¸€å±‚åˆ°è¾¾çš„ç‚¹ï¼Œå› ä¸ºè¿™æ ·æ„æ€å°±å˜æˆäº†ï¼šæˆ‘åœ¨è¿™ä¸ªç‚¹ä¹°å…¥äº†æ°´æ™¶çƒï¼Œ*å¹¶ä¸”æˆ‘ä¸€å®šä»è¿™ä¸ªç‚¹èµ°å‡ºå»*ã€‚å¤šäº†ä¸€å±‚æ„æ€å°±ä¸ä¸€æ ·äº†

å¯ä»¥å‘ç°ï¼Œä»ç¬¬ä¸€å±‚å›¾èµ°åˆ°ç¬¬äºŒå±‚å›¾èµ°åˆ°ç¬¬ä¸‰å±‚å›¾èµ°åˆ°ç»ˆç‚¹ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåˆæ³•çš„å†³ç­–ã€‚

å¯¹äº**ä»»ä½•**ä¸€ç§å†³ç­–éƒ½å¯ä»¥æŠ½è±¡ä¸ºæˆ‘ä» 1ç‚¹ èµ°åˆ°ç‚¹ x ä¹°å…¥ï¼Œç„¶åèµ°åˆ°ç‚¹ y å–å‡º, ç„¶åèµ°åˆ°ç‚¹ nã€‚è€Œæ¯ä¸€ç§å†³ç­–éƒ½åœ¨å›¾ä¸­å¯¹åº”äº†ä¸€æ¡ä» 10â€‹ åˆ° x0â€‹ åˆ° x1â€‹ åˆ° y1â€‹ åˆ° y2â€‹ åˆ° n2â€‹ çš„è·¯å¾„ã€‚





![https://cdn.luogu.com.cn/upload/image_hosting/0hulu3d3.png](ç®—æ³•å¿«é—ª/0hulu3d3.png)



![image.png](ç®—æ³•å¿«é—ª/image.png)

æ‰€ä»¥åˆ†å±‚å›¾æŠŠæ‰€æœ‰åˆæ³•çš„å†³ç­–éƒ½è€ƒè™‘åˆ°äº†ã€‚è€Œæˆ‘ä»¬è¦æ±‚çš„æœ€å¤§æ”¶ç›Šå°±æ­£å¥½å¯¹åº”äº†å›¾ä¸Šçš„ä» 10â€‹ åˆ° n2â€‹ æœ€é•¿çš„è·¯å¾„ã€‚

> æ³¨ï¼šå½“ç„¶ä¹Ÿå¯ä»¥æŠŠè¾¹æƒéƒ½æ”¹æˆè´Ÿçš„æ±‚ä¸ªæœ€çŸ­è·¯(å› ä¸ºä¸å­˜åœ¨è´Ÿç¯ä¹Ÿæ˜¯å¯ä»¥çš„)ã€‚

æ³¨æ„æœ‰è´Ÿè¾¹æƒï¼Œè¦ç”¨spfa

---

spfaç±»ä¼¼bfsï¼Œä»uæ‰©å±•åˆ°vå¹¶ä¸”èƒ½æ›´æ–°væ—¶ï¼Œæ›´æ–°ï¼Œå¦‚æœvä¸åœ¨é˜Ÿä¸­åˆ™pushï¼Œæ ‡è®°å…¥é˜Ÿï¼Œå¦åˆ™ä¸pushã€‚**è®¿é—®uæ—¶æŠŠuçš„å…¥é˜Ÿæ ‡è®°æ’¤é”€**ã€‚

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define mp make_pair
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}



const int N=5e5+5;
 const int M=5e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

int n,m,k,s,t,cnt,ans,dis[N],v[N],vis[N];
struct node{
	int v,w;
};
vector<node> e[N];

void add(int u,int v,int w){
	e[u].push_back({v,w});
}

void spfa(int s){
	queue<int>q;
	q.push(s);
	for(int i=1;i<=3*n;i++)dis[i]=INF;
	dis[s]=0;
	while(q.size()){
		int u=q.front();q.pop();
		vis[u]=0;//!!æ ‡è®°å‡ºé˜Ÿ
		for(auto v:e[u]){
			if(dis[v.v]>dis[u]+v.w){
				dis[v.v]=dis[u]+v.w;
				if(vis[v.v])continue;
				q.push(v.v);
				vis[v.v]=1;
			}
		}
	}
}



signed main(){
	n=rd,m=rd;
	for(int i=1;i<=n;i++)v[i]=rd;
	for(int i=1;i<=n;i++){
		add(i,i+n,v[i]);
		add(i+n,i+n+n,-v[i]);
	}
	for(int i=1;i<=m;i++){
		int u=rd,v=rd,op=rd;
		add(u,v,0);
		add(u+n,v+n,0);
		add(u+n+n,v+n+n,0);
		if(op==2){
			add(v,u,0);
			add(v+n,u+n,0);
			add(v+n+n,u+n+n,0);
		}
	}

	spfa(1);

	cout<<-dis[3*n];
	
	
	return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

## èƒŒåŒ…dp

### å®Œå…¨èƒŒåŒ… | [NOIP2014 æé«˜ç»„] é£æ‰¬çš„å°é¸Ÿ

æ¸¸æˆç•Œé¢æ˜¯ä¸€ä¸ªé•¿ä¸º $n$ï¼Œé«˜ä¸º $m$ çš„äºŒç»´å¹³é¢ï¼Œå…¶ä¸­æœ‰ $k$ ä¸ªç®¡é“ï¼ˆå¿½ç•¥ç®¡é“çš„å®½åº¦ï¼‰ã€‚

å°é¸Ÿå§‹ç»ˆåœ¨æ¸¸æˆç•Œé¢å†…ç§»åŠ¨ã€‚å°é¸Ÿä»æ¸¸æˆç•Œé¢æœ€å·¦è¾¹ä»»æ„æ•´æ•°é«˜åº¦ä½ç½®å‡ºå‘ï¼Œåˆ°è¾¾æ¸¸æˆç•Œé¢æœ€å³è¾¹æ—¶ï¼Œæ¸¸æˆå®Œæˆã€‚

å°é¸Ÿæ¯ä¸ªå•ä½æ—¶é—´æ²¿æ¨ªåæ ‡æ–¹å‘å³ç§»çš„è·ç¦»ä¸º $1$ï¼Œç«–ç›´ç§»åŠ¨çš„è·ç¦»ç”±ç©å®¶æ§åˆ¶ã€‚å¦‚æœç‚¹å‡»å±å¹•ï¼Œå°é¸Ÿå°±ä¼šä¸Šå‡ä¸€å®šé«˜åº¦ $x$ï¼Œæ¯ä¸ªå•ä½æ—¶é—´å¯ä»¥ç‚¹å‡»å¤šæ¬¡ï¼Œæ•ˆæœå åŠ ï¼›å¦‚æœä¸ç‚¹å‡»å±å¹•ï¼Œå°é¸Ÿå°±ä¼šä¸‹é™ä¸€å®šé«˜åº¦ $y$ã€‚å°é¸Ÿä½äºæ¨ªåæ ‡æ–¹å‘ä¸åŒä½ç½®æ—¶ï¼Œä¸Šå‡çš„é«˜åº¦ $x_i$ å’Œä¸‹é™çš„é«˜åº¦ $y_i$ å¯èƒ½äº’ä¸ç›¸åŒã€‚

å°é¸Ÿé«˜åº¦ç­‰äº $0$ æˆ–è€…å°é¸Ÿç¢°åˆ°ç®¡é“æ—¶ï¼Œæ¸¸æˆå¤±è´¥ã€‚å°é¸Ÿé«˜åº¦ä¸º $m$ æ—¶ï¼Œæ— æ³•å†ä¸Šå‡ã€‚

ç°åœ¨,è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯ä»¥å®Œæˆæ¸¸æˆã€‚å¦‚æœå¯ä»¥ï¼Œè¾“å‡ºæœ€å°‘ç‚¹å‡»å±å¹•æ•°ï¼›å¦åˆ™ï¼Œè¾“å‡ºå°é¸Ÿæœ€å¤šå¯ä»¥é€šè¿‡å¤šå°‘ä¸ªç®¡é“ç¼éš™ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼š$5 \leq n \leq 10000$ï¼Œ$5 \leq m \leq 1000$ï¼Œ$0 \leq k < n$ï¼Œ$0 < x,y < m$ï¼Œ$0 < p < n$ï¼Œ$0 \leq l < h \leq m$ï¼Œ $l + 1 < h$ã€‚

è®°å½•f_{i,j}ä¸ºé£ç¦»ä½ç½®i,jæ—¶æœ€å°çš„ç‚¹å‡»æ•°ã€‚

é‚£ä¹ˆå¯¹äºä¸€ä¸ªf_{i,j}æˆ‘ä»¬æœ‰ä¸¤ç§è½¬ç§»çš„æ–¹å¼

- ä»ä¸Šå¾€ä¸‹ï¼Œ$f_{i,j}â†f_{i-1,j-y_{i}}$

- ä»ä¸‹å¾€ä¸Šï¼Œf_{i,j}â†f_{i-1,j+kx_i},k=1,2,3,\dots

é‚£ä¹ˆæˆ‘ä»¬å‘ç°ç¬¬ä¸€ç§æƒ…å†µå¾ˆå¥½å¤„ç†ã€‚ä½†æ˜¯ç¬¬äºŒç« æƒ…å†µçš„è½¬ç§»çš„åæ­£å¯¹äºå°±è¿‡é«˜äº†ã€‚

äºæ˜¯æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹äºŒï¼š$f_{i,j-x_i}â†f_{i-1,j-x_i+kx_i},k=1,2,3,\dots$

é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥çœ‹æˆ$f_{i,j}â†f_{i,j-x_i},f_{i-1,j-x_i}$å‘¢ï¼Ÿå¯ä»¥çš„ã€‚

![image.png](ç®—æ³•å¿«é—ª/image 1.png)

ä»£ç Â·Â·WA

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
// #define int long long
#define mp make_pair

#define rd read()
inline int read()
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


const int N=1e3+5;
 const int M=1e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;
int n,t,m;
int a[N],k;
int ans,mx,tmx,dp[M][N],l[M],h[M],x[M],y[M];
bool f2;

int mxlst,lst;

struct node{
	int p,l,h;
}p[N];


bool cmp(node a,node b){
	return a.p<b.p;
}

signed main(){

    // freopen("woof.in","r",stdin);
    // freopen("woof.out","w",stdout);
	n=rd;
	m=rd;
	k=rd;
	for(int i=1;i<=n;i++){
		x[i]=rd,y[i]=rd;
	}
	for(int i=1;i<=k;i++){
		p[i].p=rd+1,p[i].l=rd,p[i].h=rd;
	}

	sort(p+1,p+k+1,cmp);
	int cnt=1;
	memset(dp,INF,sizeof dp);
	for(int i=1;i<=m;i++)dp[0][i]=0;
	for(int i=1;i<=n;i++){
		if(i>p[cnt].p)cnt++;
		int tmp=INF;
		for(int j=1;j<=m;j++){
			if(j+y[i]<=m)dp[i][j]=min(dp[i][j],dp[i-1][j+y[i]]);
			if(j-x[i]>0)dp[i][j]=min(dp[i][j],1+min(dp[i][j-x[i]],dp[i-1][j-x[i]]));
			if(i==p[cnt].p&&(j>p[cnt].h||j<p[cnt].l))dp[i][j]=INF;
			tmp=min(tmp,dp[i][j]);
		}
		if(tmp==INF){
			cout<<0<<endl;
			if(i==p[cnt].p)cout<<cnt-1;
			else cout<<cnt;
			return 0;
		}
	}
	ans=INF;
	for(int i=1;i<=m;i++)ans=min(ans,dp[n][i]);
	cout<<1<<endl<<ans;

}

/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

std

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
// #define int long long
#define mp make_pair

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


// void solve(){

//     cerr<<"\nlong longrr[][]=";
//     for(int i=1;i<=n;i++)cerr<<t[i].lst<<' '<<t[i].r<<endl;
// }



const int N=1e4+5;
 const int M=1e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

struct node{
	int id,h,l;
	bool operator <(const node &a) const
	{
		return id<a.id;
	}
}p[N];

int x[N],y[N],dp[2][N],n,m,k,cnt=1,ans;
signed main(){
	

	n=rd,m=rd,k=rd;
	for(int i=1;i<=n;i++)x[i]=rd,y[i]=rd;
	for(int i=1;i<=k;i++)p[i].id=rd,p[i].l=rd,p[i].h=rd;

	sort(p+1,p+k+1);
	for(int i=1;i<=n;i++)	{
		for(int j=0;j<=m;j++)
		dp[i%2][j]=INF;
		for(int j=x[i]+1;j<=x[i]+m;j++)	dp[i%2][j]=min(dp[i%2^1][j-x[i]]+1,dp[i%2][j-x[i]]+1);
		for(int j=m+1;j<=x[i]+m;j++)dp[i%2][m]=min(dp[i%2][m],dp[i%2][j]);
		for(int j=1;j<=m-y[i];j++)dp[i%2][j]=min(dp[i%2][j],dp[i%2^1][j+y[i]]);
		
		if(i==p[cnt].id){
			ans=INF;
			for(int j=0;j<=p[cnt].l;j++)
			dp[i%2][j]=INF;
			for(int j=p[cnt].h;j<=m;j++)
			dp[i%2][j]=INF;
			for(int j=1;j<=m;j++)
			ans=min(dp[i%2][j],ans);
			if(ans==INF)
			{
				cout<<0<<endl<<cnt-1;return 0;
			}
			cnt++;
		}
	}
	ans=INF;
	for(int j=1;j<=m;j++)
	ans=min(dp[n%2][j],ans);
	cout<<1<<endl<<ans;
	return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### 01èƒŒåŒ… | [NOIP2006 æ™®åŠç»„] å¼€å¿ƒçš„é‡‘æ˜

é‡‘æ˜ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®¶é‡Œè´­ç½®çš„æ–°æˆ¿å°±è¦é¢†é’¥åŒ™äº†ï¼Œæ–°æˆ¿é‡Œæœ‰ä¸€é—´ä»–è‡ªå·±ä¸“ç”¨çš„å¾ˆå®½æ•çš„æˆ¿é—´ã€‚æ›´è®©ä»–é«˜å…´çš„æ˜¯ï¼Œå¦ˆå¦ˆæ˜¨å¤©å¯¹ä»–è¯´ï¼šâ€œä½ çš„æˆ¿é—´éœ€è¦è´­ä¹°å“ªäº›ç‰©å“ï¼Œæ€ä¹ˆå¸ƒç½®ï¼Œä½ è¯´äº†ç®—ï¼Œåªè¦ä¸è¶…è¿‡ $N$ å…ƒé’±å°±è¡Œâ€ã€‚ä»Šå¤©ä¸€æ—©é‡‘æ˜å°±å¼€å§‹åšé¢„ç®—ï¼Œä½†æ˜¯ä»–æƒ³ä¹°çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œè‚¯å®šä¼šè¶…è¿‡å¦ˆå¦ˆé™å®šçš„ $N$ å…ƒã€‚äºæ˜¯ï¼Œä»–æŠŠæ¯ä»¶ç‰©å“è§„å®šäº†ä¸€ä¸ªé‡è¦åº¦ï¼Œåˆ†ä¸º $5$ ç­‰ï¼šç”¨æ•´æ•° $1-5$ è¡¨ç¤ºï¼Œç¬¬ $5$ ç­‰æœ€é‡è¦ã€‚ä»–è¿˜ä»å› ç‰¹ç½‘ä¸ŠæŸ¥åˆ°äº†æ¯ä»¶ç‰©å“çš„ä»·æ ¼ï¼ˆéƒ½æ˜¯æ•´æ•°å…ƒï¼‰ã€‚ä»–å¸Œæœ›åœ¨ä¸è¶…è¿‡ $N$ å…ƒï¼ˆå¯ä»¥ç­‰äº $N$ å…ƒï¼‰çš„å‰æä¸‹ï¼Œä½¿æ¯ä»¶ç‰©å“çš„ä»·æ ¼ä¸é‡è¦åº¦çš„ä¹˜ç§¯çš„æ€»å’Œæœ€å¤§ã€‚

è®¾ç¬¬$j$ä»¶ç‰©å“çš„ä»·æ ¼ä¸º $v_j$ï¼Œé‡è¦åº¦ä¸º $w_j$ï¼Œå…±é€‰ä¸­äº† $k$ ä»¶ç‰©å“ï¼Œç¼–å·ä¾æ¬¡ä¸º $j_1,j_2,â€¦,j_k$ï¼Œåˆ™æ‰€æ±‚çš„æ€»å’Œä¸ºï¼š

$v_{j_1} \times w_{j_1}+v_{j_2} \times w_{j_2} â€¦+v_{j_k} \times w_{j_k}$ã€‚

è¯·ä½ å¸®åŠ©é‡‘æ˜è®¾è®¡ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è´­ç‰©å•ã€‚

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
// #define int long long
#define mp make_pair

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


const int N=1e5+5;
 const int M=1e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

int p[N],v[N],f[N],n,m,k,cnt=1,ans;
signed main(){
	
	n=rd,m=rd;
	for(int i=1;i<=m;i++){
		v[i]=rd;p[i]=rd;p[i]*=v[i];
	}
	for(int i=1;i<=m;i++){
		for(int j=n;j>=v[i];j--){
			f[j]=max(f[j],f[j-v[i]]+p[i]);
		}
	}

	cout<<f[n]<<endl;
	return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### ä¾èµ–èƒŒåŒ… | [NOIP2006 æé«˜ç»„] é‡‘æ˜çš„é¢„ç®—æ–¹æ¡ˆ

é‡‘æ˜ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®¶é‡Œè´­ç½®çš„æ–°æˆ¿å°±è¦é¢†é’¥åŒ™äº†ï¼Œæ–°æˆ¿é‡Œæœ‰ä¸€é—´é‡‘æ˜è‡ªå·±ä¸“ç”¨çš„å¾ˆå®½æ•çš„æˆ¿é—´ã€‚æ›´è®©ä»–é«˜å…´çš„æ˜¯ï¼Œå¦ˆå¦ˆæ˜¨å¤©å¯¹ä»–è¯´ï¼šâ€œä½ çš„æˆ¿é—´éœ€è¦è´­ä¹°å“ªäº›ç‰©å“ï¼Œæ€ä¹ˆå¸ƒç½®ï¼Œä½ è¯´äº†ç®—ï¼Œåªè¦ä¸è¶…è¿‡ $n$ å…ƒé’±å°±è¡Œâ€ã€‚ä»Šå¤©ä¸€æ—©ï¼Œé‡‘æ˜å°±å¼€å§‹åšé¢„ç®—äº†ï¼Œä»–æŠŠæƒ³ä¹°çš„ç‰©å“åˆ†ä¸ºä¸¤ç±»ï¼šä¸»ä»¶ä¸é™„ä»¶ï¼Œé™„ä»¶æ˜¯ä»å±äºæŸä¸ªä¸»ä»¶çš„ã€‚

å¦‚æœè¦ä¹°å½’ç±»ä¸ºé™„ä»¶çš„ç‰©å“ï¼Œå¿…é¡»å…ˆä¹°è¯¥é™„ä»¶æ‰€å±çš„ä¸»ä»¶ã€‚æ¯ä¸ªä¸»ä»¶å¯ä»¥æœ‰ $0$ ä¸ªã€$1$ ä¸ªæˆ– $2$ ä¸ªé™„ä»¶ã€‚æ¯ä¸ªé™„ä»¶å¯¹åº”ä¸€ä¸ªä¸»ä»¶ï¼Œé™„ä»¶ä¸å†æœ‰ä»å±äºè‡ªå·±çš„é™„ä»¶ã€‚é‡‘æ˜æƒ³ä¹°çš„ä¸œè¥¿å¾ˆå¤šï¼Œè‚¯å®šä¼šè¶…è¿‡å¦ˆå¦ˆé™å®šçš„ $n$ å…ƒã€‚äºæ˜¯ï¼Œä»–æŠŠæ¯ä»¶ç‰©å“è§„å®šäº†ä¸€ä¸ªé‡è¦åº¦ï¼Œåˆ†ä¸º $5$ ç­‰ï¼šç”¨æ•´æ•° $1 \sim 5$ è¡¨ç¤ºï¼Œç¬¬ $5$ ç­‰æœ€é‡è¦ã€‚ä»–è¿˜ä»å› ç‰¹ç½‘ä¸ŠæŸ¥åˆ°äº†æ¯ä»¶ç‰©å“çš„ä»·æ ¼ï¼ˆéƒ½æ˜¯ $10$ å…ƒçš„æ•´æ•°å€ï¼‰ã€‚ä»–å¸Œæœ›åœ¨ä¸è¶…è¿‡ $n$ å…ƒçš„å‰æä¸‹ï¼Œä½¿æ¯ä»¶ç‰©å“çš„ä»·æ ¼ä¸é‡è¦åº¦çš„ä¹˜ç§¯çš„æ€»å’Œæœ€å¤§ã€‚

è®¾ç¬¬ $j$ ä»¶ç‰©å“çš„ä»·æ ¼ä¸º $v_j$ï¼Œé‡è¦åº¦ä¸º$w_j$ï¼Œå…±é€‰ä¸­äº† $k$ ä»¶ç‰©å“ï¼Œç¼–å·ä¾æ¬¡ä¸º $j_1,j_2,\dots,j_k$ï¼Œåˆ™æ‰€æ±‚çš„æ€»å’Œä¸ºï¼š

$v_{j_1} \times w_{j_1}+v_{j_2} \times w_{j_2}+ \dots +v_{j_k} \times w_{j_k}$ã€‚

è¯·ä½ å¸®åŠ©é‡‘æ˜è®¾è®¡ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è´­ç‰©å•ã€‚

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1 \leq n \leq 3.2 \times 10^4$ï¼Œ$1 \leq m \leq 60$ï¼Œ$0 \leq v_i \leq 10^4$ï¼Œ$1 \leq p_i \leq 5$ï¼Œ$0 \leq q_i \leq m$ï¼Œç­”æ¡ˆä¸è¶…è¿‡ $2 \times 10^5$ã€‚

```C++

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define mp make_pair

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}



const int N=1e2+5;
 const int M=5e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
bool f1;

int p[N],v[N],dp[N][M],n,m,k,cnt,ans,id[N],q[N];
vector<int> e[N];

signed main(){
	
	n=rd,m=rd;
	for(int i=1;i<=m;i++){
		v[i]=rd;p[i]=rd;q[i]=rd;
		if(q[i])e[q[i]].push_back(i);
		else id[++cnt]=i;
	}
	for(int i=1;i<=cnt;i++){
		for(int j=0;j<=n;j++){
			dp[i][j]=dp[i-1][j];//ç»§æ‰¿
			if(j>=v[id[i]])dp[i][j]=max(dp[i][j],dp[i-1][j-v[id[i]]]+p[id[i]]*v[id[i]]);//è½¬ç§»
			if(e[id[i]].size()>=1){//!!æ³¨æ„ä¸æ˜¯==
				int vv=v[id[i]]+v[e[id[i]][0]];//ä¸»+é™„ä»¶1
				int ww=p[id[i]]*v[id[i]]+p[e[id[i]][0]]*v[e[id[i]][0]];
				if(j>=vv)dp[i][j]=max(dp[i][j],dp[i-1][j-vv]+ww);
			}
			if(e[id[i]].size()==2){
				int vv=v[id[i]]+v[e[id[i]][1]];//ä¸»+é™„ä»¶2
				int ww=p[id[i]]*v[id[i]]+p[e[id[i]][1]]*v[e[id[i]][1]];
				if(j>=vv)dp[i][j]=max(dp[i][j],dp[i-1][j-vv]+ww);

				vv+=v[e[id[i]][0]];//ä¸»+é™„ä»¶1ï¼Œ2
				ww+=p[e[id[i]][0]]*v[e[id[i]][0]];
				if(j>=vv)dp[i][j]=max(dp[i][j],dp[i-1][j-vv]+ww);
			}
		}

	}
	for(int i=0;i<=n;i++)ans=max(ans,dp[cnt][i]);
	
	cout<<ans<<endl;

	return 0;
}
/*

*/
```

day2

## å­—ç¬¦ä¸²

### å­—ç¬¦ä¸²hash | [COCI2011-2012#4] KRIPTOGRAM

ç°æœ‰ä¸€æ®µæ˜æ–‡å’Œä¸€éƒ¨åˆ†å¯†æ–‡ã€‚æ˜æ–‡å’Œå¯†æ–‡éƒ½ç”±è‹±æ–‡å•è¯ç»„æˆï¼Œä¸”å¯†æ–‡ä¸­çš„ä¸€ä¸ªå•è¯å¿…ç„¶å¯¹åº”ç€æ˜æ–‡ä¸­çš„ä¸€ä¸ªå•è¯ã€‚

æ±‚ç»™å‡ºçš„å¯†æ–‡åœ¨æ˜æ–‡ä¸­å¯èƒ½å‡ºç°çš„æœ€æ—©ä½ç½®ã€‚

ç¬¬ä¸€è¡Œï¼Œè‹¥å¹²ä¸ªè‹±æ–‡å•è¯å’Œä¸€ä¸ª $ï¼Œè¡¨ç¤ºæ˜æ–‡ã€‚

ç¬¬äºŒè¡Œï¼Œè‹¥å¹²ä¸ªè‹±æ–‡å•è¯å’Œä¸€ä¸ª $ï¼Œè¡¨ç¤ºå¯†æ–‡ã€‚

æ¯è¡Œæœ«å°¾çš„ $\texttt \$$ ç”¨äºè¡¨ç¤ºè¯¥è¡Œç»“æŸã€‚æ•°æ®ä¿è¯æ²¡æœ‰å¤šä¸ª$\texttt \$$ å‡ºç°åœ¨åŒä¸€è¡Œçš„æƒ…å†µã€‚

æ ·ä¾‹è¾“å…¥ #3

```C++
a b c x c z z a b c $
prvi dr prvi tr tr x $
```

æ ·ä¾‹è¾“å‡º #3

```C++
3
```

- å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæ˜æ–‡å’Œå¯†æ–‡æ‰€å¯¹åº”å­—ç¬¦ä¸²çš„é•¿åº¦ä¸è¶…è¿‡ $10^6$ï¼Œè¾“å…¥çš„å•è¯å‡ç”±å°å†™å­—æ¯ç»„æˆã€‚

---

**æ€è·¯**

è®©æˆ‘ä»¬å…ˆçœ‹æ‡‚æ ·ä¾‹çš„æ„æ€ã€‚

```C++
a b c x c z z a b c $
prvi dr prvi tr tr x $
```

æˆ‘ä»¬æŠŠä¸¤ä¸ªä¸²ä¸­ç›¸åŒçš„å­ä¸²æŒ‰ç­‰ä»·ç±»æ¥ç¼–å·ï¼Œå°±å˜æˆäº†ï¼š

```Plain Text
1 2 3 4 3 5 5 1 2 3
1 2 1 3 3 4
```

ç„¶åæˆ‘ä»¬å†™æˆå·®åˆ†çš„å½¢å¼ï¼š

```C++
(1) 1 1 1 -1 2 0 -4 1 1
(1) 1 -1 2 0 0 1
```

å¥½åƒæ²¡ä»€ä¹ˆå‘ç°â€”â€”é‚£æˆ‘ä»¬æ‰‹åŠ¨æ‰¾åˆ°æ˜æ–‡ä¸­çš„å¯¹åº”å¯†æ–‡çš„é‚£ä¸€ä¸²å•ç‹¬æ‹å‡ºæ¥å‘¢ï¼Ÿ

```Plain Text
c x c z z a -> 1 2 1 3 3 4 -> 1 -1 2 0 0 1
prvi dr prvi tr tr x -> 1 2 1 3 3 4 -> 1 -1 2 0 0 1
```

æˆ‘ä»¬æƒŠå¥‡çš„å‘ç°å®ƒä»¬è½¬åŒ–ä¸ºç­‰ä»·ç±»åŠå…¶å·®åˆ†æ˜¯ç›¸åŒçš„ï¼è¿™é‡Œæˆ‘ä»¬å°±è¦æƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆä¹‹å‰æˆ‘ä»¬æ²¡æœ‰å‘ç°ï¼ˆæˆ–è€…è¯´ä¸ºå•¥ä¹‹å‰ä¸ç›¸ç­‰ï¼‰å‘¢ï¼Ÿ

å› ä¸ºæˆ‘ä»¬åœ¨æ˜æ–‡ä¸­åŒ¹é…å¯†æ–‡ç›¸å½“äºä¸€ä¸ª**æ»‘åŠ¨çª—å£**ï¼Œçª—å£å·¦ç«¯ç‚¹ä¹‹å‰çš„ä¿¡æ¯æˆ‘ä»¬æ˜¯ä¸å¯ä»¥è®°å½•çš„ï¼

å¯¹äºå­—ç¬¦ä¸²åŒ¹é…ï¼Œæˆ‘ä»¬è‡ªç„¶æƒ³å¾—åˆ°å­—ç¬¦ä¸²å“ˆå¸Œã€‚æ‰€ä»¥ç°åœ¨çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬å¦‚ä½•åŠ¨æ€ç»´æŠ¤çª—å£å†…çš„å­—ç¬¦ä¸²çš„å“ˆå¸Œï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªè¾ƒå¥½çš„æ–¹æ³•æ¥å®šä¹‰è¿™ä¸ªå­—ç¬¦ä¸²å“ˆå¸Œæ¥ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°ç»´æŠ¤å®ƒã€‚

æ‰€ä»¥æˆ‘ä»¬è®°æ˜æ–‡ä¸­ç¬¬ $i$ ä¸ªå•è¯åˆ°ï¼ˆçª—å£å†…ï¼‰ä¸Šä¸€ä¸ªç›¸åŒå•è¯çš„è·ç¦»æ˜¯ $a_i$â€‹ï¼Œå¯†æ–‡ä¸­ç¬¬ $i$ ä¸ªå•è¯åˆ°ä¸Šä¸€ä¸ªç›¸åŒå•è¯çš„è·ç¦»æ˜¯ $b_i$â€‹ã€‚ç‰¹åˆ«åœ°ï¼Œå¦‚æœå‰é¢æ²¡æœ‰å‡ºç°è¿‡ç›¸åŒå•è¯ï¼Œåˆ™å°†è·ç¦»è®°ä½œ $-1$ã€‚

é‚£ä¹ˆå¯¹äºä¸€ä¸ªå•è¯ $v$ï¼Œå½“å®ƒæ»‘å‡ºçª—å£æ—¶ï¼Œ$v$ åé¢çš„ä¸å®ƒç›¸åŒçš„å•è¯çš„ $a$ å€¼å°±ä¼šå‘ç”Ÿæ”¹å˜ã€‚å› æ­¤æˆ‘ä»¬é¢„å¤„ç†å¯¹äºæ¯ä¸ªå•è¯ $i$ï¼ˆ$i$ ä¸ºä¸‹æ ‡ï¼‰ï¼Œå®ƒåé¢çš„å’Œå®ƒç›¸åŒçš„å•è¯çš„ä½ç½® $nxt_i$ã€‚å½“æˆ‘ä»¬çš„æ»‘åŠ¨çª—å£å‘åæ»‘åŠ¨æ—¶ï¼Œå¯¹æ»‘å‡ºçª—å£çš„é‚£ä¸ªå­—ç¬¦ä¸² $i$ï¼Œæ‰¾åˆ° $nxt_i$ï¼Œä¿®æ”¹ $a_{nxt_i}$ ä¸º $-1$ã€‚

æˆ‘ä»¬ç”¨çª—å£å†…çš„ $a_i$ å’Œ $b_i$ çš„å“ˆå¸Œå€¼æ¥åˆ¤å®šçª—å£å†…çš„å­—ç¬¦ä¸²å’Œå¯†æ–‡æ˜¯å¦ç­‰ä»·ã€‚å› ä¸ºæˆ‘ä»¬çš„çª—å£æ˜¯éœ€è¦æ»‘åŠ¨çš„ï¼Œæ•…åœ¨çª—å£æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œ$a_i$ çš„å€¼ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬è¦å¿«é€Ÿç»´æŠ¤çª—å£å†…çš„å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ã€‚

å®é™…ä¸Šå°±æ˜¯åŒºé—´å“ˆå¸Œã€‚

**Code**

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define ull unsigned long long
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}

const int N=5e5+5;
const int M=5e4+5;
const int INF=2e9+5;
const int MOD=2e9+7;
const int BASE=17737;
bool f1;
int n,m;
int prea[N], nxta[N], preb[N], nxtb[N];
int a[N], b[N];
string s;
ull has[N], hass[N];
map <string, int> mp,mp2;
bool f2;

void init(){
	while(cin >> s){
		if(s[0] == '$')break;
        nxta[mp[s]] = ++ n, prea[n] = mp[s], mp[s] = n;
    }
    while(cin >> s){
		if(s[0] == '$')break;
        nxtb[mp2[s]] = ++ m, preb[m] = mp2[s], mp2[s] = m;
    }

	for(int i = 1;i <= n;++ i) if(!nxta[i]) nxta[i] = INF;
    for(int i = 1;i <= m;++ i) if(!nxtb[i]) nxtb[i] = INF;

	for(int i=1;i<=n;i++)a[i]=b[i]=-1;
    for(int i=1;i<=n;i++)if(prea[i])a[i]=i-prea[i];
	for(int i=1;i<=m;i++)if(preb[i])b[i]=i-preb[i];

}
signed main(){

	init();
    
    ull h0 = 0, h = 0; 
	
	hass[0] = 1;
    for(int i = 1;i <= m;++ i) hass[i] = hass[i - 1] * BASE;


    for(int i = 1;i <= m;++ i)
        h0 = h0 * BASE + b[i], h  = h  * BASE + a[i];
    if(h == h0){//ç‰¹åˆ¤ç¬¬ä¸€ä¸ªä½ç½®
		cout<<1<<endl;
		return 0;
	}
    for(int i = m + 1;i <= n;++ i){
        h = h * BASE + a[i], h = h - a[i - m] * hass[m];

        if(nxta[i - m] <= i){
            h = h - a[nxta[i - m]] * hass[i - nxta[i - m]];
            a[nxta[i - m]] = -1;
            h = h + a[nxta[i - m]] * hass[i - nxta[i - m]];
        } else if(nxta[i - m] <= n) a[nxta[i - m]] = -1;

        if(h == h0){
			cout<<i - m + 1;
			return 0;
		}
    }
    return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### ğŸ˜”å›æ–‡ä¸² | [å›½å®¶é›†è®­é˜Ÿ] æ‹‰æ‹‰é˜Ÿæ’ç»ƒ

ã€‚$n$ ä¸ªå¥³ç”Ÿä»å·¦åˆ°å³æ’æˆä¸€è¡Œï¼Œæ¯ä¸ªäººæ‰‹ä¸­éƒ½ä¸¾äº†ä¸€ä¸ªå†™æœ‰ $26$ ä¸ªå°å†™å­—æ¯ä¸­çš„æŸä¸€ä¸ªçš„ç‰Œå­ã€‚

å¦‚æœè¿ç»­çš„ä¸€æ®µå¥³ç”Ÿï¼Œæœ‰å¥‡æ•°ä¸ªï¼Œå¹¶ä¸”ä»–ä»¬æ‰‹ä¸­çš„ç‰Œå­æ‰€å†™çš„å­—æ¯ï¼Œä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦è¯»èµ·æ¥ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™ä¸€æ®µå¥³ç”Ÿå°±è¢«ç§°ä½œå’Œè°å°ç¾¤ä½“ã€‚

ç°åœ¨é›¨è¨æƒ³æ‰¾å‡ºæ‰€æœ‰å’Œè°å°ç¾¤ä½“ï¼Œå¹¶ä¸”æŒ‰ç…§å¥³ç”Ÿçš„ä¸ªæ•°é™åºæ’åºä¹‹åï¼Œå‰ $K$ ä¸ªå’Œè°å°ç¾¤ä½“çš„å¥³ç”Ÿä¸ªæ•°çš„ä¹˜ç§¯æ˜¯å¤šå°‘ã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œé›¨è¨åªè¦ä½ å‘Šè¯‰å¥¹ï¼Œç­”æ¡ˆé™¤ä»¥ $19930726$ çš„ä½™æ•°æ˜¯å¤šå°‘å°±è¡Œäº†ã€‚

|æµ‹è¯•ç‚¹|n|K|
|-|-|-|
|20|1,000,000|1,000,000,000,000|

---

é©¬æ‹‰è½¦+æ¡¶æ’åº+å¿«é€Ÿå¹‚ï¼Œç»Ÿè®¡ç­”æ¡ˆç”¨çš„å°ºå–æ³•

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define ull unsigned long long
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}

const int N=1e6+5;
const int M=5e4+5;
const int INF=2e9+5;
const int MOD=19930726;
const int BASE=17737;
bool f1;
int n,m;

char s[N],str[N*2];
int d[N*2],cnt[N];
int len;
int ans=1,k;
int ksm(int x,int y) {
    int res=1;
    while(y) {
        if(y&1) res=(res*x)%MOD;
        x=(x*x)%MOD;
        y>>=1;
    }
    return res;
}
void getd() {
    for(int i=1; i<=len; i++) str[i*2-1]='#',str[i*2]=s[i];
    str[len=len*2+1]='#';
    int id=0,r=0;
    for(int i=1; i<=len; i++) {
        if(i<r) d[i]=min(d[id*2-i],r-i);
        else d[i]=1;
        while(d[i]+i<=len && i-d[i]>=1 && str[i+d[i]]==str[i-d[i]]) d[i]++;
        if(d[i]+i>r) id=i,r=i+d[i];
        if((d[i]-1)%2) cnt[d[i]-1]++;
    }
}


signed main() {
    int sum=0;
    cin>>n>>k>>s+1;
    len=n;
    getd();
    for(int i=n; i>=1; i--) {
        if(i%2==0) continue;
        sum+=cnt[i];
        if(k>=sum) {
            ans=(ans*ksm(i,sum))%MOD;
            k-=sum;
        } else {
            ans=(ans*ksm(i,k))%MOD;
            k-=sum;
            break;
        }
    }
    if(k>0)cout<<-1<<endl;
	else cout<<ans;
    return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### KMPåŠå…¶å«ä¹‰ | [NOI2014] åŠ¨ç‰©å›­

#### ç®—æ³•

äº†è§£ä¸€ä¸ªç®—æ³•ï¼Œé¦–å…ˆè¦çŸ¥é“å®ƒå¯ä»¥åšä»€ä¹ˆã€‚

è¯·æ±‚å‡º t ä½œä¸ºå­ä¸²åœ¨ s ä¸­æ‰€æœ‰å‡ºç°çš„ä½ç½®ã€‚

é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·å»é¦–å…ˆå®ƒå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„nxtï¼Œå…¶ä¸­nxt_iè¡¨ç¤ºåœ¨tä¸­æœ€å¤§çš„lenï¼Œä½¿å¾—t[1,len]=t[i-len+1,i]ã€‚ä½ å¯ä»¥è€ƒè™‘ä¸º**t[1,i]çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦**ã€‚

é‚£ä¹ˆè¿™æ ·æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

å‡å¦‚æˆ‘ä»¬åŒ¹é…åˆ°äº†s_iå’Œt_jï¼Œå‘ç°s_{i+1}â‰ t_{j+1}ï¼Œæˆ‘ä»¬çš„jå¯ä»¥å›åˆ°æœ€é å³çš„åœ°æ–¹æ˜¯å“ªé‡Œï¼Ÿå¿…ç„¶æ˜¯nxt_jäº†ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚äºæ˜¯åœ¨æ¯æ¬¡å¤±é…æ—¶ï¼Œæˆ‘ä»¬å°±è®©j=nxt_jï¼Œç„¶åèµ°æ­£å¸¸çš„j++å³å¯ã€‚

è¿™é‡Œè¦æ³¨æ„nxt_1=0ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å½“i+1å¤±é…åè·³åˆ°nxt_içš„ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨i=1å¤±é…æ—¶åˆè·³å›1ï¼Œè¿™æ ·å°±å¾ªç¯äº†ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™é‡Œçš„içš„**å…¬å…±å‰åç¼€**é•¿åº¦ä¸èƒ½ä¸ºiã€‚æå…¶ä¸¥æ ¼å‰åç¼€ï¼Œä¸åŒ…å«æ•´ä¸²çš„é‚£ç§ã€‚å› ä¸ºå¦‚æœåŒ…å«æ•´ä¸²ï¼Œå°±å¯èƒ½è¿›å…¥æ­»å¾ªç¯ã€‚

é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·å¯¹té¢„å¤„ç†å‡ºnxtæ•°ç»„å‘¢ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬è€ƒè™‘ç®€å•ä¸€ç‚¹çš„æƒ…å†µï¼š

1 2 3 4 5 6 7 

a b c d a b c

a b c d a b c

å½“ièµ°åˆ°7æ—¶ï¼Œæˆ‘ä»¬å…ˆè®©jæŒ‡å‘nxt_{i-1}ã€‚æ­¤æ—¶æŸ¥çœ‹t_{j+1}å’Œt_{i}ã€‚å¦‚æœåŒ¹é…ï¼Œé‚£ä¹ˆå°±ç›´æ¥è®©nxt_i=j+1ã€‚

å¤æ‚ä¸€ç‚¹ï¼Œå¦‚æœt_{j+1}â‰ t_{i}ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦å°½å¯èƒ½åœ°ä½¿iå‰é¢çš„å­—ç¬¦ä¸²å’Œtçš„å‰ç¼€å°½å¯èƒ½åœ°åŒ¹é…ï¼Œæˆ‘ä»¬å°±è¦é€€è€Œæ±‚å…¶æ¬¡ã€‚çœ‹å›¾ï¼š

![image.png](ç®—æ³•å¿«é—ª/image 2.png)

æ€»ç»“èµ·æ¥ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªå…¬å…±å‰åç¼€ï¼Œåœ¨è®©å…¶å°½å¯èƒ½é•¿çš„å‰æä¸‹ï¼Œè®©å®ƒæ»¡è¶³å…¶ç´§éšå…¶åçš„ä¸¤ä¸ªå­—æ¯ç›¸åŒã€‚

äºæ˜¯æˆ‘ä»¬å…ˆå‡è®¾æŒ‡é’ˆjæŒ‡å‘i-1ï¼ŒæŠŠç­”æ¡ˆï¼ˆå³ç¬¦åˆæ¡ä»¶çš„å…¬å…±å‰åç¼€é•¿åº¦ï¼‰å‡è®¾ä¸ºi-1ï¼Œä¸è¡Œå°±å†æŒ‡å‘nxt_{j}ï¼Œä¸€ç›´åˆ°å¯è¡Œä¸ºæ­¢ã€‚

è¿™ä¸ªè¿‡ç¨‹éœ€è¦å¼ºåŠ è®°å¿†ï¼Œè¯·ç‰¢è®°ï¼

#### é¢˜ç›®

æŸå¤©ï¼Œå›­é•¿ç»™åŠ¨ç‰©ä»¬è®²è§£ KMP ç®—æ³•ã€‚å¯¹äºä¸€ä¸ªå­—ç¬¦ä¸² $S$ï¼Œå®ƒçš„é•¿åº¦ä¸º $L$ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ $O(L)$ çš„æ—¶é—´å†…ï¼Œæ±‚å‡º $\mathrm{next}$ çš„æ•°ç»„ã€‚ $\mathrm{next}$ æ•°ç»„çš„å«ä¹‰ï¼šå¯¹äºå­—ç¬¦ä¸² $S$ çš„å‰ $i$ ä¸ªå­—ç¬¦æ„æˆçš„å­ä¸²ï¼Œæ—¢æ˜¯å®ƒçš„åç¼€åˆæ˜¯å®ƒçš„å‰ç¼€çš„å­—ç¬¦ä¸²ä¸­ï¼ˆå®ƒæœ¬èº«é™¤å¤–ï¼‰ï¼Œæœ€é•¿çš„é•¿åº¦è®°ä½œ $\mathrm{next}[i]$ã€‚â€

ä¾‹ $S$ ä¸º $\verb!abcababc!$ï¼Œåˆ™ $\mathrm{next}[5]=2$ã€‚å› ä¸º$S$çš„å‰$5$ä¸ªå­—ç¬¦ä¸º $\verb!abcab!$ï¼Œ$\verb!ab!$ æ—¢æ˜¯å®ƒçš„åç¼€åˆæ˜¯å®ƒçš„å‰ç¼€ï¼Œå¹¶ä¸”æ‰¾ä¸åˆ°ä¸€ä¸ªæ›´é•¿çš„å­—ç¬¦ä¸²æ»¡è¶³è¿™ä¸ªæ€§è´¨ã€‚

ä»–è¯¦ç»†è®²è§£äº†å¦‚ä½•åœ¨ $O(L)$ çš„æ—¶é—´å†…æ±‚å‡º $\mathrm{next}$ æ•°ç»„ã€‚

ä¸ªé—®é¢˜ï¼šâ€œKMP ç®—æ³•åªèƒ½æ±‚å‡º $\mathrm{next}$ æ•°ç»„ã€‚æˆ‘ç°åœ¨å¸Œæœ›æ±‚å‡ºä¸€ä¸ªæ›´å¼ºå¤§ $\mathrm{num}$ æ•°ç»„ä¸€ä¸€å¯¹äºå­—ç¬¦ä¸² $S$ çš„å‰ $i$ ä¸ªå­—ç¬¦æ„æˆçš„å­ä¸²ï¼Œæ—¢æ˜¯å®ƒçš„åç¼€åŒæ—¶åˆæ˜¯å®ƒçš„å‰ç¼€ï¼Œå¹¶ä¸”è¯¥åç¼€ä¸è¯¥å‰ç¼€ä¸é‡å ï¼Œå°†è¿™ç§å­—ç¬¦ä¸²çš„æ•°é‡è®°ä½œ $\mathrm{num}[i]$ã€‚ä¾‹å¦‚ $S$ ä¸º $\verb!aaaaa!$ï¼Œåˆ™ $\mathrm{num}[4] = 2$ã€‚è¿™æ˜¯å› ä¸º$S$çš„å‰ $4$ ä¸ªå­—ç¬¦ä¸º $\verb!aaaa!$ï¼Œå…¶ä¸­ $\verb!a!$ å’Œ $\verb!aa!$ éƒ½æ»¡è¶³æ€§è´¨â€˜æ—¢æ˜¯åç¼€åˆæ˜¯å‰ç¼€â€™ï¼ŒåŒæ—¶ä¿è¯è¿™ä¸ªåç¼€ä¸è¿™ä¸ªå‰ç¼€ä¸é‡å ã€‚è€Œ $\verb!aaa!$ è™½ç„¶æ»¡è¶³æ€§è´¨â€˜æ—¢æ˜¯åç¼€åˆæ˜¯å‰ç¼€â€™ï¼Œä½†é—æ†¾çš„æ˜¯è¿™ä¸ªåç¼€ä¸è¿™ä¸ªå‰ç¼€é‡å äº†ï¼Œæ‰€ä»¥ä¸èƒ½è®¡ç®—åœ¨å†…ã€‚åŒç†ï¼Œ$\mathrm{num}[1] = 0,\mathrm{num}[2] = \mathrm{num}[3] = 1,\mathrm{num}[5] = 2$ã€‚â€

ç‰¹åˆ«åœ°ï¼Œä¸ºäº†é¿å…å¤§é‡çš„è¾“å‡ºï¼Œä½ ä¸éœ€è¦è¾“å‡º $\mathrm{num}[i]$ åˆ†åˆ«æ˜¯å¤šå°‘ï¼Œä½ åªéœ€è¦è¾“å‡ºæ‰€æœ‰ $(\mathrm{num}[i]+1)$ çš„ä¹˜ç§¯ï¼Œå¯¹ $10^9 + 7$ å–æ¨¡çš„ç»“æœå³å¯ã€‚

$n \le 5, L \le 1,000,000$

---

å³æ±‚å‡ºkmpçš„nextæ•°ç»„é™¤å»å‰ç¼€ä¸åç¼€é‡åˆçš„æƒ…å†µã€‚å³å¯¹äº$nxt_i,num_i=min(\lfloor\frac{i}{2}\rfloor,nxt_i)$ï¼Œå¯¹å—ï¼Ÿ

æ˜æ˜¾ä¸å¯¹ï¼

nxt_iè®°å½•çš„æ˜¯**å‰ç¼€iä¸­æœ€é•¿çš„sæ»¡è¶³sæ˜¯å‰ç¼€içš„å‰ç¼€ä¹Ÿæ˜¯å…¶åç¼€**ã€‚å³nxt_iè®°å½•çš„æ˜¯é•¿åº¦ï¼ä½†æ˜¯numè®°å½•çš„æ˜¯ä¸ªæ•°ï¼

æˆ‘ä»¬å…ˆä¸è€ƒè™‘ä¸é‡å è¿™ä¸ªæ¡ä»¶ï¼Œæ±‚å‡ºå¼±åŒ–ç‰ˆçš„num'ã€‚

é‚£ä¹ˆnum'æ€ä¹ˆæ±‚å‘¢ï¼Ÿå¾ˆæ˜æ˜¾å¯¹äºå‰ç¼€iï¼Œå…¶æ‰€æœ‰æ»¡è¶³Q(nxt)-Q(æœ€é•¿)ï¼ˆè¿™é‡Œçš„Qä»£è¡¨æ€§è´¨é—´çš„è¿ç®—ï¼‰çš„sé•¿åº¦çš„é›†åˆå³$\{nxt_i,nxt_{nxt_i},\dots\}$ã€‚ä¸ºä»€ä¹ˆï¼Ÿå¦‚å›¾æ‰€ç¤ºã€‚

![image.png](ç®—æ³•å¿«é—ª/image 3.png)

æ‰€ä»¥ä¸€ç§å¯è¡Œçš„æ–¹æ³•æ˜¯æˆ‘ä»¬ä»nxt_iä¸€ç›´å¾€ä¸‹é€’æ¨ã€‚

è€ƒè™‘é™åˆ¶ï¼Œæˆ‘ä»¬å°±æ˜¯ä¸€ç›´å¾€ä¸‹é€’æ¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­é€’æ¨åˆ°çš„éƒ½æ˜¯æœ‰é‡å çš„ã€‚ç›´åˆ°nxt_{x}â‰¤\frac{i}{2}ï¼Œæ­¤æ—¶å¼€å§‹æ²¡æœ‰é‡å äº†ï¼Œåˆ™ç»§ç»­å¾€ä¸‹å¯ä»¥é€’æ¨å‡ å±‚ï¼Œç­”æ¡ˆå°±æ˜¯å‡ ã€‚

ä½†å‡å¦‚æˆ‘ä»¬æ‹¿åˆ°çš„ä¸²æ˜¯ä¸€å †`a`ï¼Œé‚£ä¹ˆä¸Šé¢é‚£ä¸ªç®—æ³•å°±ä¼šè¢«å¡æˆO(n^2)

æ•…æˆ‘ä»¬è¦æ”¾åœ¨æ±‚è§£nxtçš„æ–¹æ³•æ¥æ±‚è§£num

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define ull unsigned long long
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}

const int N=1e6+5;
const int M=5e4+5;
const int INF=2e9+5;
const int MOD=1e9+7;
const int BASE=17737;
bool f1;
int n,m;

int nxt[N],nxt_[N];
int ans;
string s;


signed main(){
	int T=rd;
	while(T--){
		cin>>s;
		n=s.size();
		memset(nxt,0,sizeof nxt);

		nxt_[0]=0;nxt_[1]=1;
		for(int i=1,j=0;i<=n;i++){
			while(j&&s[i]!=s[j]) j=nxt[j];
			if(s[i]==s[j]) j++;
			nxt[i+1]=j;
			nxt_[i+1]=nxt_[j]+1;
		
		}
		ans=1;

		for(int i=1,j=0;i<=n;i++){
			while(j&&s[i]!=s[j]) j=nxt[j];
			j+=s[i]==s[j];
			while(j*2>1+i) j=nxt[j];
			ans=(ans*(nxt_[j]+1))%MOD;
		}
		cout<<ans<<endl;
	}
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### ğŸ˜”ACè‡ªåŠ¨æœº



## å€å¢ LCA RMQ

### LCA | [AHOI2008] ç´§æ€¥é›†åˆ / èšä¼š

æ¬¢ä¹å²›ä¸Šæœ‰ä¸ªéå¸¸å¥½ç©çš„æ¸¸æˆï¼Œå«åšâ€œç´§æ€¥é›†åˆâ€ã€‚åœ¨å²›ä¸Šåˆ†æ•£æœ‰ $n$ ä¸ªç­‰å¾…ç‚¹ï¼Œæœ‰ $n-1$ æ¡é“è·¯è¿æ¥ç€å®ƒä»¬ï¼Œæ¯ä¸€æ¡é“è·¯éƒ½è¿æ¥æŸä¸¤ä¸ªç­‰å¾…ç‚¹ï¼Œä¸”é€šè¿‡è¿™äº›é“è·¯å¯ä»¥èµ°éæ‰€æœ‰çš„ç­‰å¾…ç‚¹ï¼Œé€šè¿‡é“è·¯ä»ä¸€ä¸ªç‚¹åˆ°å¦ä¸€ä¸ªç‚¹è¦èŠ±è´¹ä¸€ä¸ªæ¸¸æˆå¸ã€‚

å‚åŠ æ¸¸æˆçš„äººä¸‰äººä¸€ç»„ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰äººå‘˜å‡ä»»æ„åˆ†æ•£åœ¨å„ä¸ªç­‰å¾…ç‚¹ä¸Šï¼ˆæ¯ä¸ªç‚¹åŒæ—¶å…è®¸å¤šä¸ªäººç­‰å¾…ï¼‰ï¼Œæ¯ä¸ªäººå‡å¸¦æœ‰è¶³å¤Ÿå¤šçš„æ¸¸æˆå¸ï¼ˆç”¨äºæ”¯ä»˜ä½¿ç”¨é“è·¯çš„èŠ±è´¹ï¼‰ã€åœ°å›¾ï¼ˆæ ‡æ˜ç­‰å¾…ç‚¹ä¹‹é—´é“è·¯è¿æ¥çš„æƒ…å†µï¼‰ä»¥åŠå¯¹è¯æœºï¼ˆç”¨äºå’ŒåŒç»„çš„æˆå‘˜è”ç³»ï¼‰ã€‚å½“é›†åˆå·å¹å“åï¼Œæ¯ç»„æˆå‘˜ä¹‹é—´è¿…é€Ÿè”ç³»ï¼Œäº†è§£åˆ°è‡ªå·±ç»„æ‰€æœ‰æˆå‘˜æ‰€åœ¨çš„ç­‰å¾…ç‚¹åï¼Œè¿…é€Ÿåœ¨ $n$ ä¸ªç­‰å¾…ç‚¹ä¸­ç¡®å®šä¸€ä¸ªé›†ç»“ç‚¹ï¼Œç»„å†…æ‰€æœ‰æˆå‘˜å°†åœ¨è¯¥é›†åˆç‚¹é›†åˆï¼Œé›†åˆæ‰€ç”¨èŠ±è´¹æœ€å°‘çš„ç»„å°†æ˜¯æ¸¸æˆçš„èµ¢å®¶ã€‚

å°å¯å¯å’Œä»–çš„æœ‹å‹é‚€è¯·ä½ ä¸€èµ·å‚åŠ è¿™ä¸ªæ¸¸æˆï¼Œç”±ä½ æ¥é€‰æ‹©é›†åˆç‚¹ï¼Œèªæ˜çš„ä½ èƒ½å¤Ÿå®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œå¸®åŠ©å°å¯å¯èµ¢å¾—æ¸¸æˆå—ï¼Ÿ

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq x,y,z\leq n\leq 5\times10^5$ï¼Œ$1\leq m\leq 5\times 10^5$ã€‚

---

ç»“è®ºï¼šé›†ç»“ç‚¹åº”è¯¥åœ¨ä¸‰ä¸ªç‚¹çš„ä¸‰ä¸ªæœ€è¿‘å…¬å…±ç¥–å…ˆä¸­æ·±åº¦æœ€æ·±çš„é‚£ä¸ªç‚¹ä¸Šã€‚

```C++
/*////////ACACACACACACAC///////////
       . Earn knowledge .
/*////////ACACACACACACAC///////////

#include <bits/stdc++.h>
#define int long long
#define db double
#define rtn return
#define i1n    \
    int i = 1; \
    i <= n;    \
    i++
#define in1    \
    int i = n; \
    i >= 1;    \
    i--
using namespace std;

const int N = 5e5 + 5;
const int M = 1e5;
const int Mod = 1e5;
const int INF = 1e5;
vector<int> e[N];
int n, m, sum, ans1, dep[N], fa[N][22], k, tmp, ans2;
void add(int a, int b) { e[a].push_back(b); }
void dfs1(int u, int faa) {  //æ±‚æ·±åº¦

    dep[u] = dep[faa] + 1;
    for (int i = 1; i < 21; i++) fa[u][i] = fa[fa[u][i - 1]][i - 1];  // att!
    for (int i = 0; i < e[u].size(); i++) {
        int v = e[u][i];
        if (v == faa)
            continue;
        fa[v][0] = u;

        dfs1(v, u);
    }
}
int lca(int u, int v) {
    if (dep[u] < dep[v])
        swap(u, v);                  //è®©uæ›´æ·±
    for (int i = 20; i >= 0; i--) {  //å€å¢å¾€ä¸Šè·³ ï¼Œä¸è¦æš´åŠ›è·³
        if (dep[u] - (1 << i) >= dep[v])
            u = fa[u][i];
    }
    if (u == v)
        return u;
    for (int i = 20; i >= 0; i--) {  //å€å¢ä¸€èµ·å¾€ä¸Šè·³
        if (fa[u][i] != fa[v][i])
            u = fa[u][i], v = fa[v][i];
    }
    return fa[u][0];  //æ³¨æ„è¿”å›å€¼
}
signed main() {
    scanf("%lld%lld", &n, &m);  // use scanf pls,or u'll TLE
//	cin>>n>>m;
    for (int i = 1; i < n; i++) {
        int a, b;
        scanf("%lld%lld", &a, &b);
//		cin>>a>>b;
        add(a, b);
        add(b, a);
    }
    dfs1(1, 0);
    int l[4],ans;
    for (int i = 1; i <= m; i++) {
        int x,y,z;
        scanf("%lld%lld%lld", &x, &y,&z);
//		cin>>x>>y>>z;
        l[1]=lca(x,y),l[2]=lca(x,z),l[3]=lca(y,z);
        int id=1;
		for(int k=2;k<=3;k++){
        	if(dep[l[k]]>dep[l[id]])id=k;
		}
// 		cout<<l[id]<<' ';
		ans=dep[x]+dep[y]-2*dep[l[id]]+dep[z]+dep[l[id]];
		if(id==1)ans-=2*dep[lca(x,z)];
		if(id==2)ans-=2*dep[lca(x,y)];
		if(id==3)ans-=2*dep[lca(x,z)];
		printf("%lld %lld\n",l[id],ans);
		
		
    }
	
    return 0;
}
```

printfä¼˜åŒ–è¿˜æ˜¯æœ‰ç”¨çš„ï¼ï¼

### RMQ å•è°ƒé˜Ÿåˆ— | [HAOI2007] ç†æƒ³çš„æ­£æ–¹å½¢

æœ‰ä¸€ä¸ª $a \times b$ çš„æ•´æ•°ç»„æˆçš„çŸ©é˜µï¼Œç°è¯·ä½ ä»ä¸­æ‰¾å‡ºä¸€ä¸ª $n \times n$ çš„æ­£æ–¹å½¢åŒºåŸŸï¼Œä½¿å¾—è¯¥åŒºåŸŸæ‰€æœ‰æ•°ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼çš„å·®æœ€å°ã€‚

çŸ©é˜µä¸­çš„æ‰€æœ‰æ•°éƒ½ä¸è¶…è¿‡ $1,000,000,000$ã€‚

$20\%$ çš„æ•°æ® $2 \le a,b \le 100,n \le a,n \le b,n \le 10$ã€‚

$100\%$ çš„æ•°æ® $2 \le a,b \le 1000,n \le a,n \le b,n \le 100$ã€‚

---

æœ¬é¢˜ä¹Ÿå¯ä»¥ç”¨äºŒç»´STè¡¨é€šè¿‡ã€‚è§ä¸‹æ–¹åšå®¢

[www.luogu.com.cn](https://www.luogu.com.cn/blog/user22127/solution-p2216)


---

æˆ‘ä»¬ç”¨ä¸¤æ¬¡å•è°ƒé˜Ÿåˆ—æ¥ç»´æŠ¤ç­”æ¡ˆã€‚

ä»¥æœ€å¤§å€¼ä¸ºä¾‹ã€‚æˆ‘ä»¬å…ˆå¯¹åŸæ•°ç»„çš„ç¬¬iè¡ŒåŒºé—´[j,j+n-1]è®¡ç®—å‡ºåŒºé—´$\max$ä¸º$mx_{i,j}$ã€‚ç„¶åå¯¹$mx$æ•°ç»„çš„ç¬¬jåˆ—[i,i+n-1]è¡Œè®¡ç®—å‡ºåŒºé—´$\max$ä¸º$qmx_{i,j}$ã€‚é‚£ä¹ˆ$qmx_{i,j}$å®é™…ä¸Šå°±æ˜¯çŸ©å½¢$[(i,j)(i+n-1,j+n-1)]$ä¸­çš„$\max$

```C++

```

äºŒç»´STè¡¨std

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define ull unsigned long long
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
// #define nl putc('\n')
#define ot write
#define nl putchar('\n')
inline int rd
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}

const int N=1e3+5;
const int M=5e4+5;
const int INF=2e9+5;
const int MOD=1e9+7;
const int BASE=17737;
bool f1;
int n,m;

int mx[N][N],mn[N][N],qmx[N][N],qmn[N][N];
int b;


const int maxlog = 10;

int a, s;
int lg;
int c[N][N],mxx[N][N], mnn[N][N];;
int ans = INF;

int query (int x, int y){
    int mx = 0, mn = 0;
    mx = max(mxx[x][y], max(mxx[x+n-(1<<lg)][y+n-(1<<lg)], max(mxx[x+n-(1<<lg)][y], mxx[x][y+n-(1<<lg)])));
    mn = min(mnn[x][y], min(mnn[x+n-(1<<lg)][y+n-(1<<lg)], min(mnn[x+n-(1<<lg)][y], mnn[x][y+n-(1<<lg)])));
    return mx - mn;
}

signed main (){
    a=rd,b=rd,n=rd;
    for (int i = 0; i < a; i++)
        for (int j = 0; j < b; j++) {
            scanf("%d", &c[i][j]);
            mxx[i][j] = mnn[i][j] = c[i][j];
        }
    
    for (lg = 0; ((1<<(lg+1)) <= n); lg++);
    for (int k = 0; k < lg; k++)
        for (int i = 0; i+(1<<k) < a; i++)
            for (int j = 0; j+(1<<k) < b; j++) {
                mxx[i][j] = max(mxx[i][j], max(mxx[i+(1<<k)][j+(1<<k)], max(mxx[i+(1<<k)][j], mxx[i][j+(1<<k)])));
                mnn[i][j] = min(mnn[i][j], min(mnn[i+(1<<k)][j+(1<<k)], min(mnn[i+(1<<k)][j], mnn[i][j+(1<<k)])));
            }
    
    for (int i = 0; i <= a-n; i++)
        for (int j = 0; j <= b-n; j++)
            ans = min(ans, query(i, j));
    
    cout << ans;
    fclose(stdin);
    return 0;
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

### STè¡¨ | [JRKSJ R2] 01 åºåˆ—

STè¡¨å°±æ˜¯æˆ‘ä»¬è¦æ‰¾åˆ°ä¸¤ä¸ªåŒºé—´ï¼Œå¯ä»¥è¦†ç›–å®¹æ˜“åŒºé—´[l,r]ã€‚é‚£ä¹ˆå‘ç°å°±æ˜¯[l,l+upbit(len)å’Œ[r-upbit(len),r]äº†ã€‚å¯¹äºæ¯ä¸ªlï¼Œæˆ‘ä»¬å¯ä»¥é¢„å¤„ç†å‡ºst_{l,i}è¡¨ç¤º[l,l+2^i]çš„åŒºé—´ä¿¡æ¯ã€‚å€å¢å¤„ç†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(2n\log n)$

upbit(x)æ˜¯xçš„æœ€é«˜ä½1ä»£è¡¨çš„åè¿›åˆ¶æ•°ã€‚

---

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ $01$ åºåˆ— $a$ï¼Œ$m$ æ¬¡è¯¢é—®ï¼Œæ”¯æŒ $2$ ç§è¯¢é—®ï¼š

- `1 l r` è¡¨ç¤ºè¯¢é—® $l$ åˆ° $r$ åŒºé—´çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—çš„é•¿åº¦ã€‚

- `2 l r` è¡¨ç¤ºè¯¢é—® $l$ åˆ° $r$ åŒºé—´çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n\le 10^6$ï¼Œ$1\le m\le 5\times10^6$ï¼Œ$0\le a_i\le 1$ã€‚

---

æœ¬é¢˜è¾“å…¥è¾“å‡ºé‡æå¤§ï¼Œè¿™é‡Œç»™å‡ºå‡ºé¢˜äººä½¿ç”¨çš„å¿«è¯»å¿«å†™ã€‚ï¼ˆå½“ç„¶ï¼Œä½¿ç”¨æ‚¨è‡ªå·±ç¼–å†™çš„å¤§æ¦‚ç‡ä¹Ÿèƒ½é€šè¿‡ï¼‰

```C++
namespace IO{//by cyffff
	int len=0;
	char ibuf[(1<<20)+1],*iS,*iT,out[(1<<26)+1];
	#define gh() (iS==iT?iT=(iS=ibuf)+fread(ibuf,1,(1<<20)+1,stdin),(iS==iT?EOF:*iS++):*iS++)
	#define reg register
	inline int read(){
		reg char ch=gh();
		reg int x=0;
		reg char t=0;
		while(ch<'0'||ch>'9')   t|=ch=='-',ch=gh();
		while(ch>='0'&&ch<='9') x=x*10+(ch^48),ch=gh();
		return t?-x:x;
	}
	inline void putc(char ch){
		out[len++]=ch;
	}
	template<class T>
	inline void write(T x){
		if(x<0)putc('-'),x=-x;
		if(x>9)write(x/10);
		out[len++]=x%10+48;
	}
	inline void flush(){
		fwrite(out,1,len,stdout);
		len=0;
	}
}
using IO::read;
using IO::write;
using IO::flush;
using IO::putc;
```

ä½¿ç”¨è¿™ç§å¿«è¯»å¿«å†™è¯»å…¥ä¸€ä¸ªæ•° $x$ æ—¶è¯·ä½¿ç”¨è¯­å¥ `x=read();`ï¼Œè¾“å‡ºæ—¶ä½¿ç”¨è¯­å¥ `write(x);`ã€‚æ³¨æ„ï¼Œæ¢è¡Œæ—¶éœ€ä½¿ç”¨è¯­å¥ `putc('\n');`ï¼Œç¨‹åºæ‰§è¡Œç»“æŸæ—¶ä½¿ç”¨è¯­å¥ `flush();`ã€‚

åœ¨ä½¿ç”¨æ­¤å¿«è¯»æ—¶è¯·åŠ ä¸Š `#include<bits/stdc++.h>`ã€‚

å¦‚æœæœ¬åœ°æ— æ³•è¾“å…¥ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ [è¿™é‡Œçš„å¿«è¯»å¿«å†™](https://www.luogu.com.cn/paste/6za5gs1z)ã€‚

è‹¥ä»çœ‹ä¸æ‡‚ï¼Œè¯·åœ¨èµ›æ—¶ç­”ç–‘å¸–å›å¤/ç§ä¿¡å‡ºé¢˜äººã€‚

ç”±äºå‡ºé¢˜äººåªä¼š `C++`ï¼Œæœ¬å¤„æ— æ³•ç»™å‡ºå…¶ä»–è¯­è¨€çš„å¿«è¯»å¿«å†™ï¼Œæ·±æ„Ÿæ­‰æ„ã€‚

---

è®¾ $pre_{x,i}=\sum_{j=1}^i[a_i=x]$ï¼Œï¼ˆ$0\le x\le1$ï¼Œ$1\le i\le n$ï¼‰ã€‚

ç¬¬ä¸€é—®ï¼š

å…¶å®æœ¬è´¨æ˜¯æ±‚ $\max_{i=l}^r( pre_{0,i}-pre_{0,l-1}+pre_{1,r}-pre_{1,i})$ã€‚

æ€ä¹ˆç†è§£è¿™ä¸ªæŸ¿å­å‘¢ï¼Ÿæ˜¾ç„¶ $pre$ æ˜¯å‰ç¼€å’Œçš„å½¢å¼ï¼Œæ‰€ä»¥ $pre_{0,i}-pre_{0,l-1}$ å³ $\sum_{j=l}^i[a_i=0]$ï¼Œ$pre_{1,r}-pre_{1,i}$ å³ $\sum_{j=i+1}^r[a_i=1]$ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ $i$ ä¸ºåˆ†ç•Œçº¿ï¼Œåˆ†ç•Œçº¿å‰é€‰ $0$ï¼Œåˆ†ç•Œçº¿åé€‰ $1$ï¼Œæšä¸¾æ‰€æœ‰ $l\le i\le r$ï¼Œæ˜¾ç„¶å¯ä»¥å–åˆ°æœ€å¤§å€¼ï¼Œæ—¶é—´å¤æ‚åº¦ $O(mn)$ã€‚

è¿˜éœ€è¦ç‰¹åˆ¤åªé€‰ $1$ çš„æƒ…å†µï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥çœ‹ä¸ºæ±‚ $\displaystyle\max_{i=l-1}^rpre_{0,i}-pre_{0,l-1}+pre_{1,r}-pre_{1,i}$ã€‚

ä¸Šé¢é‚£ä¸ªä¸œè¥¿å¯ä»¥å¥—è·¯STè¡¨å¤„ç†ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n\log n+m)$ï¼ŒæœŸæœ›å¾—åˆ† $100\text{pts}$ã€‚

å½“ç„¶å¼€ $2$ ä¸ªSTè¡¨å¸¸æ•°è¾ƒå¤§ã€‚

ç”¨ `+1-1RMQ` å¯ä»¥åšåˆ°ä¸¥æ ¼ $O(n+m)$ï¼Œå¸¸æ•°è¾ƒå¤§ï¼Œä¸åšä¸ºæœ¬é¢˜æœ€ä¼˜åšæ³•ã€‚

ä¸€ä¸ªå‡å°å¸¸æ•°æ–¹æ³•ï¼š

å‘ç°ç¬¬äºŒé—®åªæœ‰ $1$ å’Œ $2$ ä¸¤ç§ç­”æ¡ˆï¼Œè¦æœ‰ $2$ åˆ™åŒºé—´ä¸­å¿…é¡»å‡ºç°è¿ç»­çš„ $0-1$ï¼Œäºæ˜¯æˆ‘ä»¬ç»´æŠ¤ $0-1$ å‡ºç°æ¬¡æ•°çš„å‰ç¼€å’Œï¼Œå¦‚æœå·¦ç«¯ç‚¹å‰ç¼€å’Œç­‰äºå³ç«¯ç‚¹å‰ç¼€å’Œï¼Œåˆ™ç­”æ¡ˆä¸º $1$ï¼Œå¦åˆ™ä¸º $2$ã€‚å¯ä»¥å¤§å¤§å‡å°å¸¸æ•°ï¼Œå¦‚æœå®ç°ä¼˜ç§€ï¼Œåˆ™å¯ä»¥æ‰€æœ‰ç‚¹è¿› 1sã€‚

---

ä¸å†™freadä¼šTLE1ç‚¹ï¼Œç”¨å¿«è¯»ä¹Ÿä¸è¡Œã€‚

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long
#define ull unsigned long long
#define pii pair<int, int>
#define pf first
#define ps second

#define rd read()
#define nl putc('\n')
#define ot write
// #define nl putchar('\n')
// inline int rd
// {
// 	int xx=0,ff=1;
// 	char ch=getchar();
// 	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
// 	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
// 	return xx*ff;
// }
// inline void write(int out)
// {
// 	if(out<0) putchar('-'),out=-out;
// 	if(out>9) write(out/10);
// 	putchar(out%10+'0');
// }

namespace IO{//by cyffff
	int len=0;
	char ibuf[(1<<20)+1],*iS,*iT,out[(1<<26)+1];
	#define gh() (iS==iT?iT=(iS=ibuf)+fread(ibuf,1,(1<<20)+1,stdin),(iS==iT?EOF:*iS++):*iS++)
	#define reg register
	inline int read(){
		reg char ch=gh();
		reg int x=0;
		reg char t=0;
		while(ch<'0'||ch>'9')   t|=ch=='-',ch=gh();
		while(ch>='0'&&ch<='9') x=x*10+(ch^48),ch=gh();
		return t?-x:x;
	}
	inline void putc(char ch){
		out[len++]=ch;
	}
	template<class T>
	inline void write(T x){
		if(x<0)putc('-'),x=-x;
		if(x>9)write(x/10);
		out[len++]=x%10+48;
	}
	inline void flush(){
		fwrite(out,1,len,stdout);
		len=0;
	}
}
using IO::read;
using IO::write;
using IO::flush;
using IO::putc;

const int N=1e6+5;
const int M=5e4+5;
const int INF=2e9+5;
const int MOD=1e9+7;
const int BASE=17737;
bool f1;
int n,m;

int pre0[N],pre1[N],qz[N];
int lg[N],st[N][20];
int a[N],b[N];
int ans;
string s;

void init(){
	for(int i=2;i<=n;i++){
		lg[i]=lg[i>>1]+1;
		st[i][0]=b[i];
	}
	for(int i=1;i<=19;i++){
		for(int j=1;j+(1<<i)-1<=n;j++){
			st[j][i]=max(st[j][i-1],st[j+(1<<(i-1))][i-1]);
		}
	}

}


signed main(){
	n=rd;m=rd;
	
	for(int i=1;i<=n;i++)a[i]=rd;
	for(int i=1;i<=n;i++)pre0[i]=pre0[i-1]+(a[i]==0);
	for(int i=1;i<=n;i++)pre1[i]=pre1[i-1]+(a[i]==1);
	for(int i=1;i<=n;i++)b[i]=pre0[i]-pre1[i];
	for(int i=2;i<=n;i++){
		qz[i]=qz[i-1];
		if(a[i]==1&&a[i-1]==0)qz[i]++;
	}

	init();

	while(m--){
		int op=rd,l=rd,r=rd;
		if(op==1){
			int k=lg[r-l+1];
			ot(max(pre1[r]-pre1[l-1],max(st[l][k],st[r-(1<<k)+1][k])-pre0[l-1]+pre1[r]));
          //è®°å¾—è¿˜æœ‰åªé€‰1çš„æƒ…å†µï¼ï¼
			nl;
		}else{
			if(qz[r]-qz[l])ot(2);
			else ot(1);
			nl;
		}

	}
	flush();
}
/*
2 5
0 1 1 1 1
0 1 1 2 4
0 2 1 2 1
0 2 1 1 4
*/
```

day3

## æœç´¢

### æš´åŠ›æœç´¢&ç åŠ›å·¨æœ | [NOIP2011 æé«˜ç»„] Mayan æ¸¸æˆ

Mayan puzzle æ˜¯æœ€è¿‘æµè¡Œèµ·æ¥çš„ä¸€ä¸ªæ¸¸æˆã€‚æ¸¸æˆç•Œé¢æ˜¯ä¸€ä¸ª$7$ è¡Œ $\times5$ åˆ—çš„æ£‹ç›˜ï¼Œä¸Šé¢å †æ”¾ç€ä¸€äº›æ–¹å—ï¼Œæ–¹å—ä¸èƒ½æ‚¬ç©ºå †æ”¾ï¼Œå³æ–¹å—å¿…é¡»æ”¾åœ¨æœ€ä¸‹é¢ä¸€è¡Œï¼Œæˆ–è€…æ”¾åœ¨å…¶ä»–æ–¹å—ä¹‹ä¸Šã€‚æ¸¸æˆé€šå…³æ˜¯æŒ‡åœ¨è§„å®šçš„æ­¥æ•°å†…æ¶ˆé™¤æ‰€æœ‰çš„æ–¹å—ï¼Œæ¶ˆé™¤æ–¹å—çš„è§„åˆ™å¦‚ä¸‹ï¼š

1. æ¯æ­¥ç§»åŠ¨å¯ä»¥ä¸”ä»…å¯ä»¥æ²¿æ¨ªå‘ï¼ˆå³å‘å·¦æˆ–å‘å³ï¼‰æ‹–åŠ¨æŸä¸€æ–¹å—ä¸€æ ¼ï¼šå½“æ‹–åŠ¨è¿™ä¸€æ–¹å—æ—¶ï¼Œå¦‚æœæ‹–åŠ¨ååˆ°è¾¾çš„ä½ç½®ï¼ˆä»¥ä¸‹ç§°ç›®æ ‡ä½ç½®ï¼‰ä¹Ÿæœ‰æ–¹å—ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹å—å°†äº¤æ¢ä½ç½®ï¼ˆå‚è§è¾“å…¥è¾“å‡ºæ ·ä¾‹è¯´æ˜ä¸­çš„å›¾ $6$ åˆ°å›¾ $7$ï¼‰ï¼›å¦‚æœç›®æ ‡ä½ç½®ä¸Šæ²¡æœ‰æ–¹å—ï¼Œé‚£ä¹ˆè¢«æ‹–åŠ¨çš„æ–¹å—å°†ä»åŸæ¥çš„ç«–åˆ—ä¸­æŠ½å‡ºï¼Œå¹¶ä»ç›®æ ‡ä½ç½®ä¸Šæ‰è½ï¼ˆç›´åˆ°ä¸æ‚¬ç©ºï¼Œå‚è§ä¸‹é¢å›¾ $1$ å’Œå›¾ $2$ï¼‰ï¼›

![https://cdn.luogu.com.cn/upload/pic/103.png](ç®—æ³•å¿«é—ª/103.png)

1. ä»»ä¸€æ—¶åˆ»ï¼Œå¦‚æœåœ¨ä¸€æ¨ªè¡Œæˆ–è€…ç«–åˆ—ä¸Šæœ‰è¿ç»­ä¸‰ä¸ªæˆ–è€…ä¸‰ä¸ªä»¥ä¸Šç›¸åŒé¢œè‰²çš„æ–¹å—ï¼Œåˆ™å®ƒä»¬å°†ç«‹å³è¢«æ¶ˆé™¤ï¼ˆå‚è§å›¾1 åˆ°å›¾3ï¼‰ã€‚

![https://cdn.luogu.com.cn/upload/pic/102.png](ç®—æ³•å¿«é—ª/102.png)

æ³¨æ„ï¼š

a) å¦‚æœåŒæ—¶æœ‰å¤šç»„æ–¹å—æ»¡è¶³æ¶ˆé™¤æ¡ä»¶ï¼Œå‡ ç»„æ–¹å—ä¼šåŒæ—¶è¢«æ¶ˆé™¤ï¼ˆä¾‹å¦‚ä¸‹é¢å›¾ $4$ï¼Œä¸‰ä¸ªé¢œè‰²ä¸º $1$ çš„æ–¹å—å’Œä¸‰ä¸ªé¢œè‰²ä¸º $2$ çš„æ–¹å—ä¼šåŒæ—¶è¢«æ¶ˆé™¤ï¼Œæœ€åå‰©ä¸‹ä¸€ä¸ªé¢œè‰²ä¸º $2$ çš„æ–¹å—ï¼‰ã€‚

b) å½“å‡ºç°è¡Œå’Œåˆ—éƒ½æ»¡è¶³æ¶ˆé™¤æ¡ä»¶ä¸”è¡Œåˆ—å…±äº«æŸä¸ªæ–¹å—æ—¶ï¼Œè¡Œå’Œåˆ—ä¸Šæ»¡è¶³æ¶ˆé™¤æ¡ä»¶çš„æ‰€æœ‰æ–¹å—ä¼šè¢«åŒæ—¶æ¶ˆé™¤ï¼ˆä¾‹å¦‚ä¸‹é¢å›¾5 æ‰€ç¤ºçš„æƒ…å½¢ï¼Œ$5$ ä¸ªæ–¹å—ä¼šåŒæ—¶è¢«æ¶ˆé™¤ï¼‰ã€‚

1. æ–¹å—æ¶ˆé™¤ä¹‹åï¼Œæ¶ˆé™¤ä½ç½®ä¹‹ä¸Šçš„æ–¹å—å°†æ‰è½ï¼Œæ‰è½åå¯èƒ½ä¼šå¼•èµ·æ–°çš„æ–¹å—æ¶ˆé™¤ã€‚æ³¨æ„ï¼šæ‰è½çš„è¿‡ç¨‹ä¸­å°†ä¸ä¼šæœ‰æ–¹å—çš„æ¶ˆé™¤ã€‚

ä¸Šé¢å›¾ $1$ åˆ°å›¾ $3$ ç»™å‡ºäº†åœ¨æ£‹ç›˜ä¸Šç§»åŠ¨ä¸€å—æ–¹å—ä¹‹åæ£‹ç›˜çš„å˜åŒ–ã€‚æ£‹ç›˜çš„å·¦ä¸‹è§’æ–¹å—çš„åæ ‡ä¸º $(0,0)$ï¼Œå°†ä½äº $(3,3)$ çš„æ–¹å—å‘å·¦ç§»åŠ¨ä¹‹åï¼Œæ¸¸æˆç•Œé¢ä»å›¾ $1$ å˜æˆå›¾ $2$ æ‰€ç¤ºçš„çŠ¶æ€ï¼Œæ­¤æ—¶åœ¨ä¸€ç«–åˆ—ä¸Šæœ‰è¿ç»­ä¸‰å—é¢œè‰²ä¸º $4$ çš„æ–¹å—ï¼Œæ»¡è¶³æ¶ˆé™¤æ¡ä»¶ï¼Œæ¶ˆé™¤è¿ç»­ $3$ å—é¢œè‰²ä¸º $4$ çš„æ–¹å—åï¼Œä¸Šæ–¹çš„é¢œè‰²ä¸º $3$ çš„æ–¹å—æ‰è½ï¼Œå½¢æˆå›¾ $3$ æ‰€ç¤ºçš„å±€é¢ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$0<n \le 5$ã€‚

### éå†æ ‘ | [POI2008] STA-Station

ç»™å®šä¸€ä¸ª $n$ ä¸ªç‚¹çš„æ ‘ï¼Œè¯·æ±‚å‡ºä¸€ä¸ªç»“ç‚¹ï¼Œä½¿å¾—ä»¥è¿™ä¸ªç»“ç‚¹ä¸ºæ ¹æ—¶ï¼Œæ‰€æœ‰ç»“ç‚¹çš„æ·±åº¦ä¹‹å’Œæœ€å¤§ã€‚

ä¸€ä¸ªç»“ç‚¹çš„æ·±åº¦ä¹‹å®šä¹‰ä¸ºè¯¥èŠ‚ç‚¹åˆ°æ ¹çš„ç®€å•è·¯å¾„ä¸Šè¾¹çš„æ•°é‡ã€‚

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1 \leq n \leq 10^6$ï¼Œ$1 \leq u, v \leq n$ï¼Œç»™å‡ºçš„æ˜¯ä¸€æ£µæ ‘ã€‚

### BFS | [USACO07OCT] Obstacle Course S

$N\times N\ (1\le N\le 100)$ æ–¹æ ¼ä¸­ï¼Œ$\verb!x!$ è¡¨ç¤ºä¸èƒ½è¡Œèµ°çš„æ ¼å­ï¼Œ$\verb!.!$ è¡¨ç¤ºå¯ä»¥è¡Œèµ°çš„æ ¼å­ã€‚å¡é—¨å¾ˆèƒ–ï¼Œæ•…è€Œä¸å¥½è½¬å¼¯ã€‚ç°åœ¨è¦ä» $A$ ç‚¹èµ°åˆ° $B$ ç‚¹ï¼Œè¯·é—®æœ€å°‘è¦è½¬ $90$ åº¦å¼¯å¤šå°‘æ¬¡ï¼Ÿ

```C++
. . B x . 
. x x A . 
. . . x . 
. x . . . 
. . x . . 
```

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œä¿è¯ $2\le N\le 100$ã€‚

### BFSä¸DFSæ€§è´¨æ¢ç©¶ | [NOI2013] æ ‘çš„è®¡æ•°

æˆ‘ä»¬çŸ¥é“ä¸€æ£µæœ‰æ ¹æ ‘å¯ä»¥è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰ä»¥åŠå¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰æ¥ç”Ÿæˆè¿™æ£µæ ‘çš„ DFS åºä»¥åŠ BFS åºã€‚ä¸¤æ£µä¸åŒçš„æ ‘çš„ DFS åºæœ‰å¯èƒ½ç›¸åŒï¼Œå¹¶ä¸”å®ƒä»¬çš„ BFS åºä¹Ÿæœ‰å¯èƒ½ç›¸åŒï¼Œä¾‹å¦‚ä¸‹é¢ä¸¤æ£µæ ‘çš„ DFS åºéƒ½æ˜¯ `1 2 4 5 3`ï¼ŒBFS åºéƒ½æ˜¯ `1 2 3 4 5`ã€‚

![https://cdn.luogu.com.cn/upload/image_hosting/kagmha60.png](ç®—æ³•å¿«é—ª/kagmha60.png)

ç°ç»™å®šä¸€ä¸ª DFS åºå’Œ BFS åºï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“ï¼Œç¬¦åˆæ¡ä»¶çš„æœ‰æ ¹æ ‘ä¸­ï¼Œæ ‘çš„é«˜åº¦çš„å¹³å‡å€¼ã€‚å³ï¼Œå‡å¦‚å…±æœ‰ $K$ æ£µä¸åŒçš„æœ‰æ ¹æ ‘å…·æœ‰è¿™ç»„ DFS åºå’Œ BFS åºï¼Œä¸”ä»–ä»¬çš„é«˜åº¦åˆ†åˆ«æ˜¯ $h_1, h_2, \ldots, h_K$ï¼Œé‚£ä¹ˆè¯·ä½ è¾“å‡ºï¼š

$\frac{h_1+h_2+\ldots+h_K}K$

- å¯¹äº $100\%$ çš„æµ‹è¯•æ•°æ®ï¼Œæ»¡è¶³ï¼š$2 \le n \le 2 \times 10^5$ã€‚

```C++
/*////////ACACACACACACAC///////////
       . Code  by  Ntsc .
       . Earn knowledge .
/*////////ACACACACACACAC///////////

#include <bits/stdc++.h>
#define int long long
#define db double
#define rtn return
using namespace std;



#define rd read()
inline int read() {
    int xx = 0, ff = 1;
    char ch = getchar();
    while (ch < '0' || ch > '9') {
        if (ch == '-')
            ff = -1;
        ch = getchar();
    }
    while (ch >= '0' && ch <= '9') xx = xx * 10 + (ch - '0'), ch = getchar();
    return xx * ff;
}
inline void write(int out) {
    if (out < 0)
        putchar('-'), out = -out;
    if (out > 9)
        write(out / 10);
    putchar(out % 10 + '0');
}


const int N = 2e5+5;
const int M = 1e5;
const int MOD = 1e9+7;
const int INF = 1e9+5;

int n, m, t;
int cf[N],dfn[N],bfn[N],res,  cnt;
db ans;

void vis(int l,int r){
	cf[l]++,cf[r+1]--;
}

signed main() {
	n=rd;
	for(int i=1;i<=n;i++)dfn[rd]=i;
	for(int i=1;i<=n;i++)bfn[dfn[rd]]=i;
	
	for(int i=1;i<=n;i++)dfn[bfn[i]]=i;
	
	ans=1;vis(1,1);
	
	for(int i=1;i<n;i++){
		if(dfn[i]>dfn[i+1])ans+=1,vis(i,i);
		if(bfn[i]<bfn[i+1]-1)vis(bfn[i],bfn[i+1]-1);
	}
	for(int i=1;i<n;i++){
		res+=cf[i];	
		if(!res)ans+=0.5;
	}
	
	printf("%.3lf",ans+1);
	
}

```

day4

## åˆ†æ²»

> åˆ†æ²»åˆ†ç±»æ³›æ³›è€Œè°ˆï¼Œåªè¦æ±‚å®Œæˆé€†åºå¯¹çš„ç»ƒä¹ å³å¯ã€‚

### ğŸ˜”CDQåˆ†æ²» | [CQOI2011] åŠ¨æ€é€†åºå¯¹

å¯¹äºåºåˆ— $a$ï¼Œå®ƒçš„é€†åºå¯¹æ•°å®šä¹‰ä¸ºé›†åˆ
$\{(i,j)| i<j \wedge a_i > a_j \}$
ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚

ç°åœ¨ç»™å‡º $1\sim n$ çš„ä¸€ä¸ªæ’åˆ—ï¼ŒæŒ‰ç…§æŸç§é¡ºåºä¾æ¬¡åˆ é™¤ $m$ ä¸ªå…ƒç´ ï¼Œä½ çš„ä»»åŠ¡æ˜¯åœ¨æ¯æ¬¡åˆ é™¤ä¸€ä¸ªå…ƒç´ **ä¹‹å‰**ç»Ÿè®¡æ•´ä¸ªåºåˆ—çš„é€†åºå¯¹æ•°ã€‚

ã€æ•°æ®èŒƒå›´ã€‘
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n \le 10^5$ï¼Œ$1\le m \le 50000$ã€‚

### ç»å…¸åˆ†æ²»-å½’å¹¶æ’åº | æ±‚é€†åºå¯¹

```C++
#include <bits/stdc++.h>
using namespace std;
long long a[10000001],n,b[10000001],ans;
void msort(int l,int r){
	if(l==r)return;
	int mid=(l+r)/2,i=l,j=mid+1,k=l;
	msort(l,mid);msort(mid+1,r);
	while(i<=mid&&j<=r){
		if(a[i]<=a[j])b[k++]=a[i++];
		else {b[k++]=a[j++];ans+=mid-i+1;}
	}
	while(i<=mid)b[k++]=a[i++];
	while(j<=r)b[k++]=a[j++];
	for(int i=l;i<=r;i++)a[i]=b[i];
}
int main() {
	cin>>n;
	for(int i=1;i<=n;i++)scanf("%lld",&a[i]);
	msort(1,n);
	printf("%lld",ans);
	return 0;
}

```

### åˆ†æ²»åº”ç”¨ | ç”µé˜»ç½‘ç»œ

ä»€ä¹ˆæ˜¯ç”µé˜»?è¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ã€‚ä»€ä¹ˆæ˜¯ç”µè·¯?å¤§å®¶ä¹Ÿåº”è¯¥çŸ¥é“ã€‚ä½†æ˜¯æœ¬é¢˜å½“ä¸­ï¼Œç”µè·¯çš„å®šä¹‰æˆ–è®¸æœ‰ç‚¹ä¸åŒï¼š

ç”µè·¯éƒ½å¸¦æœ‰æ­£ã€è´Ÿææ¥ç‚¹ï¼Œæ­£æåœ¨å·¦ï¼Œè´Ÿæåœ¨å³ã€‚å…·ä½“åœ°ï¼šç”µè·¯åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

å•ç‹¬çš„ä¸€ä¸ª1Î©ç”µé˜»(åŠå…¶ä¸¤ç«¯çš„æ¥ç‚¹)æ˜¯ç”µè·¯(è™½ç„¶å¯¼çº¿ä¹Ÿå¯ä»¥è¢«è§†ä¸º0Î©çš„ç”µé˜»ï¼Œä½†æ˜¯å•ç‹¬çš„å¯¼çº¿ä¸æ˜¯ç”µè·¯)

å¦‚æœAå’ŒBéƒ½æ˜¯ç”µè·¯ï¼Œè®¾1,2,3æ˜¯ä»å·¦åˆ°å³çš„ä¸‰ä¸ªæ¥ç‚¹ï¼Œé‚£ä¹ˆå°†Açš„æ­£è´Ÿæåˆ†åˆ«æ¥åœ¨1ä¸2ä¸Šï¼Œå°†Bçš„æ­£è´Ÿæåˆ†åˆ«æ¥åœ¨2ä¸3ä¸Šï¼Œé‚£ä¹ˆ1åˆ°3çš„éƒ¨åˆ†æ˜¯ç”µè·¯ï¼Œå…¶ä¸­1ä¸ºæ­£æï¼Œ3ä¸ºè´Ÿæã€‚

å¦‚æœAå’ŒBéƒ½æ˜¯ç”µè·¯,è®¾1,2,3,2',3',1â€™æ˜¯å…­ä¸ªæ¥ç‚¹ï¼Œå…¶ä¸­1åœ¨2å’Œ3çš„å·¦ä¾§ï¼Œ2åœ¨2â€™çš„å·¦ä¾§ï¼Œ3åœ¨3â€™çš„å·¦ä¾§ï¼Œ2,å’Œ3,åœ¨1â€™çš„å·¦ä¾§ï¼Œå¹¶ä¸”1ä¸2ï¼Œ1ä¸3ï¼Œ2â€™ä¸1â€™ï¼Œ3â€™ä¸1â€™é—´å‡è¿æœ‰å¯¼çº¿, é‚£ä¹ˆå°†Açš„æ­£è´Ÿæåˆ†åˆ«æ¥åœ¨2ä¸2â€™ä¸Šï¼Œå°†Bçš„æ­£è´Ÿæåˆ†åˆ«æ¥åœ¨3ä¸3â€™ä¸Šï¼Œé‚£ä¹ˆ1åˆ°1'çš„éƒ¨åˆ†æ˜¯ç”µè·¯ï¼Œå…¶ä¸­1ä¸ºæ­£æï¼Œ1â€™ä¸ºè´Ÿæã€‚

ç°åœ¨ç»™å‡ºä¸€ä¸ªç”µè·¯ï¼Œæ±‚å®ƒæ­£è´Ÿæä¹‹é—´çš„ç”µé˜»ã€‚

é¢˜ç›®æè¿°

Cjwssbæœ€è¿‘åœ¨ç‰©ç†å­¦ç§‘ä¸Šé‡åˆ°äº†éš¾é¢˜ï¼Œä»–ä¸ä¼šè®¡ç®—ä¸€ä¸ªç”µè·¯ä¸­çš„æ€»ç”µé˜»ï¼Œç°åœ¨ä»–æ‰¾åˆ°äº†ä½ ï¼Œå¸Œæœ›ä½ èƒ½å¸®åŠ©ä»–ã€‚

è¿™ä¸ªç”µè·¯æœ‰å¦‚ä¸‹é™å®š

1ã€    ç”µè·¯åªç”±å¯¼çº¿ä»¥åŠç”µé˜»ä¸ºä¸€æ¬§çš„ç”µé˜»ç»„æˆ

2ã€    ä¿è¯ç”µè·¯ä»å·¦åˆ°å³è¿æ¥ï¼Œå³æ¯ä¸ªç”µé˜»æˆ–å¯¼çº¿çš„ä¸¤ä¸ªè¿æ¥ç‚¹xyä¿è¯x<y

3ã€    ä¿è¯æ¥çº¿æŸ±1ä¸ºç”µæºæ­£æï¼Œæ¥çº¿æŸ±nä¸ºç”µæºè´Ÿæ

4ã€    ä¿è¯æ¯ä¸ªæ¥çº¿æŸ±åªä¼šè¢«ä¸²è”æˆ–è€…å¹¶è”ä¸¤ä¸ªåˆ†æ”¯ç”µè·¯æˆ–è€…ä¸æ¥ä»»ä½•ç”µçº¿æˆ–ç”µé˜»

è¾“å…¥æ ¼å¼

ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ­£æ•´æ•°n,m,åˆ†åˆ«ä»£è¡¨æ¥ç‚¹æ•°å’Œç”µé˜»æ•°ã€‚ä¿è¯ç¼–å·å°çš„æ¥ç‚¹åœ¨ç¼–å·å¤§çš„æ¥ç‚¹çš„å·¦ä¾§ã€‚

æ¥ä¸‹æ¥mè¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•°ai,bi,ciï¼Œä»£è¡¨è¿™ä¸ªç”µé˜»è¿æ¥äº†aiä¸biæ¥ç‚¹ï¼Œå…¶é˜»å€¼ä¸ºci ï¼Œå…¶ä¸­ciåªå¯èƒ½æ˜¯0æˆ–1ï¼Œä¸”å¯¹äºä»»æ„çš„iï¼Œä¿è¯ai<biã€‚

è¾“å‡ºæ ¼å¼

è¾“å‡ºä¸€ä¸ªå®æ•°ï¼Œè¡¨ç¤ºæ€»çš„ç”µé˜»å€¼ï¼Œä¿ç•™ä¸‰ä½å°æ•°è¾“å‡ºã€‚

å¯¹äº100%çš„æ•°æ®nâ‰¤100,000,mâ‰¤120000

æ•°æ®æ˜¯åœ¨äººå·¥æŒ‡å®šçš„nä¸‹éšæœºç”Ÿæˆçš„ï¼Œä¿è¯ç­”æ¡ˆä¸ä¼šè¶…è¿‡10.000ã€‚

Byï¼šsaffah

## å…¶ä»–dp

### çŠ¶æ€å‹ç¼©dp | [è“æ¡¥æ¯ 2020 å›½ C] è¡¥ç»™

å°è“æ˜¯ä¸€ä¸ªç›´å‡é£æœºé©¾é©¶å‘˜ï¼Œä»–è´Ÿè´£ç»™å±±åŒºçš„ $n$ ä¸ªæ‘åº„è¿é€ç‰©èµ„ã€‚

æ¯ä¸ªæœˆï¼Œä»–éƒ½è¦åˆ°æ¯ä¸ªæ‘åº„è‡³å°‘ä¸€æ¬¡ï¼Œå¯ä»¥å¤šäºä¸€æ¬¡ï¼Œå°†æ‘åº„éœ€è¦çš„ç‰©èµ„è¿é€è¿‡å»ã€‚

æ¯ä¸ªæ‘åº„éƒ½æ­£å¥½æœ‰ä¸€ä¸ªç›´å‡æœºåœºï¼Œæ¯ä¸¤ä¸ªæ‘åº„ä¹‹é—´çš„è·¯ç¨‹éƒ½æ­£å¥½æ˜¯æ‘åº„ä¹‹é—´çš„ç›´çº¿è·ç¦»ã€‚

ç”±äºç›´å‡æœºçš„æ²¹ç®±å¤§å°æœ‰é™ï¼Œå°è“å•æ¬¡é£è¡Œçš„è·ç¦»ä¸èƒ½è¶…è¿‡ $D$ã€‚æ¯ä¸ªç›´å‡æœºåœºéƒ½æœ‰åŠ æ²¹ç«™ï¼Œå¯ä»¥ç»™ç›´å‡æœºåŠ æ»¡æ²¹ã€‚

æ¯ä¸ªæœˆï¼Œå°è“éƒ½æ˜¯ä»æ€»éƒ¨å‡ºå‘ï¼Œç»™å„ä¸ªæ‘åº„è¿é€å®Œç‰©èµ„åå›åˆ°æ€»éƒ¨ã€‚å¦‚æœæ–¹ä¾¿ï¼Œå°è“ä¸­é€”ä¹Ÿå¯ä»¥ç»è¿‡æ€»éƒ¨æ¥åŠ æ²¹ã€‚

æ€»éƒ¨ä½äºç¼–å·ä¸º $1$ çš„æ‘åº„ã€‚

è¯·é—®ï¼Œè¦å®Œæˆä¸€ä¸ªæœˆçš„ä»»åŠ¡ï¼Œå°è“è‡³å°‘è¦é£è¡Œå¤šé•¿è·ç¦»ï¼Ÿ

è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $n$ï¼Œ$D$ï¼Œåˆ†åˆ«è¡¨ç¤ºæ‘åº„çš„æ•°é‡å’Œå•æ¬¡é£è¡Œçš„è·ç¦»ã€‚

æ¥ä¸‹æ¥ $n$ è¡Œæè¿°æ‘åº„çš„ä½ç½®ï¼Œå…¶ä¸­ç¬¬ $i$ è¡Œä¸¤ä¸ªæ•´æ•° $x_i$ï¼Œ$y_i$ åˆ†åˆ«è¡¨ç¤ºç¼–å·ä¸º $i$ çš„æ‘åº„çš„åæ ‡ã€‚æ‘åº„ $i$ å’Œæ‘åº„ $j$ ä¹‹é—´çš„è·ç¦»ä¸º $\sqrt{(x_i-x_j)^2+(y_i-y_j)^2}$ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ï¼Œ$1\le n\le20,1\le x_i,y_i\le10^4,1\le D\le10^5$ã€‚

è“æ¡¥æ¯ 2020 å¹´å›½èµ› C ç»„ I é¢˜ã€‚

---

é¦–å…ˆä¸¤ä¸ªæ‘åº„ä¹‹é—´çš„è·ç¦»ä¸æ˜¯$\sqrt{(x_i-x_j)^2+(y_i-y_j)^2}$ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰Dé™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æƒ³è¦ç»è¿‡è‹¥å¹²ä¸ªæ‘åº„ä¸­è½¬çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å…ˆä¸€è¾¹floydæ±‚å„ä¸ªæ‘åº„ä¹‹é—´çš„æœ€çŸ­è·¯ï¼Œç„¶åè·‘çŠ¶æ€å‹ç¼©dpã€‚

ç„¶å f[s][i] è¡¨ç¤ºç»è¿‡æ‘åº„çŠ¶æ€ä¸º sï¼Œå½“å‰ç‚¹ä¸º i æ—¶çš„æœ€çŸ­è·ç¦»ï¼Œç­”æ¡ˆä¸ºï¼š$\min_{i=1}^n â€‹(f[2nâˆ’1][i]+dis[i][0])$ã€‚

æ³¨æ„å–„äºè®¡ç®—ç©ºé—´ï¼Œæœ¬é¢˜å¡ç©ºé—´æ­»æ­»çš„ï¼Œä¹Ÿè¦æ³¨æ„ç‚¹ç¼–å·ä»0å¼€å§‹ï¼Œå› ä¸ºäºŒè¿›åˆ¶ï¼ˆè¢«å‹ç¼©çš„çŠ¶æ€ï¼‰ä»0ä½å¼€å§‹ã€‚

dpåˆ†æ

å¾…ç»­

```C++
/*////////ACACACACACACAC///////////
       . Code  by  Ntsc .
       . Earn knowledge .
/*////////ACACACACACACAC///////////

#include <bits/stdc++.h>
#define int long long
#define db double
#define rtn return
using namespace std;



#define rd read()
inline int read() {
    int xx = 0, ff = 1;
    char ch = getchar();
    while (ch < '0' || ch > '9') {
        if (ch == '-')
            ff = -1;
        ch = getchar();
    }
    while (ch >= '0' && ch <= '9') xx = xx * 10 + (ch - '0'), ch = getchar();
    return xx * ff;
}
inline void write(int out) {
    if (out < 0)
        putchar('-'), out = -out;
    if (out > 9)
        write(out / 10);
    putchar(out % 10 + '0');
}


const int N = 20;
const int M = 1e5;
const int MOD = 1e9+7;
const int INF = 1e9+5;

int n, m,D;
db x[N],y[N];
double dis[N][N], f[1<<N][N], ans=INF;


db cal(db a,db b,db x,db y){
	return sqrt(1.00*(a-x)*(a-x)+1.00*(b-y)*(b-y));
}

signed main() {
//    freopen("tree.in", "r", stdin);
//    freopen("tree.out", "w", stdout);
	n=rd,D=rd;
	for(int i=0;i<n;i++){
		cin>>x[i]>>y[i];
	}
	for(int i=0;i<n;i++){
		for(int j=0;j<n;j++){
			dis[i][j]=cal(x[i],y[i],x[j],y[j]);
//			cerr<<dis[i][j]<<endl;
			if(dis[i][j]>D)dis[i][j]=INF;
		}
	}
	for(int k=0;k<n;k++){
		for(int i=0;i<n;i++){
			for(int j=0;j<n;j++){
				dis[i][j]=min(dis[i][j],dis[i][k]+dis[k][j]);
			}
		}
	}
	
	memset(f,0x7f,sizeof f);
//	cerr<<f[1][0]<<endl;
	f[1][0]=0;
	for(int i=1;i<1<<n;i++){
		for(int j=0;j<n;j++){
			if(!(i>>j&1))continue;
			for(int k=0;k<n;k++){
				if((i^1<<j)>>k&1)f[i][j]=min(f[i][j],f[i^1<<j][k]+dis[k][j]);
			}
		}
	}
	for(int i=0;i<n;i++)ans=min(ans,f[(1<<n)-1][i]+dis[i][0]);
//	cout<<ans<<endl;
	printf("%.2lf",ans);
    return 0;
}

```

### æ¢æ ¹dp |ã€XYGOI round1ã€ä¸€æ£µæ ‘

äºæ˜¯ MX æœ‰ä¸€æ£µ $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæ¯ä¸ªç‚¹ä¸Šæœ‰ä¸€ä¸ªæ•°å­— $a_i$ã€‚

å®šä¹‰ä¸€æ¡è·¯å¾„ $(x,y)$ çš„æƒå€¼ $w(x,y)$ ä¸ºï¼Œä» $x$ èµ°åˆ° $y$ çš„æœ€çŸ­è·¯å¾„ä¸Šï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°å­—é¡ºæ¬¡å†™ä¸‹åå¾—åˆ°çš„æ•°ã€‚å¦‚ï¼Œé¡ºæ¬¡ç»è¿‡å†™æœ‰æ•°å­— $3,21,0,5$ çš„å››ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯å¾„çš„æƒå€¼ä¸º $32105$ã€‚

MX æƒ³çŸ¥é“è¿™æ£µæ ‘æ‰€æœ‰è·¯å¾„çš„æƒå€¼ä¹‹å’Œï¼Œå³ $\sum\limits_{x=1}^n\sum\limits_{y=1}^nw(x,y)$ ä¸ºå¤šå°‘ã€‚

ç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œå¯¹ $998244353$ å–æ¨¡ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n\le 10^6$ï¼Œ$0\le a_i<10^9$ã€‚

### æ ‘å½¢dp |â€œè®¿é—®â€ç¾æœ¯é¦†

ç»è¿‡æ•°æœˆçš„ç²¾å¿ƒå‡†å¤‡ï¼ŒPeer Brelstetï¼Œä¸€ä¸ªå‡ºäº†åçš„ç›—ç”»è€…ï¼Œå‡†å¤‡å¼€å§‹ä»–çš„ä¸‹ä¸€ä¸ªè¡ŒåŠ¨ã€‚è‰ºæœ¯é¦†çš„ç»“æ„ï¼Œæ¯æ¡èµ°å»Šè¦ä¹ˆåˆ†å‰ä¸ºä¸¤æ¡èµ°å»Šï¼Œè¦ä¹ˆé€šå‘ä¸€ä¸ªå±•è§ˆå®¤ã€‚PeerçŸ¥é“æ¯ä¸ªå±•å®¤é‡Œè—ç”»çš„æ•°é‡ï¼Œå¹¶ä¸”ä»–ç²¾ç¡®æµ‹é‡äº†é€šè¿‡æ¯æ¡èµ°å»Šçš„æ—¶é—´ã€‚ç”±äºç»éªŒè€åˆ°ï¼Œä»–æ‹¿ä¸‹ä¸€å¹…ç”»éœ€è¦5ç§’çš„æ—¶é—´ã€‚ä½ çš„ä»»åŠ¡æ˜¯ç¼–ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—åœ¨è­¦å¯Ÿèµ¶æ¥ä¹‹å‰ï¼Œä»–æœ€å¤šèƒ½å·åˆ°å¤šå°‘å¹…ç”»ã€‚

![https://cdn.luogu.com.cn/upload/pic/85.png](ç®—æ³•å¿«é—ª/85.png)

```C++
/*////////ACACACACACACAC///////////
       . Code  by  Ntsc .
       . Earn knowledge .
/*////////ACACACACACACAC///////////

#include <bits/stdc++.h>
#define int long long
#define db double
#define rtn return
using namespace std;



#define rd read()
inline int read() {
    int xx = 0, ff = 1;
    char ch = getchar();
    while (ch < '0' || ch > '9') {
        if (ch == '-')
            ff = -1;
        ch = getchar();
    }
    while (ch >= '0' && ch <= '9') xx = xx * 10 + (ch - '0'), ch = getchar();
    return xx * ff;
}
inline void write(int out) {
    if (out < 0)
        putchar('-'), out = -out;
    if (out > 9)
        write(out / 10);
    putchar(out % 10 + '0');
}


const int N = 6e3+5;
const int M = 1e5;
const int MOD = 1e9+7;
const int INF = 1e9+5;

int n, m, t;
int dp[N][N], ans, cnt;

struct nopde{
	int t,p,l,r;
}e[N];


void dfs(int x){//ä»¥dfså½¢å¼è¯»å…¥
	e[x].t=rd*2;//æ³¨æ„èµ°å»Šè¿›å‡ºä¸€å…±ä¸¤æ¬¡
	e[x].p=rd;
	if(!e[x].p){
		e[x].l=++cnt;
		e[x].r=++cnt;
		dfs(e[x].l);
		dfs(e[x].r);	
	}
}

void dfs2(int x,int t){
	if(t<=0||dp[x][t])return ;//è®°å¿†åŒ–
	if(e[x].p){
		dp[x][t]=min(e[x].p,(t-e[x].t)/5);
		return ;
	}
	for(int i=0;i<=t-e[x].t;i++){
		dfs2(e[x].l,i);dfs2(e[x].r,t-e[x].t-i);
		dp[x][t]=max(dp[x][t],dp[e[x].l][i]+dp[e[x].r][t-e[x].t-i]);
	}
}

signed main() {
	t=rd-1;
	cnt=1;
	dfs(1);
	dfs2(1,t);
	cout<<dp[1][t]<<endl;
}

```



---

## å…¶ä»–

### æ‹“æ‰‘æ’åºï¼ˆæ¿å­ï¼‰

â†’ä¸€ç§éå†ä¿è¯ç¥–å…ˆæ¯”åç»§å…ˆè®¿é—®ã€‚ä¸ä¿è¯åªæœ‰ä¸€ä¸ªç‚¹æ²¡æœ‰ç¥–å…ˆã€‚

ä¸æ–­åˆ é™¤å…¥åº¦ä¸º1çš„ç‚¹ï¼Œå¹¶ä¸”æ›´æ–°é‚»ç‚¹ï¼ï¼ˆæ³¨æ„æ‹“æ‰‘æ’åºä¸æ˜¯ç”¨åªèƒ½ä¸€æ¡é“¾ï¼Œè€Œå¯èƒ½æ˜¯å¤šæ¡é“¾ï¼ï¼‰

```C++
void topo(){
    for(int i=1;i<=n;i++)if(!in[i])q.push(i);//æ‰¾åˆ°æ²¡æœ‰å…¥åº¦çš„
    while(q.size()){
        int x=q.front();
        q.pop();//mdè®°å¾—å¼¹å‡ºï¼ï¼
        cout<<x<<endl;
        vis[x]=1;//æ ‡è®°å·²ç»è¢«åˆ é™¤ï¼ï¼
        for(auto v:e[x]){
            if(vis[x])continue;
            in[v]--;
            if(!in[v])q.push(v);
        }
    }
}
```

### ğŸ˜”é«˜ç²¾åº¦ï¼ˆä¹˜ï¼ŒåŠ ï¼‰

[é«˜ç²¾åº¦](https://flowus.cn/d643f2f7-b3ce-4f69-820e-bbc627bd97f2)

## æ•°å­¦

### GCD | Unusual Sequences

è¾“å…¥x,yï¼Œæ±‚æœ‰å¤šå°‘ä¸ª**æ•°åˆ—**æ»¡è¶³å…¶gcdä¸ºxï¼Œå’Œä¸ºyã€‚

---

```C++
/*
CB Ntsc
*/

#include<bits/stdc++.h>
using namespace std;
#define int long long


#define rd read()
inline int read()
{
	int xx=0,ff=1;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') ff=-1;ch=getchar();}
	while(ch>='0'&&ch<='9') xx=xx*10+(ch-'0'),ch=getchar();
	return xx*ff;
}
inline void write(int out)
{
	if(out<0) putchar('-'),out=-out;
	if(out>9) write(out/10);
	putchar(out%10+'0');
}


const int N=5e5+5;
const int INF=1e9+5;
const int MOD=1e9+7;
bool f1;
int m,k,n,qzh;

int q;
int ans,cnt;
int x,y;
map<int,int> f;
int l,r;


bool f2;


int ksm(int a,int b){
    int res=1;
    while(b){
        if(b&1)res=(res*a)%MOD;
        b>>=1;
        a=(a*a)%MOD;
    }
    return res;
}

int dfs(int s){
    if(s==1)return 1;
    if(f.count(s))return f[s];
    int res=ksm(2,s-1);
    for(int i=2;i*i<=s;i++){
        if(s%i)continue;
        if(i*i==s)res=((res-dfs(i))+MOD)%MOD;
        else res=((res-dfs(s/i)-dfs(i))%MOD+MOD)%MOD;
    }
    f[s]=((res-1)+MOD)%MOD;//-1???
    return f[s];

}

signed main(){
	x=rd,y=rd;
    if(y%x){
        cout<<0<<endl;
        return 0;
    }
    dfs(y/x);
    cout<<f[y/x]<<endl;
}

/*
2
3 2 3 6
*/

```

> ï¼ˆgcdï¼Œè´¨æ•°ç­›ï¼Œç»„åˆæ•°ï¼‰

### exGCD

è¦äº†è§£exgcdï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£è¾—è½¬ç›¸é™¤æ³•ã€‚

```C++
function gcd(a, b)
    if b = 0 then return a
    else return gcd(b, a mod b)
```

è¿™ä¸ºä»€ä¹ˆæ˜¯å¯¹çš„å‘¢ï¼Ÿæˆ‘ä»¬è€ƒè™‘åˆ°a mod bå®è´¨ä¸Šæ˜¯è‹¥å¹²æ¬¡çš„a-bã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è¯æ˜gcd(a,b)=gcd(a-b,b)(a>b)å³å¯ã€‚

- è‹¥dæ˜¯a,bçš„ä¸€ä¸ªå…¬çº¦æ•°ï¼Œé‚£ä¹ˆdä¹Ÿæ˜¯a-b,bçš„ä¸€ä¸ªå…¬çº¦æ•°ã€‚è¯æ˜ï¼šå­˜åœ¨æ•´æ•° $x$ å’Œ $y$ï¼Œä½¿å¾— $a = dx$ å’Œ $b = dy$ï¼Œæ‰€ä»¥ $a - b = d(x - y)$ã€‚

- å¯¹äºa,bçš„æ‰€æœ‰å…¬çº¦æ•°ï¼Œä¸Šé¢çš„ç»“è®ºéƒ½æˆç«‹ã€‚å› æ­¤å¯¹äºå…¶gcdï¼Œä¸Šè¿°ç»“è®ºä¹Ÿæˆç«‹ã€‚

---

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹exgcdã€‚

è£´èœ€å®šç†çš„ä¸€ä¸ªé‡è¦æ¨è®ºæ˜¯ï¼š**a,bäº’è´¨çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯å­˜åœ¨æ•´æ•°x,yä½¿ax+by=1.**

é‚£ä¹ˆå°±æ˜¯è¯´åªè¦a,bäº’è´¨ï¼Œé‚£ä¹ˆax+by=1æœ‰æ•´æ•°è§£ã€‚

â€‹é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ax+by=gcd(a,b)æœ‰æ•´æ•°è§£ï¼ˆå¯ä»¥æŠŠa,béƒ½é™¤ä»¥gcd(a,b)å°±æ˜¯å˜æˆäº†ä¸Šé¢çš„æƒ…å†µï¼‰ã€‚äºæ˜¯â€‹ax+by=cï¼Œc=k\times gcd(a,b)çš„å€æ•°ï¼Œä¹Ÿæœ‰æ•´æ•°è§£ï¼Œè§£å°±æ˜¯åŸæ¥çš„ x,yä¹˜ä¸Škã€‚

é‚£ä¹ˆå¯¹äºæˆ‘ä»¬ç›´æ¥æ¥è€ƒè™‘æ±‚è§£ax+by=gcd(a,b)ã€‚

æˆ‘ä»¬å¯ä»¥é€’æ¨å‡ºax+by=gcd(a,b)=gcd(b,a mod b)=bx'+(a mod b)y'ã€‚æœ€åæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªgcd(a,0)=ax+0\times yçš„å¼å­ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å°†x=1ä»£å›äº†ã€‚å¯æ˜¯å¸¦å›å»æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬åœ¨è¾—è½¬ç›¸é™¤çš„æ—¶å€™ï¼Œx'=yã€‚å¯¹äºy'ï¼Œæˆ‘ä»¬æŠŠå–æ¨¡å±•å¼€ã€‚

æˆ–è€…æˆ‘ä»¬ç›´æ¥æŠŠä¸¤é¡¹æå‡ºæ¥ï¼Œå¾—åˆ°ax+by=bx'+(a-(a/b)*a)y'ï¼Œæ³¨æ„é¡¹ç›®æ˜¯1,4å¯¹åº”ï¼Œ2,3å¯¹åº”çš„ï¼Œå› ä¸ºaå¯¹åº”a mod bï¼Œbå¯¹åº”bã€‚

æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°x'=y,y'=x-y*[a/b]ã€‚æ³¨æ„åœ¨ä»£å›æ—¶æˆ‘ä»¬çŸ¥é“x',y'ï¼Œè¦æ±‚x,yã€‚

**çº¦æŸxçš„èŒƒå›´**

è§‚å¯Ÿax+by=gcd(a,b)ï¼Œæˆ‘ä»¬å‘ç°x,yä¸­å¿…ç„¶æœ‰ä¸€ä¸ªä¸æ˜¯æ­£æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†å…¶çº¦æŸåˆ°æ­£æ•´æ•°èŒƒå›´å†…ã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨è¦å°†xçº¦æŸåˆ°æ­£æ•´æ•°èŒƒå›´ï¼ˆå°±æ˜¯è¯´è®©xå˜å¤§ï¼‰ï¼Œé‚£ä¹ˆå…¶æ­¥é•¿æ˜¯å¤šå°‘ï¼Ÿå¾ˆæ˜¾ç„¶æ˜¯bã€‚å› ä¸ºæˆ‘ä»¬å°†xå¢å¤§bï¼Œå°±ç›¸å½“äºåŠ ä¸Šäº†abï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨yå‡å»aå³å¯ã€‚



### è´¨æ•°ç­›æ³•

- è¯•é™¤æ³•ï¼š
å¯¹äº $l,r\in 10^{18},r-l<10^6 $çš„é¢˜ç›®
å…ˆç­›$\sqrt{10^6}$ä¹‹å†…çš„è´¨æ•°ï¼Œç„¶åè¯•é™¤é€ä¸ªè´¨æ•°

- å”‰å¼ç­›$n\log\log n$

- è°ƒå’Œçº§æ•°ï¼š$\sum \frac{1}{i}=O(\log n)$

- æ¬§æ‹‰ç­› å¯¹æ¯ä¸ªiæšä¸¾è´¨æ•°priï¼Œç­›å»pri*iï¼ŒçŸ¥é“içš„æœ€å°è´¨å› æ•°ï¼ˆç­›æ—¶ç»´æŠ¤ï¼‰â‰¤pri

- ç­›ä»»æ„ææ€§å‡½æ•° æ¬§æ‹‰ç­›å³å¯ï¼Œè¿ç”¨ææ€§å‡½æ•°æ€§è´¨

### ç»„åˆæ•°

å¡ç‰¹å…°æ•°
å®¹æ–¥

### æ¦‚ç‡ï¼ŒæœŸæœ›

å¾…è¡¥å……

### ğŸ˜”åšå¼ˆè®º

å¾…è¡¥å……

### æ•´é™¤åˆ†å—

$|{\lfloor \frac{n}{x}\rfloor,x\in [1,n]}|=O(\sqrt{n})$

![image.png](ç®—æ³•å¿«é—ª/image 4.png)

ä¸ºäº†å¿«é€Ÿè·³è½¬åˆ°è¿™ä¸€å—çš„æœ«å°¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`r=n/(n/i)`

é‚£ä¹ˆå¦‚ä½•è¯æ˜n/(n/i)=kï¼Œn/(k+1)<n/iå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åè¯æ³•ï¼š

è‹¥n/(n/i)=kï¼Œn/(k+1)=n/iï¼Œåˆ™n/(n/i)=k+1. çŸ›ç›¾ï¼

### æ•°å­¦å®šç†

- $1\sim n$ä¸­ä¸näº’è´¨çš„ä¸ªæ•°$\phi(n)=n\prod(1-\frac{1}{p_i})$ï¼Œæ˜¯ææ€§å‡½æ•°

- è´¹é©¬å°å®šç†ï¼š$a^{p-1}==1 \pmod p$

- é€†å…ƒï¼š$a^{p-2}$ï¼Œå¯¹åº”å¿«é€Ÿå¹‚å†™æ³•O(\log p)ã€‚çº¿æ€§æ±‚æ³•1\sim nâ†’O(n+\log n)ã€‚çº¿æ€§æ±‚é˜¶ä¹˜é€†å…ƒï¼ˆå¤§æ¨å°ï¼‰

- æ„Ÿæ€§ç†è§£$\log( _2)$

- æ¬§æ‹‰å®šç†ï¼š$a^{\phi(p)}==1\pmod p$

- beizuå®šç†ï¼š$ax+by=dâ†bx_0+(a \mod b)y_0=d$

- å–æ¨¡åœ¨ä»£æ•°å˜æ¢ä¸­çš„å†™æ³•ï¼šæŠŠ$\mod p$å˜æˆ$a-p\times\lfloor a/p\rfloor$å³å¯ã€‚

- æ±‚è§£$ax==b\pmod m$ï¼ˆmä¸ºè´¨æ•°/éè´¨æ•°ï¼‰

- BSGSï¼š$a^x==b\pmod p$

- CRTï¼šæŠŠnä¸ªåŒä½™æ–¹ç¨‹åˆå¹¶ä¸ºä¸€ä¸ª

- é«˜æ–¯åŒä½™

    ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œæˆ‘ä»¬å°†aé™¤ä»¥måæ±‚å¾—çš„ä½™æ•°å†™ä¸ºï¼š

    r(a) (mod m)

    é«˜æ–¯åŒä½™å®šç†çš„å½¢å¼éå¸¸ç®€å•ï¼Œåˆ†åˆ«æ˜¯åŠ ï¼Œå‡ï¼Œä¹˜ä¸‰é¡¹å®šç†ï¼š

    (1) r(a) Â± r(b) = r(a Â± b)

    (2) r(a) * r(b) = r(a * b)

### çŸ©é˜µå¿«é€Ÿå¹‚

### é«˜æ–¯æ¶ˆå…ƒ

é«˜æ–¯æ¶ˆå…ƒæ˜¯ä¸€ç§æ•°å­¦ç®—æ³•ï¼Œç”¨äºè§£çº¿æ€§æ–¹ç¨‹ç»„ã€‚å®ƒé€šè¿‡é€æ­¥æ¶ˆé™¤å˜é‡æ¥å°†ä¸€ä¸ªçº¿æ€§æ–¹ç¨‹ç»„è½¬æ¢æˆæ¢¯å½¢çŸ©é˜µæˆ–è¡Œç®€åŒ–é˜¶æ¢¯å½¢çŸ©é˜µï¼Œä»è€Œæ›´å®¹æ˜“æ‰¾åˆ°æ–¹ç¨‹ç»„çš„è§£ã€‚å…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š

1. **é€‰æ‹©ä¸»å…ƒ**ï¼šåœ¨æ¯ä¸€åˆ—ä¸­é€‰æ‹©ä¸€ä¸ªéé›¶å…ƒç´ ä½œä¸ºä¸»å…ƒï¼ˆå¦‚æœå¯èƒ½çš„è¯ï¼Œé€šå¸¸é€‰æ‹©ç»å¯¹å€¼æœ€å¤§çš„å…ƒç´ ä»¥å‡å°‘è®¡ç®—è¯¯å·®ï¼‰ã€‚

2. **æ¶ˆå…ƒ**ï¼šé€šè¿‡å°†ä¸»å…ƒæ‰€åœ¨è¡Œçš„å€æ•°åŠ åˆ°å…¶ä»–è¡Œä¸Šï¼Œä½¿å¾—ä¸»å…ƒæ‰€åœ¨åˆ—çš„å…¶ä»–å…ƒç´ å˜ä¸ºé›¶ã€‚

3. **åŒ–ç®€**ï¼šå°†ä¸»å…ƒå˜ä¸º1ï¼Œå¹¶ä¸”å°†ä¸»å…ƒæ‰€åœ¨è¡Œçš„å…¶ä»–å…ƒç´ å˜ä¸º0ã€‚

4. **é‡å¤**ï¼šå¯¹æ¯ä¸€åˆ—é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°çŸ©é˜µå˜ä¸ºæ¢¯å½¢çŸ©é˜µã€‚

5. **å›ä»£**ï¼šä»æœ€åä¸€è¡Œå¼€å§‹ï¼Œé€æ­¥è§£å‡ºæ¯ä¸ªå˜é‡çš„å€¼ã€‚

---

è¦å­¦ä¼šé«˜æ–¯æ¶ˆå…ƒï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“å®ƒå¯ä»¥åšä»€ä¹ˆã€‚

ç»™å®šä¸€ä¸ªçº¿æ€§æ–¹ç¨‹ç»„ï¼Œå¯¹å…¶æ±‚è§£ã€‚

$ \begin{cases} a_{1, 1} x_1 + a_{1, 2} x_2 + \cdots + a_{1, n} x_n = b_1 \\ a_{2, 1} x_1 + a_{2, 2} x_2 + \cdots + a_{2, n} x_n = b_2 \\ \cdots \\ a_{n,1} x_1 + a_{n, 2} x_2 + \cdots + a_{n, n} x_n = b_n \end{cases}$

nâ‰¤100

è¦æ±‚æˆ‘ä»¬æ±‚å‡ºä¸€ç»„åˆæ³•çš„xã€‚

é‚£ä¹ˆåŠ å…¥é¡¹ç›®æ•°åªæœ‰2å‘¢ï¼Ÿæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°åˆä¸­æ—¶å­¦ä¹ çš„**æ¶ˆå…ƒæ³•**ã€‚æ²¡é”™ï¼Œé«˜æ–¯æ¶ˆå…ƒæ³•å°±æ˜¯ä½¿ç”¨æ¶ˆå…ƒæ¥è§£å†³é—®é¢˜çš„ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘å…ˆä½¿ç”¨ç¬¬ä¸€ä¸ªå¼å­ï¼ŒæŠŠå…¶ä½™å¼å­ä¸­çš„ x_1å…¨éƒ¨æ¶ˆå»ã€‚äºæ˜¯æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªn-1è§„æ¨¡çš„å­é—®é¢˜äº†ã€‚å½“n=1æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ±‚è§£å‡ºåŸé¢˜ä¸­çš„x_nï¼Œç„¶åé€ä¸ªå¾€ä¸Šä»£å…¥å³å¯ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(n^3)ã€‚

æ²¡é”™ï¼Œè¿™å°±æ˜¯é«˜æ–¯æ¶ˆå…ƒæ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å«ä»–**æ¶ˆå…ƒæ³•æ±‚nå…ƒæ–¹ç¨‹ç»„**ã€‚

é«˜æ–¯æ¶ˆå…ƒè¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯**æ— è§£çš„åˆ¤æ–­**ã€‚æˆ‘ä»¬æŒ‰ç…§æ•°å­¦ä¸­çš„åˆ¤æ–­æ–¹æ³•å³å¯ï¼š

1. **çŸ›ç›¾æ–¹ç¨‹ï¼Œå®Œå…¨ä¾èµ–è¡Œ**ï¼š

    - å¦‚æœåœ¨æ¶ˆå…ƒè¿‡ç¨‹ä¸­ï¼ŒæŸä¸€è¡Œçš„æ‰€æœ‰ç³»æ•°éƒ½æ˜¯0ï¼Œä½†å¸¸æ•°é¡¹ä¸æ˜¯0ï¼Œè¿™åŒæ ·è¡¨æ˜æ–¹ç¨‹ç»„æ— è§£ã€‚

1. **ä¸å®Œå…¨çš„è¡Œç®€åŒ–é˜¶æ¢¯å½¢çŸ©é˜µ**ï¼š

    - å¦‚æœåœ¨æ¶ˆå…ƒç»“æŸåï¼ŒçŸ©é˜µçš„æŸä¸€è¡Œï¼ˆéæœ€åä¸€è¡Œï¼‰çš„æ‰€æœ‰ç³»æ•°å’Œå¸¸æ•°é¡¹éƒ½æ˜¯0ï¼Œä½†æ˜¯è¯¥è¡Œä¸‹é¢çš„è¡Œï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æœ‰éé›¶å¸¸æ•°é¡¹ï¼Œè¿™ä¹Ÿè¡¨æ˜æ–¹ç¨‹ç»„æ— è§£ã€‚

1. **è‡ªç”±å˜é‡**ï¼š

    - å¦‚æœåœ¨æ¶ˆå…ƒè¿‡ç¨‹ä¸­æˆ–ç»“æŸåï¼Œå‘ç°å­˜åœ¨è‡ªç”±å˜é‡ï¼ˆå³æŸäº›å˜é‡åœ¨æ–¹ç¨‹ç»„ä¸­æ²¡æœ‰è¢«çº¦æŸï¼‰ï¼Œå¹¶ä¸”å¯¹åº”çš„å¸¸æ•°é¡¹ä¸æ˜¯0ï¼Œè¿™é€šå¸¸æ„å‘³ç€æ–¹ç¨‹ç»„æ— è§£æˆ–è€…æœ‰æ— ç©·å¤šè§£ã€‚åœ¨æˆ‘ä»¬çš„æœŸæœ›ä¸­ï¼Œä¸€ä¸ªæ–¹ç¨‹å¼åªèƒ½å¤Ÿæ¶ˆå»ä¸€ä¸ªæœªçŸ¥æ•°ã€‚å¦‚æœæœ‰ä¸€è¡Œçš„æœªçŸ¥æ•°ä¸ªæ•°ï¼ˆå³ç³»æ•°ä¸ä¸º0çš„æœªçŸ¥æ•°ï¼‰å°‘äºæœŸæœ›ä¸ªæ•°ï¼Œåˆ™å‡ºç°äº†è‡ªç”±å˜é‡ã€‚

## Tarjan

### scc

å› ä¸ºæ˜¯æœ‰å‘å›¾ï¼Œæ‰€ä»¥è¾¹ä¼šå¤æ‚ä¸€äº›ã€‚æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§æœç´¢æ ‘å»è€ƒè™‘ã€‚

![image.png](ç®—æ³•å¿«é—ª/image 5.png)

æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§å’Œedccä¸€æ ·çš„æœç´¢æ ‘è§„åˆ™ï¼Œå½“æˆ‘ä»¬åˆ°è¾¾ä¸€ä¸ªç‚¹xæ—¶ï¼Œè€ƒè™‘å…¶æ¯ä¸ªå­èŠ‚ç‚¹v

- væ²¡æœ‰è¢«è®¿é—®ï¼Œè¿™èµ°è¿™æ¡æ ‘è¾¹ï¼Œæ›´æ–°lowã€‚lowçš„å®šä¹‰åœ¨tarjanä¸­æ˜¯ä¸€è‡´çš„ã€‚

- vè¢«è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜åœ¨æ ˆä¸­ï¼šéæ ‘è¾¹ï¼Œç”¨dfn_væ›´æ–°low_xã€‚

æˆ‘ä»¬å…ˆä¸è€ƒè™‘ä¸Šè¿°æœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¸Šé¢åªæ˜¯ä¸ºäº†è®¡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„lowå’Œdfnã€‚æ²¡æœ‰åˆ«çš„ã€‚

æˆ‘ä»¬å†æ¥çœ‹åˆ¤å®šã€‚

æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœlow_x=dfn_xï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æœç´¢æ ‘ä¸Šï¼Œxä¸ºæ ¹çš„å­æ ‘ä¸ºä¸€ä¸ªsccã€‚è¿™ä¸ªsccä¸å¯èƒ½ä¼šæœ‰å…¶å®ƒéƒ¨åˆ†ï¼Œå› ä¸ºlow_x=dfn_xã€‚

æ‰€ä»¥æ­¤æ—¶åˆå› ä¸ºæ ˆä¸­è®°å½•äº†é€’å½’ä¸‹å»çš„å­æ ‘çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€ç›´å¼¹æ ˆï¼Œç›´åˆ°xï¼ˆxä¹Ÿè¦å¼¹ï¼‰ï¼Œæ ‡è®°ä¸ºä¸€ä¸ªsccã€‚

```C++
void tarjan(int x){
    dfs[x]=low[x]=++cnt;//ç¬¬ä¸€æ¬¡è®¿é—®åˆ°æ”¹èŠ‚ç‚¹çš„æ¬¡åºè®°ä¸ºdfnï¼Œè¯¥èŠ‚ç‚¹é€šè¿‡å­æ ‘ä¸­çš„è¾¹å’Œéæ ‘è¾¹å¯ä»¥è®¿é—®åˆ°çš„æœ€å°dfnè®°ä¸ºlowã€‚lowåˆå§‹å€¼ä¸ºè‡ªå·±çš„dfnå³è®¿é—®è‡ªå·±
    stk[++top]=x;instk[s]=1;//å…¥æ ˆï¼Œè¡¨ç¤ºåœ¨åŒä¸€ä¸ªåˆ†é‡ä¸­
    for(auto v:e[x]){
        if(!dfn){//æ²¡æœ‰è®¿é—®è¿‡ï¼ä¸ºäº†ä»¥æ ‘çš„å½¢å¼è®¿é—®æ­¤å›¾ï¼Œæ‰€ä»¥è®¿é—®è¿‡çš„ç‚¹ä¸èƒ½å†é€šè¿‡å¦å¤–çš„è¾¹è®¿é—®äº†ã€‚
            tarjan(v);//å…ˆå¾€ä¸‹èµ°ä¸ºäº†å¤„ç†low
            low[x]=min(low[x],low[v]);
        }else if(dfn[v]&&instk[v]){
            low[x]=min(low[x],dfn[v]);//è®¿é—®è¿‡äº†ï¼Œä½†æ˜¯è¿˜åœ¨æ ˆä¸­ï¼Œè¯´æ˜æ˜¯åå‘è¾¹(éæ ‘è¾¹ï¼Œå›æº¯è¾¹ï¼Œå‘ä¸Šè®¿é—®)ï¼Œæ›´æ–°low
        }
    }
    if(dfn[x]==low[x]){
        //è¯´æ˜æ˜¯åˆ†é‡çš„æ ¹ï¼Œå·²ç»å›æº¯å®Œäº†ï¼Œè¯¥åˆ†é‡ä¸­çš„ç‚¹éƒ½åœ¨æ ˆä¸­
        ++scc;int v;
        do{
            v=stk[top--];
            instk[v]=0;//æ ‡è®°å‡ºæ ˆ
            bel[v]=scc;//æ ‡è®°åˆ†é‡ä»å±å…³ç³»
            sz[scc]++;
            val[scc]+=w[v];//ç¼©ç‚¹åçš„ç‚¹æƒå’Œ
        }while(v!=x);
    }
}
```

### edcc

æ— å‘å›¾ä¸­æœ‰ä¸¤è€…è¾¹ï¼Œæ ‘è¾¹å’Œéæ ‘è¾¹ã€‚å…¶ä¸­æ ‘è¾¹æ˜¯æˆ‘ä»¬æœç´¢æ ‘ä¸Šç»è¿‡çš„è¾¹ã€‚

æˆ‘ä»¬å®šä¹‰low_xä¸ºå½“å‰ç‚¹çš„å­æ ‘ä¸­çš„ç‚¹é€šè¿‡**ä¸€æ¡**ä»»æ„è¾¹åˆ°è¾¾çš„æœ€å°çš„dfnå€¼ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡**ä¸€æ¡éæ ‘**è¾¹åˆ°è¾¾çš„æœ€å°çš„dfnå€¼ï¼Œã€‚å¦‚æœæ°å¥½ç­‰äºè‡ªå·±ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœ‰ç¯ã€‚

è¦åœ¨æœ€ååˆ¤lowå’Œdfnï¼Œè€Œä¸èƒ½é€’å½’ä¸€ä¸ªåˆ¤ä¸€ä¸ªï¼Œå› ä¸ºå¯èƒ½å‡ºç°å¤šä¸ªç¯çš„æƒ…å†µï¼Œä¸‹å›¾åªæœ‰ä¸€ä¸ªedccã€‚

![image.png](ç®—æ³•å¿«é—ª/image 6.png)

è¿™é‡Œæœ‰ä¸€ä¸ªå¯¹edccå’Œvdccé€šç”¨çš„æœç´¢æ ‘æµç¨‹ï¼š



- å¦‚æœvæ²¡æœ‰è¢«ç»è¿‡ï¼Œé‚£ä¹ˆé€’å½’ä¸‹å»ï¼Œå½“å‰è¾¹è§†ä¸ºæ ‘è¾¹ï¼Œlow_xå¯¹low_vå–minã€‚

- å¦‚æœvè¢«ç»è¿‡ï¼Œå½“å‰è¾¹è§†ä¸ºéæ ‘è¾¹ï¼Œlow_xå¯¹dfn_vå–minã€‚



æ¡¥çš„è®¡æ•°ï¼š

å½“é€’å½’åˆ°vè¿”å›åå‘ç°low_v>dfn_xæ—¶ï¼Œå°±è¯´æ˜xï¼Œvåœ¨ä¸¤ä¸ªä¸åŒçš„edccä¸Šï¼Œå‡ºç°æ¡¥ã€‚

å› ä¸ºå¦‚æœxï¼Œvåœ¨ä¸€ä¸ªedccä¸­ï¼Œé‚£ä¹ˆlow_vä¸€å®šâ‰¤dfn_xã€‚è€ƒè™‘è¿™é‡Œçš„lowçš„å«ä¹‰ã€‚

```C++
void tarjan(int u,int eid) {//å½“å‰èŠ‚ç‚¹,å…¥è¾¹ç¼–å·
	vis[u]=1;
	dfn[u]=low[u]=++indx;
	stk[++tp]=u;
	for(int i=h[u]; ~i; i=e[i].nxt) {
		int v=e[i].to;
		if(dfn[v]==0) {
			tarjan(v,i);
			low[u]=min(low[u],low[v]);
		}
		if(i!=(eid^1)) low[u]=min(low[u],dfn[v]);
	}
	if(dfn[u]==low[u]) {
		edcc++;
		int x;
		do {
			x=stk[tp--];
			belong[x]=edcc;
		} while(x!=u);
	}
}
```

### åœ†æ–¹æ ‘

å’Œedccä¸åŒï¼Œvdccçš„å¤šä¸ªç¯ä¸å±äºåŒä¸€ä¸ªvdccï¼Œä¸‹å›¾ä¸­å°±æœ‰2ä¸ªvdcc

![image.png](ç®—æ³•å¿«é—ª/image 7.png)

ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸æŠŠå‰²ç‚¹åˆ’åˆ†ä¸ºä»»ä½•ä¸€ä¸ªvdccã€‚å› æ­¤ï¼Œå’Œedccä¸åŒçš„æ˜¯ï¼Œvdccå½“éå†åˆ°ç‚¹xæ—¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªvéƒ½éœ€è¦åˆ¤æ–­å…¶low_vå’Œdfn_xçš„å…³ç³»ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™æŠŠæ ˆå†…çš„æ‰€æœ‰ç‚¹çš„åˆ’åˆ†åœ¨ä¸€ä¸ªvdccä¸­ï¼Œç›´åˆ°é‡åˆ°vä¸ºæ­¢ï¼ˆvåŒ…æ‹¬åœ¨å†…ï¼Œä½†xä¸åŒ…å«ï¼Œä¸”xä¸å¼¹å‡ºæ ˆï¼‰ã€‚æ–°å»ºä¸€ä¸ªæ ‡å·>nçš„ç‚¹pæ¥ä»£è¡¨è¿™ä¸ªvdccï¼Œç„¶åæŠŠpå’Œæ ˆå†…æ‰€æœ‰çš„ç‚¹è¿è¾¹ã€‚

åœ¨æ¸…ç©ºä¸€ä¸ªvdccåï¼Œå°†xå‘pè¿è¾¹ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªvæ»¡è¶³low_v=dfn_xï¼Œé‚£ä¹ˆxè‡ªç„¶ä¸ä¼šå’Œå…¶å®ƒpå»ºè¾¹ã€‚å¦‚æœæœ‰ç¬¦åˆæ¡ä»¶çš„vï¼Œé‚£ä¹ˆxå°±æ˜¯ä¸€ä¸ªå‰²ç‚¹ï¼Œä¿è¯ä¸ä¼šè¢«å…¶å®ƒvdccåŒ…å«ã€‚



```C++
void tarjan(int x) {  //å»ºåœ†æ–¹æ ‘
    low[x] = dfn[x] = ++dfn_cnt;
    stk[++top] = x;
    for (int i = 0; i < e[x].size(); ++i) {
        int v = e[x][i];
        if (!dfn[v]) {
            tarjan(v);
            low[x] = min(low[x], low[v]);
            if (low[v] == dfn[x]) {
                scc_cnt++;
                int a;
                do {
                    a = stk[top--];
                    g[a].push_back(scc_cnt);
                    g[scc_cnt].push_back(a);
                    //                    cdbg(scc_cnt,a);
                    belong[a] = scc_cnt;
                } while (a != v);
                g[x].push_back(scc_cnt);
                //                cdbg(scc_cnt,x);
                g[scc_cnt].push_back(x);
            }
        } else
            low[x] = min(low[x], dfn[v]);
    }
}

```

## æ ‘è®º

### æœ€å°ç”Ÿæˆæ ‘ï¼ˆæ¿å­ï¼‰

[ç”Ÿæˆæ ‘](https://flowus.cn/68abd59b-0fc9-4021-baf6-5630bd496733)

primï¼šä¸æ–­æ‰¾ç¦»å·²é€‰ç‚¹é›†æœ€è¿‘çš„ç‚¹åŠ å…¥ï¼

```C++
bool prim(){
    for(int i=1;i<=n;i++)dis[i]=INF;//åˆå§‹åŒ–
    dis[1]=0;//åˆå€¼
    for(int i=1;i=n;i++){
        int mx=INF,u=1;
        if(!vis[j]&&dis[j]<mx)u=j,mx=dis[j];//æ‰¾ç¦»å½“å‰ç”Ÿæˆæ ‘æœ€è¿‘çš„ç‚¹
        vis[u]=1;
        ans=max(ans,dis[u]);
        if(dis[u]!=INF)cnt++;//æ³¨æ„åˆ¤æ˜¯å¦è”é€š
        for(auto v:e[u]){
            if(dis[v.v]>v.w){//æ³¨æ„ä¸æ˜¯dis[u]+v.wï¼Œä¸æ˜¯æœ€çŸ­è·¯ï¼
                dis[v.v]=v.w;
            }
        }
    }
    return cnt==n;//åˆ¤æ˜¯å¦å¯ä»¥æ„æˆç”Ÿæˆæ ‘ï¼Œæ³¨æ„ä¸æ˜¯cnt==n-1ï¼ï¼è¿™é‡Œè®°å½•çš„æ˜¯ç‚¹ï¼ï¼
}
```

kruskalï¼šæ’åºè¾¹ï¼Œåˆ¤uvæ˜¯å¦è”é€šï¼ˆå¹¶æŸ¥é›†ï¼ˆè®°å¾—åˆå§‹åŒ–ï¼ï¼‰ï¼‰ï¼Œä¸è”é€šå°±è´ªå¿ƒåœ°è¿ä¸Šï¼

```C++
struct node{
    int u,v,w;
};

void add(int a,int b,int w){
    e[++idx]={a,b,w};
}

bool cmp(node a,node b){
    return a.w<b.w;
}

int find(int x){
    if(fa[x]==x)return x;
    return fa[x]=find(fa[x]);
}

bool krskl(){
    sort(e+1,e+idx+1,cmp);
    for(int i=1;i<=n;i++)fa[i]=i;//åˆå§‹åŒ–å¹¶æŸ¥é›†ï¼ï¼ç‰¢è®°ï¼ï¼
    for(int i=1;i<=idx;i++){
        int u=e[i].u,v=e[i].v;
        int a=find(u),b=find(v);
        if(a==b)continue;
        fa[a]=b;//ä¸æ˜¯a=b
        ans=max(ans,e[i].w);
        cnt++;

    }
    return cnt==n-1;
}
```



### æ ‘é“¾å‰–åˆ†

ä¸‹é¢æˆ‘ä»¬æ¥è®²è§£é‡é“¾å‰–åˆ†ã€‚

æˆ‘ä»¬å…ˆæŠŠæ¯ä¸€æ¡é‡é“¾éƒ½å¤„ç†å‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ç»´æŠ¤ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ

- top_x

- fa_x

- son_x

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ¨æ ‘ä¸Šå®šä½ä¸€æ¡é“¾ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦ä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤æ ‘é“¾ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ

æˆ‘ä»¬è¿˜æ˜¯åœ¨dfnä¸Šåšæ‰‹è„šï¼šæˆ‘ä»¬åœ¨dfs2ï¼ˆå³æ ‡è®°dfnçš„é‚£æ¬¡dfsï¼‰æ—¶ä¼˜å…ˆèµ°son_xï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä¿è¯æ¯ä¸€æ¡é“¾çš„dfnæ˜¯è¿ç»­çš„ï¼ˆå¼ºè¿ç»­ï¼Œå³é“¾ä¸Šä»»æ„å­ä¸²çš„dfnéƒ½æ˜¯è¿ç»­çš„ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†xå’Œtop_xï¼Œå°±çŸ¥é“äº†dfnçš„åŒºé—´ï¼Œå°±å¯ä»¥ç”¨çº¿æ®µæ ‘ç»´æŠ¤äº†ã€‚

## å¹³è¡¡æ ‘

> ï¼ˆåŠ¨æ€å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼‰

ä¸ºäº†æ·±å…¥äº†è§£å¹³è¡¡æ ‘ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“å¹³è¡¡æ ‘çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚

1. æ’å…¥ä¸€ä¸ªæ•° $x$ã€‚

2. åˆ é™¤ä¸€ä¸ªæ•° $x$ï¼ˆè‹¥æœ‰å¤šä¸ªç›¸åŒçš„æ•°ï¼Œåº”åªåˆ é™¤ä¸€ä¸ªï¼‰ã€‚

3. å®šä¹‰**æ’å**ä¸ºæ¯”å½“å‰æ•°å°çš„æ•°çš„ä¸ªæ•° $+1$ã€‚æŸ¥è¯¢ $x$ çš„æ’åã€‚

4. æŸ¥è¯¢æ•°æ®ç»“æ„ä¸­æ’åä¸º $x$ çš„æ•°ã€‚

5. æ±‚ $x$ çš„å‰é©±ï¼ˆå‰é©±å®šä¹‰ä¸ºå°äº $x$ï¼Œä¸”æœ€å¤§çš„æ•°ï¼‰ã€‚

6. æ±‚ $x$ çš„åç»§ï¼ˆåç»§å®šä¹‰ä¸ºå¤§äº $x$ï¼Œä¸”æœ€å°çš„æ•°ï¼‰ã€‚

å…¶å®å¯ä»¥è€ƒè™‘ä¸ºä¸€ä¸ªå‡çº§ç‰ˆçš„æœ‰åºå¯é‡set

é‚£ä¹ˆä¸ºäº†æ‰‹å†™ä¸€ä¸ªå®ç°ä¸Šè¿°åŠŸèƒ½çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè€ƒè™‘äºŒå‰æœç´¢æ ‘ã€‚

äºŒå‰æœç´¢æ ‘çš„å®šä¹‰ï¼šå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹xï¼Œå…¶å·¦å„¿å­**å­æ ‘çš„æ‰€æœ‰ç‚¹çš„æƒå€¼**å°äºå®ƒï¼Œå³å„¿å­**å­æ ‘çš„æ‰€æœ‰ç‚¹çš„æƒå€¼**å¤§äºå®ƒã€‚æ¯ä¸ªèŠ‚ç‚¹è‡ªèº«è®°å½•å±æ€§val,cnt,szï¼Œåˆ†åˆ«è¡¨ç¤ºæƒå€¼ï¼Œè¯¥æƒå€¼çš„æ•°çš„ä¸ªæ•°ï¼Œå­æ ‘å¤§å°ã€‚

äºæ˜¯æˆ‘ä»¬åœ¨dfsæ’å…¥/å®šä½ä¸€ä¸ªæƒå€¼væ—¶ï¼Œåˆ¤æ–­èŠ‚ç‚¹xçš„æƒå€¼å’Œvçš„å…³ç³»ï¼Œè‹¥val_x>v å¾€å·¦è¾¹èµ°ã€‚

---

ä½¿ç”¨äºŒå‰æœç´¢æ ‘çš„ç¡®å¯ä»¥å®ç°å¹³è¡¡æ ‘çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒæœŸæœ›æ—¶é—´å¤æ‚åº¦ä¸ºO(\log n)ï¼Œä½†æ˜¯äºŒå‰æœç´¢æ ‘å¯èƒ½ä¼šå› ä¸ºæ„é€ è€Œé€€åŒ–ä¸ºO(n)ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹³è¡¡æ ‘åšçš„äº‹å°±æ˜¯ä¸æ–­**é‡æ„**è¿™æ£µæ ‘ï¼Œä½¿å…¶ä¿è¯æ—¶é—´å¤æ‚åº¦çš„ä¼˜è¶Šæ€§ã€‚

### FHQ Treap

æ­¤å¤„ æ‰‹æ¨¡



æŒ‰å€¼åˆ†è£‚ï¼šæ ¹æ®ç»™å®šçš„å€¼væŠŠä¸€æ£µæ ‘åˆ†è£‚æˆä¸¤æ£µæ ‘ï¼Œä¸€æ£µæ ‘çš„å€¼valâ‰¤vï¼Œå¦ä¸€æ£µæ ‘çš„å€¼val>vã€‚

åˆå¹¶ï¼šå°†ä¸¤é¢—treapåˆå¹¶ä¸ºä¸€é¢—æ ‘

æ’å…¥æ•°å€¼vï¼šæˆ‘ä»¬æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹zï¼ŒæŠŠåŸæ ‘æŒ‰våˆ†è£‚ã€‚ç°åœ¨zæ˜¯ä¸€ä¸ª1ä¸ªèŠ‚ç‚¹çš„æ ‘,æŠŠå®ƒå…ˆå’Œxåˆå¹¶(å› ä¸ºxçš„valå‡â‰¤v,ä¿è¯äº†å®ƒçš„å¤§å°é¡ºåº,è‡³äºå®ƒä¼šè¢«æ”¾åœ¨xçš„æ ¹æˆ–è€…å…¶ä»–åœ°æ–¹,å‡­å€Ÿkeyæ¥ç¡®å®š),å†å’Œyåˆå¹¶

æŸ¥è¯¢ï¼š

- æŸ¥è¯¢æ’åä¸ºkçš„èŠ‚ç‚¹çš„å€¼ï¼šæˆ‘ä»¬ç›´æ¥æŒ‰ç…§äºŒå‰æœç´¢æ ‘çš„é€»è¾‘å»æŸ¥æ‰¾å³å¯ã€‚

- æ‰¾åˆ°vçš„å‰é©±ï¼šæˆ‘ä»¬å¯ä»¥æŠŠæ ‘æŒ‰våŠˆå¼€ä¸º[-INF,v),[v,INF]ï¼Œæ ¹èŠ‚ç‚¹åˆ†åˆ«ä¸ºx,yï¼Œç„¶ååœ¨xä¸­æŸ¥è¯¢æ’åä¸ºsz_xçš„èŠ‚ç‚¹çš„å€¼ã€‚åç»§ä¹Ÿæ˜¯ä¸€æ ·

- æŸ¥è¯¢val=vçš„ç‚¹çš„æ’å(ä»å°åˆ°å¤§)ï¼šåŠˆå¼€åç›´æ¥ä½¿ç”¨xçš„szå³å¯ã€‚

åˆ é™¤ï¼šæˆ‘ä»¬æŠŠæ ‘æ‹†æˆx,y,zï¼Œåˆ†åˆ«æ˜¯[-INF,v),[v,v],(v,INF]ï¼Œç„¶åèˆå»yï¼Œåˆå¹¶x,zå³å¯ã€‚



ç»è¿‡ä¸Šé¢çš„è®¨è®ºï¼Œæˆ‘ä»¬å‘ç°fhq treapæœ€é‡è¦çš„ä¸¤ä¸ªå‡½æ•°å°±æ˜¯åˆ†è£‚å’Œåˆå¹¶ã€‚äºæ˜¯ä¸‹é¢æˆ‘ä»¬æ¥åŠ æ·±å¯¹è¿™ä¸¤ä¸ªå‡½æ•°çš„è®°å¿†ã€‚

**åˆ†è£‚**

ç›®çš„ï¼šå°†æ ‘æŒ‰å€¼våˆ†è£‚ä¸º[-INF,v),[v,INF]ã€‚

split(cur,v,&x,&y)

å½“æˆ‘ä»¬åˆ°è¾¾èŠ‚ç‚¹curæ—¶ï¼Œè€ƒè™‘å…¶ä¸¤ä¸ªå­æ ‘ã€‚

- å¦‚æœå·¦å­æ ‘Lçš„æœ€å¤§æƒå€¼â‰¤vï¼Œé‚£ä¹ˆå·¦å­æ ‘åº”è¯¥å…¨éƒ¨åˆ’å½’xï¼Œé€’å½’å³å­æ ‘ã€‚å› æ­¤æ˜¯ï¼šls_x=L,split(R,v,rs_x,y)

- å¦‚æœå·¦å­æ ‘Lçš„æœ€å¤§æƒå€¼>vï¼Œé‚£ä¹ˆå³å­æ ‘åº”è¯¥å…¨éƒ¨åˆ’å½’yï¼Œé€’å½’å·¦å­æ ‘ã€‚å› æ­¤æ˜¯ï¼šrs_y=R,split(L,v,x,ls_y)

ä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬èµ°è¿‡çš„è¿™ä¸€æ¡è·¯å¾„å¹¶æ²¡æœ‰è¢«åˆ’åˆ†åˆ°ä»»æ„ä¸€ä¸ªå­æ ‘ä¸­ï¼æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸Šè¿°è¿‡ç¨‹ã€‚

- å¦‚æœcurçš„æƒå€¼â‰¤vï¼Œé‚£ä¹ˆå·¦å­æ ‘å’Œcuråº”è¯¥å…¨éƒ¨åˆ’å½’xï¼Œé€’å½’å³å­æ ‘ã€‚å› æ­¤æ˜¯ï¼šx=cur,split(R,v,rs_x,y)ã€‚è¿™é‡Œå› ä¸ºæˆ‘ä»¬é€’å½’äº†Rï¼Œæ‰€ä»¥å½“å‰å·²ç»æ•²å®šçš„å…¶å®åªæœ‰curå’ŒLå±äºxã€‚

- å¦‚æœcurçš„æƒå€¼>vï¼Œé‚£ä¹ˆå³å­æ ‘å’Œcuråº”è¯¥å…¨éƒ¨åˆ’å½’yï¼Œé€’å½’å·¦å­æ ‘ã€‚å› æ­¤æ˜¯ï¼šy=cur,split(L,v,x,ls_y)

![image.png](ç®—æ³•å¿«é—ª/image 8.png)

```C++
void split(int i,int v,int &x,int &y){//iå½“å‰èŠ‚ç‚¹ï¼Œvåˆ’åˆ†æ•°å€¼ï¼Œ è¿”å›æ—¶xä¼šæŒ‡å‘å·¦treapçš„æ ¹ï¼ŒyæŒ‡å‘å³treapçš„æ ¹
 	if(!i){//åˆ°è¾¾æ ‘å¶ 
 		x=y=0;return ;
	 }
	 if(tr[i].val<=v){ 
	 	x=i;
	 	split(tr[i].r,v,tr[x].r,y);
	 }else{
	 	y=i;
	 	split(tr[i].l,v,x,tr[y].l);
	 }
	pushup(i);
}
```

**åˆå¹¶**

ç›®çš„ï¼šå°†ä¸¤æ£µæ ‘åˆå¹¶ï¼Œå¹¶ä¸”ä¿è¯æ ‘é«˜çš„ä¼˜è¶Šæ€§ã€‚

merge(x,y) â†’int

è¿™é‡Œæˆ‘ä»¬è¦ä¿è¯x,yä¸ºåˆæ³•å¹³è¡¡æ ‘ï¼Œå¹¶ä¸”xä¸­æ‰€æœ‰èŠ‚ç‚¹çš„æƒå€¼<yä¸­æ‰€æœ‰èŠ‚ç‚¹çš„æƒå€¼ã€‚æˆ‘ä»¬åœ¨splitæ—¶ä¿è¯äº†è¿™ç§æ€§è´¨ã€‚

æˆ‘ä»¬è€ƒè™‘æœ‰æ ‘x,yï¼Œæ»¡è¶³xçš„æ‰€æœ‰æƒå€¼å°äºyçš„æ‰€æœ‰æƒå€¼ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆå¹¶ï¼š

![image.png](ç®—æ³•å¿«é—ª/image 9.png)

è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥æŠŠé—®é¢˜é€’å½’æˆä¸€ä¸ªå­é—®é¢˜ã€‚é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬æ€ä¹ˆæ ·å»é€‰æ‹©ï¼Œå¯ä»¥ç»´æŠ¤æ ‘é«˜çš„ä¼˜è¶Šæ€§å‘¢?æˆ‘ä»¬æƒ³å¿…æ˜¯éœ€è¦æ¯”è¾ƒx,yçš„æŸä¸ªä¿¡æ¯ï¼Œç„¶åè¿›è¡Œé€‰æ‹©ã€‚ã€‚

æˆ‘ä»¬è€ƒè™‘æœ‰ä»€ä¹ˆä¿¡æ¯å¯ä»¥é€‰æ‹©ï¼Œx,yçš„å€¼å¿…ç„¶æ˜¯ä¸å¯ä»¥ç”¨æ¥æ¯”è¾ƒçš„ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯x,yçš„å­æ ‘æ·±åº¦æœ€å¤§å€¼å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°æ˜¯ä¸è¡Œçš„ï¼Œä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå‡è®¾ï¼š

å‡è®¾mxdep_x>mxdep_yï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥é€‰æ‹©å³è¾¹çš„åˆå¹¶æ–¹æ³•ã€‚ä½†æ˜¯å‡å¦‚xæœ€å¤§æ·±åº¦é“¾åœ¨rs_xå‘¢ï¼Ÿé‚£ä¹ˆè¿™ä¸ªè´ªå¿ƒå°±å‡äº†ã€‚äºæ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ç®—æ³•ï¼Œæ”¹ä¸º`tr[tr[x].l].mxdep>=max(tr[y].mxdep,tr[tr[x].r].mxdep)`ï¼Œå‘ç°å°±å¯ä»¥é€šè¿‡äº†ã€‚

ä½†æ˜¯æœ‰ä¸€ä¸ªåœ¨æ—¶é—´ä¸Šæ›´ä¼˜çš„å†™æ³•ï¼Œå°±æ˜¯**ç»´æŠ¤å †çš„æ€§è´¨**ã€‚

æˆ‘ä»¬ä¸ºäº†ç»´æŠ¤å †çš„æ€§è´¨ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•å°±æ˜¯éšæœºåˆå¹¶ã€‚æˆ‘ä»¬å‘ç°å¦‚æœæ˜¯ç”¨rand()ï¼Œæ—¶é—´å¤æ‚åº¦å¾ˆåŠ£ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨keyå€¼å°±ä¸ä¼šäº†ã€‚å› ä¸ºrandçš„æœ¬è´¨è¿˜æ˜¯éšæœºåˆå¹¶ï¼Œè€Œkeyå€¼å¯ä»¥è®©æˆ‘ä»¬çš„åˆå¹¶å‘ç€ä¸€ä¸ªç¡®å®šçš„æ–¹å‘è¿›è¡Œï¼Œè€Œè¿™ä¸ªæ–¹å‘å°±æ˜¯æ„é€ ä¸€ä¸ªå †çš„æ–¹å‘ã€‚å¹¶ä¸”æˆ‘ä»¬åˆçŸ¥é“ï¼Œå †çš„é«˜åº¦æ˜¯å¾ˆä¼˜çš„ï¼Œæ‰€ä»¥è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°½å¯èƒ½ä¿è¯é«˜åº¦äº†ã€‚

```C++
int merge(int x,int y){// x,yåˆ†åˆ«æ˜¯å·¦å³treapçš„æ ¹ 
	if(!x||!y){
		return x+y;
	} 
	if(tr[tr[x].l].mxdp>=max(tr[y].mxdp,tr[tr[x].r].mxdp)){
		tr[x].r=merge(tr[x].r,y);
		pushup(x);return x;
	}else{
		tr[y].l=merge(x,tr[y].l);
		pushup(y);return y;
	}
}
```

## å›¾è®º

### åŒˆç‰™åˆ©ç®—æ³• äºŒåˆ†å›¾æœ€å¤§åŒ¹é…

æšä¸¾æ¯ä¸ªå·¦éƒ¨ç‚¹ï¼Œè´ªå¿ƒæ‰¾åŒ¹é…

bool dfs(x)è¿”å›èƒ½å¦ä¸ºxæ‰¾åˆ°åŒ¹é…ã€‚æšä¸¾åˆ°ä¸€ä¸ªvï¼Œå¦‚æœvis[v]é‚£ä¹ˆè·³è¿‡ï¼Œå¦åˆ™åŒ¹é…ã€‚å¦‚æœvä¹‹å‰è¢«åŒ¹é…ï¼Œé‚£ä¹ˆå°±çœ‹match[v]æ˜¯å¦å¯ä»¥åŒ¹é…å…¶ä»–çš„ï¼ˆæ­¤æ—¶vis[v]=1ï¼Œè·‘dfs(match[v])æ—¶å°±ä¸ä¼šåŒ¹é…väº†ï¼‰

