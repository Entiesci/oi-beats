
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%90%88%E5%B9%B6/">
      
      
        <link rel="next" href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%BB%B4%E6%8A%A4%E7%9A%84%E5%90%84%E7%A7%8D%E4%BF%A1%E6%81%AF/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>目录 - OI Beats</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="OI Beats" class="md-header__button md-logo" aria-label="OI Beats" data-md-component="logo">
      
  <img src="../../../images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OI Beats
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              目录
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%8A%A8%E6%80%81%E6%A0%91%E5%88%86%E6%B2%BB/" class="md-tabs__link">
          
  
  动态规划

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%9B%BE%E8%AE%BA/2-SAT/" class="md-tabs__link">
          
  
  图论

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/" class="md-tabs__link">
          
  
  字符串

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%95%B0%E5%AD%A6/%E4%B8%8D%E5%AE%9A%E6%96%B9%E7%A8%8B%2B%2B%2B%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97/" class="md-tabs__link">
          
  
  数学

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../ST%E8%A1%A8/" class="md-tabs__link">
          
  
  数据结构

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%A0%91%E8%AE%BA/KD%E6%A0%91/" class="md-tabs__link">
          
  
  树论

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/C%2B%2B%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8E%E7%94%9F%E5%83%BBSTL/" class="md-tabs__link">
          
  
  算法基础

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/CDQ%E5%88%86%E6%B2%BB/" class="md-tabs__link">
          
  
  算法策略

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OI Beats" class="md-nav__button md-logo" aria-label="OI Beats" data-md-component="logo">
      
  <img src="../../../images/logo.svg" alt="logo">

    </a>
    OI Beats
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    动态规划
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            动态规划
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%8A%A8%E6%80%81%E6%A0%91%E5%88%86%E6%B2%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态树分治
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E6%95%B0%E4%BD%8DDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数位DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E6%A0%91%E5%BD%A2DP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树形DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E7%8A%B6%E5%8E%8BDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    状压DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DP优化
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            DP优化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    决策单调性之 优先队列优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E5%80%8D%E5%A2%9E%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    倍增优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    决策单调性之 单调队列优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%B8%8D%E7%AD%89%E5%BC%8F%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    决策单调性之 四边形不等式优化（决策单调性优化 dp）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据结构优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/DP%E4%BC%98%E5%8C%96/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    决策单调性之 斜率优化
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    入门DP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            入门DP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/LCIS%2B%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LCIS 最长公共上升子序列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/LCS%2B%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LCS 最长公共子序列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/LIS%2B%E6%9C%80%E9%95%BF%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LIS 最长上升子序列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/%E6%95%B0%E5%AD%97%E9%87%91%E5%AD%97%E5%A1%94/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字金字塔
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/%E6%9E%84%E5%BB%BA%E5%9B%9E%E6%96%87%E4%B8%B2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构建回文串/编辑距离
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%85%A5%E9%97%A8DP/%E7%BA%BF%E6%80%A7dp%E5%85%B8%E4%BE%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性dp典例
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    背包
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            背包
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/01%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E4%BA%8C%E7%BB%B4%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二维背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E5%88%86%E7%BB%84%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分组背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E5%88%A9%E7%94%A8%E7%89%B9%E6%AE%8A%E6%80%A7%E8%B4%A8%E5%AE%9E%E7%8E%B0%E8%83%8C%E5%8C%85%E7%9A%84%E5%A4%9A%E6%AC%A1%E6%B1%82%E8%A7%A3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    利用特殊性质实现背包的多次求解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E5%A4%9A%E9%87%8D%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多重背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E5%AE%8C%E5%85%A8%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    完全背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E6%B7%B7%E5%90%88%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    混合背包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E8%83%8C%E5%8C%85/%E8%AE%A1%E6%95%B0%E8%83%8C%E5%8C%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计数背包
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    图论
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            图论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/2-SAT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 SAT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E4%BA%8C%E5%88%86%E5%9B%BE%E4%B8%8E%E4%BA%8C%E9%83%A8%E5%9B%BE%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二分图与二部图问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E5%9B%BE%E7%9A%84%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    图的存储方式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    图论基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E5%9F%BA%E7%8E%AF%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基环树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    朱刘算法（有向图的最小生成树）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%A0%91%E4%B8%8A%E7%A5%96%E5%85%88%E4%B8%8ELCA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树上祖先与LCA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%94%9F%E6%88%90%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    生成树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tarjan
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Tarjan
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/Kosaraju%2B%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kosaraju 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E5%89%B2%E7%82%B9%EF%BC%88%E5%89%B2%E9%A1%B6%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    割点（割顶）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E5%9C%86%E6%96%B9%E6%A0%91%E4%B8%8E%E4%BB%99%E4%BA%BA%E6%8E%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    圆方树与仙人掌
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    强连通分量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    点双连通分量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E7%BB%83%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    练习
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E7%BC%A9%E7%82%B9%EF%BC%88%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    缩点（强连通分量）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/Tarjan/%E8%BE%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    边双连通分量
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    最短路
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            最短路
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/Bellman-Ford/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bellman-Ford
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/Dijkstra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dijkstra
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/Floyd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Floyd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/Johnson%2B%E5%85%A8%E6%BA%90%E6%9C%80%E7%9F%AD%E8%B7%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Johnson 全源最短路
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/SPFA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPFA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/%E5%88%86%E5%B1%82%E5%9B%BE%E6%80%9D%E6%83%B3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分层图思想
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/%E5%90%84%E7%A7%8D%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95%E7%9A%84Hack%E4%B8%8E%E5%8C%BA%E5%88%AB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    各种最短路算法的Hack与区别
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/%E5%90%8C%E4%BD%99%E6%9C%80%E7%9F%AD%E8%B7%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    同余最短路
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    差分约束
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/%E6%AC%A1%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95%2BK%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    次短路算法/K短路算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11" >
        
          
          <label class="md-nav__link" for="__nav_3_11" id="__nav_3_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    网络流
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_11">
            <span class="md-nav__icon md-icon"></span>
            网络流
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/Dinic%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dinic算法求最大流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/EK%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EK算法求最大流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/%E4%B8%8A%E4%B8%8B%E7%95%8C%E7%BD%91%E7%BB%9C%E6%B5%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    上下界网络流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/%E6%9C%80%E5%B0%8F%E5%89%B2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络流 最小割 Dinic 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AE%9A%E4%B9%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络流定义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/%E8%B4%B9%E7%94%A8%E6%B5%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    费用流
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    字符串
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            字符串
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AC自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/KMP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KMP算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/Trie%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字典树 Trie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/manacher%2B%E9%A9%AC%E6%8B%89%E8%BD%A6%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    manacher 马拉车算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀数组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%93%88%E5%B8%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    哈希
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%AD%90%E5%BA%8F%E5%88%97%E8%87%AA%E5%8A%A8%E6%9C%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    子序列自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%AD%97%E7%AC%A6%E4%B8%B2/%E9%AB%98%E7%B2%BE%E5%BA%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高精度
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数学
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            数学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E4%B8%8D%E5%AE%9A%E6%96%B9%E7%A8%8B%2B%2B%2B%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    不定方程+++扩展欧几里得
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E5%88%86%E6%95%B0%E8%A7%84%E5%88%92/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分数规划
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E5%8D%9A%E5%BC%88%E8%AE%BA%2B%2B%2BSG%E5%87%BD%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博弈论+++SG函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E5%8E%9F%E6%A0%B9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    原根
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    容斥原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E5%BF%AB%E9%80%9F%E5%B9%82%2B%2B%2B%E7%9F%A9%E9%98%B5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速幂+++矩阵
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    拉格朗日插值
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E6%95%B0%E5%AD%A6%E5%AE%9A%E7%90%86%2B%2B%2B%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学定理+++线性代数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E6%95%B0%E5%AD%A6%E6%9C%9F%E6%9C%9B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学期望
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E7%AD%9B%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    质数筛法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    组合计数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E7%BE%A4%E8%AE%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    群论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    莫比乌斯反演
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算几何
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E8%B4%A8%E6%95%B0%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    质数基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E9%80%86%E5%85%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    乘法逆元
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高斯消元
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    数据结构
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            数据结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ST%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ST表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二叉查找树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BA%8C%E7%BB%B4%E7%BA%BF%E6%AE%B5%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二维线段树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%88%86%E5%9D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9D%97%E7%8A%B6%E9%93%BE%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分块思想应用：块状链表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E6%9F%A5%E9%9B%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    并查集
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%A0%91%E5%88%86%E5%9D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树分块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树状数组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%8E%AB%E9%98%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分块变形：莫队
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%B7%B3%E8%88%9E%E9%93%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    跳舞链
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%B7%B3%E8%B7%83%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    跳跃表（跳表）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_12" >
        
          
          <label class="md-nav__link" for="__nav_6_12" id="__nav_6_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    平衡树
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_12">
            <span class="md-nav__icon md-icon"></span>
            平衡树
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/FHQ%2BTreap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FHQ Treap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/Splay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/Treap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Treap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/%E5%85%B6%E5%AE%83%E5%B9%B3%E8%A1%A1%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    其它平衡树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%B9%B3%E8%A1%A1%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可持久化平衡树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/%E5%90%8E%E7%BC%80%E5%B9%B3%E8%A1%A1%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀平衡树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/%E5%B9%B3%E8%A1%A1%E6%A0%91%E4%BE%8B%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    平衡树例题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B3%E8%A1%A1%E6%A0%91/%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文艺平衡树
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_13" checked>
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    线段树
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            线段树
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BA%BF%E6%AE%B5%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线段树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%88%86%E6%B2%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线段树分治
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%88%86%E8%A3%82/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线段树分裂
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%90%88%E5%B9%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线段树合并
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    目录
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%BB%B4%E6%8A%A4%E7%9A%84%E5%90%84%E7%A7%8D%E4%BF%A1%E6%81%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线段树维护的各种信息
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    树论
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            树论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/KD%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KD树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/Prufur%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prufur序列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E4%BA%8C%E9%80%BC%E5%B9%B3%E8%A1%A1%E6%A0%91%EF%BC%88%E6%A0%91%E5%A5%97%E6%A0%91%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二逼平衡树（树套树）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E5%8A%A8%E6%80%81%E6%A0%91%EF%BC%88LCT%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态树（LCT）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E5%B7%A6%E5%81%8F%E6%A0%91%EF%BC%88%E5%8F%AF%E5%B9%B6%E5%A0%86%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    左偏树（可并堆）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树链剖分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    笛卡尔树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%91%E8%AE%BA/%E8%99%9A%E6%A0%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    虚树
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    算法基础
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            算法基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/C%2B%2B%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8E%E7%94%9F%E5%83%BBSTL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++关键字与生僻STL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%89%8D%E7%BC%80%E5%92%8C%2B%E5%B7%AE%E5%88%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前缀和+差分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%BF%AB%E8%AF%BB%E5%BF%AB%E8%BE%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快读快输
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E6%A6%82%E5%BF%B5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E6%A8%A1%E6%9D%BF%E5%A4%B4%2B%E7%BC%BA%E7%9C%81%E6%BA%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    模板头+缺省源
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E8%B4%AA%E5%BF%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    贪心
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E9%80%92%E5%BD%92%2B%E9%80%92%E6%8E%A8%2B%E6%B7%B1%E6%90%9C%2B%E5%B9%BF%E6%90%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    递归+递推+深搜+广搜
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    算法策略
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            算法策略
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/CDQ%E5%88%86%E6%B2%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CDQ分治（偏序问题）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E4%BA%8C%E5%88%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E5%88%86%E6%B2%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分治
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E5%90%AF%E5%8F%91%E5%BC%8FAstar%2BIDAstar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    启发式Astar+IDAstar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    启发式合并
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E6%9E%84%E9%80%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E6%A0%91%E4%B8%8A%E5%88%86%E6%B2%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    点分治
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5/%E7%88%AC%E5%B1%B1%E7%AE%97%E6%B3%95%2B%2B%2B%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    爬山算法+++模拟退火
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">目录<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<ul>
<li>
<p>01线段树</p>
</li>
<li>
<p>扫描线算法</p>
</li>
<li>
<p>可持久化权值线段树（主席树）-？模板2</p>
</li>
<li>
<p>线段树套平衡树</p>
</li>
<li>
<p>李超线段树</p>
</li>
<li>
<p>可持久化线段树（数组）→#模板1</p>
</li>
<li>
<p>吉司机线段树</p>
</li>
<li>
<p>二维线段树</p>
</li>
<li>
<p>带修主席树（带修改的区间k大值）</p>
</li>
</ul>
<h1 id="01">01线段树<a class="headerlink" href="#01" title="Permanent link">&para;</a></h1>
<p><a href="https://flowus.cn/2f9e28ac-ef43-4fbd-9730-2a8285c137b5">练习 | 南外231024</a> T4</p>
<p><a href="https://www.luogu.com.cn/problem/P3870">www.luogu.com.cn</a></p>
<h1 id="_2">扫描线<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h1>
<p><a href="https://www.bilibili.com/video/BV1MX4y1Z7N5/?spm_id_from=333.337.search-card.all.click&amp;vd_source=f45ea4e1e4b3b73d5f07c57b46c43aba">www.bilibili.com</a></p>
<p>求 <span class="arithmatex">\(n\)</span> 个四边平行于坐标轴的矩形的面积并。</p>
<p>对于 <span class="arithmatex">\(100\%\)</span> 的数据，<span class="arithmatex">\(1 \le n \le {10}^5\)</span>，<span class="arithmatex">\(0 \le x_1 &lt; x_2 \le {10}^9\)</span>，<span class="arithmatex">\(0 \le y_1 &lt; y_2 \le {10}^9\)</span>。</p>
<h2 id="_3">扫描线<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image.png" /></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%201.png" /></p>
<p>我们用线段树来维护这个结构。线段树节点划分如图。</p>
<p>然后我们每个节点维护的是当前节点的**目前被覆盖的区间**的长度len以及**是否被覆盖**flg。为了维护是否被覆盖，我们还要维护**被覆盖的次数**cnt。</p>
<p>然后我们从下往上开始枚举扫描线（红色的线）</p>
<p>当我们遇到矩形下界线（如1,2,3）时，我们把当前矩形（即对应下界的矩形）覆盖了的区间+1，维护每个节点是否被覆盖。然后我们进行一次query()，当访问到一个节点，如果flg=1，则res加上len。（注意这里的len是要pushup维护的，而不是当前节点代表是哪些节点的祖先就把区间相加）。求出res后，我们把答案加上res\times h，这里的h是当前扫描线与上面相邻的扫描线的高度差。</p>
<p>当我们遇到矩形上界线（如4,5,6）时，我们把当前矩形（即对应下界的矩形）覆盖了的区间-1，维护每个节点是否被覆盖。然后我们进行一次query()，同理。</p>
<p>当一个节点的cnt被减成0时，我们将其flg=0。反之当我们把一个cnt=0的节点cnt+1时，我们要将其flg=1。（其实可以不需要flg）</p>
<p>最后的ans即为答案</p>
<h2 id="pushup">pushup<a class="headerlink" href="#pushup" title="Permanent link">&para;</a></h2>
<p>在pushup中，我们要维护三个信息。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">)</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">len</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">l</span><span class="p">];</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">len</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="o">+</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
</code></pre></div>
<p>设当前节点为x，儿子为s1,s2。</p>
<ul>
<li>
<p>x.cnt&gt;0，则说明当前节点被完全覆盖，我们不管这么多，直接把len修改为当前节点代表的区间的长度即可。</p>
</li>
<li>
<p>x.cnt=0，则合并s1,s2的len即可。</p>
</li>
</ul>
<p>虽然是区间修改，因为我们只需要查询全局值（即tr[1]）所以不需要pushdown。</p>
<h2 id="_4">代码<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="cm">/*////////ACACACACACACAC///////////</span>
<span class="cm">       . Code  by  Ntsc .</span>
<span class="cm">       . Earn knowledge .</span>
<span class="cm">/*/</span><span class="c1">///////ACACACACACACAC///////////</span>

<span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<span class="cp">#define int long long</span>
<span class="cp">#define db double</span>
<span class="cp">#define rtn return</span>
<span class="cp">#define lb lower_bound</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">2e5</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="o">=</span><span class="mf">1e5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Mod</span><span class="o">=</span><span class="mf">1e5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="o">=</span><span class="mf">1e5</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">],</span><span class="n">ans</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">line</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
<span class="p">}</span><span class="n">lne</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">];</span><span class="c1">//注意4倍的线 </span>

<span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">len</span><span class="p">;</span>
<span class="p">}</span><span class="n">tr</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">];</span><span class="c1">//注意16倍空间线段树 </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">)</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">len</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">l</span><span class="p">];</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">len</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="o">+</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">l</span><span class="o">&gt;</span><span class="n">pr</span><span class="o">||</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">r</span><span class="o">&lt;</span><span class="n">pl</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="p">){</span>
<span class="w">        </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">+=</span><span class="n">tag</span><span class="p">;</span>
<span class="w">        </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>

<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">tag</span><span class="p">);</span>
<span class="w">    </span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">tag</span><span class="p">);</span>
<span class="w">    </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span>


<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="c1">//  tr[x].r=r;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="c1">//  pushup();</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">cmp</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">line</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<span class="w">    </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="o">&gt;&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span><span class="c1">//下边界 </span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">-1</span><span class="p">};</span><span class="c1">//上边界</span>
<span class="w">        </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">n</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">lne</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lne</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">cmp</span><span class="p">);</span>
<span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sz</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sz</span><span class="mi">-1</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="c1">//i!=n因为当前是计算i~i+1 的 </span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="o">=</span><span class="n">lb</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="o">+</span><span class="n">sz</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x1</span><span class="p">)</span><span class="o">-</span><span class="n">X</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="n">lb</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="o">+</span><span class="n">sz</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x2</span><span class="p">)</span><span class="o">-</span><span class="n">X</span><span class="p">;</span>
<span class="w">        </span><span class="n">change</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="mi">-1</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tag</span><span class="p">);</span><span class="c1">//注意偏移映射传参</span>
<span class="w">        </span><span class="n">ans</span><span class="o">+=</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="o">*</span><span class="p">(</span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">y</span><span class="o">-</span><span class="n">lne</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h1 id="_5">主席树<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h1>
<p><a href="https://www.bilibili.com/video/BV1PT411L7XQ/?spm_id_from=333.999.0.0&amp;vd_source=f45ea4e1e4b3b73d5f07c57b46c43aba">166 可持久化线段树（主席树）_哔哩哔哩_bilibili</a></p>
<p>主席树全称是可持久化权值线段树</p>
<blockquote>
<p>注意：在某些程度上，主席树≠可持久化线段树</p>
</blockquote>
<p><strong>定义：权值线段树</strong></p>
<p>线段树维护的是区间l<sub>r的最大值等，而值域线段树维护的是在区间1</sub>n中大小在[l,r]范围内的数的个数</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%202.png" /></p>
<p><strong>定义：可持久化线段树</strong></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%203.png" /></p>
<p>简单做法：暴力地每次修改都开一棵新的线段树</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%204.png" /></p>
<p>这是不可取的，因此我们有优化方法</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%205.png" /></p>
<p>注释：堆式存储法即父节点为i，子节点为<span class="arithmatex">\(2 \times i\)</span> 和 <span class="arithmatex">\(2\times i+1\)</span>的存储方法</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%206.png" /></p>
<p>动态开点解说：对于每个节点应该保存左右儿子的编号，对于每个历史版本，还应该保存根节点的编号。</p>
<p>解说：每一次修改一定会改动根节点，因此每一个历史版本的根节点都不同。也就是说根节点是每一个历史版本的入口</p>
<h3 id="_6">动态开点线段树<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>结构</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lc</span><span class="p">,</span><span class="n">rc</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
<span class="p">}</span><span class="n">tr</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">N</span><span class="p">];</span>
</code></pre></div>
<p><strong>建树</strong></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%207.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">x</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">rc</span><span class="p">,(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>注意，如果最开始的状态就i是一棵空树，后面才慢慢把数字插入进来，那么就不需要写build</p>
<p><strong>插入</strong></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%208.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="n">now</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span><span class="c1">//动态开点.新插入一个点 为了可以方便的用这个now更新上一个函数空间的tr[now].lc(或rc),我们就引用一下</span>
<span class="w">    </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">]</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">];</span><span class="c1">//复制旧点的信息</span>
<span class="w">    </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">v</span><span class="o">++</span><span class="p">;</span><span class="c1">//点权+1,因为插入的树在now的区间内</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>pre指的是上一个版本的点的编号，now指的是新的编号（会动态开点，传入的一个是空，然后在函数中会对其进行赋值）</p>
<p>如果要插入一个点，请写</p>
<div class="highlight"><pre><span></span><code><span class="n">insert</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">v</span><span class="p">);</span><span class="c1">//rt记录第i个版本的根节点,v是要插入的值</span>
</code></pre></div>
<p><strong>查询</strong></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%209.png" /></p>
<p>如图，假设我们在空树上插入了8个数，现在我要查询插入第6个数时的第5小的数。我们可以从rt[6]进入第6个版本的值域线段树，然后二分</p>
<p>二分方法：我们先到根节点，发现左子树在[1,2]有4个数，那么第5个数就在右子树。进入右子树，将目标5减去根节点左子树的大小4得1，然后看现在的左子树大小，为1，那么就进入左子树。继续二分下去直到l==r，此时l就是答案</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2010.png" /></p>
<p><strong>扩展</strong></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2011.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="c1">//查询区间l~r中第k大的数</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="o">-</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="p">;</span><span class="c1">//note</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">s</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>我们重点关注这一行代码</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="o">-</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">s</span><span class="p">;</span><span class="c1">//note</span>
</code></pre></div>
<p>为什么要这样呢？我们结合一个例子（导师の伟大样例）</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2012.png" /></p>
<p>我们查询下标3~6之间第4大的数（很明显是3对吧）</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2013.png" /></p>
<p>当我们函数走到根节点时，tr[tr[pre].lc].v代表了i=2时1<sub>2值域内数字的个数，tr[tr[now].lc].v代表了i=6时1</sub>2值域内的数字个数，将它们做差后，就得到了下标2+1=3<sub>6范围内值域1</sub>2的数的个数啦！（前缀和思想）</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2014.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="c1">//查询区间l~r中第k大的数</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="o">-</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="p">;</span><span class="c1">//note</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">s</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">s</span><span class="p">);</span><span class="c1">//注意是k-s,因为左子树已经有s个了,所以只要在右子树找第k-s个即可</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>注意</strong></p>
<p>在值域线段树中，节点的[l,r]指的是数字大小在l<sub>r之间的数字的个数，除非使用主席树，否则维护的都是1</sub>n的区间，不能求出特点子区间的问题。</p>
<p>还有就是，一般题目中的值域可能较大，而数字数量不多，所以需要离散化</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2015.png" /></p>
<p>离散化的代码就不写了，<del>贴贴~（想和Chargcy贴贴...）（bushi</del>，贴图片</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2016.png" /></p>
<h2 id="_7">模板<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p><a href="https://www.luogu.com.cn/problem/P3919">www.luogu.com.cn</a></p>
<p>如题，你需要维护这样的一个长度为 N 的数组，支持如下几种操作</p>
<ol>
<li>
<p>在某个历史版本上修改某一个位置上的值</p>
</li>
<li>
<p>访问某个历史版本上的某一位置的值</p>
</li>
</ol>
<blockquote>
<p>见下方：可持久化线段树（数组）</p>
</blockquote>
<p><a href="https://www.luogu.com.cn/problem/P3834">www.luogu.com.cn</a></p>
<p>这是个非常经典的可持久化权值线段树入门题——静态区间第 <span class="arithmatex">\(k\)</span> 小。</p>
<p><strong>数据已经过加强，请使用可持久化权值线段树。同时请注意常数优化</strong>。</p>
<p>如题，给定 <span class="arithmatex">\(n\)</span> 个整数构成的序列 <span class="arithmatex">\(a\)</span>，将对于指定的闭区间 <span class="arithmatex">\([l, r]\)</span> 查询其区间内的第 <span class="arithmatex">\(k\)</span> 小值。</p>
<p>对于每次询问，输出一行一个整数表示答案。</p>
<ul>
<li>对于 <span class="arithmatex">\(100\%\)</span> 的数据，满足 <span class="arithmatex">\(1 \leq n,m \leq 2\times 10^5\)</span>，<span class="arithmatex">\(|a_i| \leq 10^9\)</span>，<span class="arithmatex">\(1 \leq l \leq r \leq n\)</span>，<span class="arithmatex">\(1 \leq k \leq r - l + 1\)</span>。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">CB Ntsc</span>
<span class="cm">*/</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="cp">#define int long long</span>
<span class="cp">#define mp make_pair</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">f1</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">top</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">fa</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">rt</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">f2</span><span class="p">;</span>


<span class="cp">#define rd read()</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">read</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ff</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">out</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
<span class="w">        </span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">putchar</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lc</span><span class="p">,</span><span class="n">rc</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
<span class="p">}</span><span class="n">tr</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">N</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">x</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">rc</span><span class="p">,(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="n">now</span><span class="o">=++</span><span class="n">idx</span><span class="p">;</span><span class="c1">//动态开点.新插入一个点 为了可以方便的用这个now更新上一个函数空间的tr[now].lc(或rc),我们就引用一下</span>
<span class="w">    </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">]</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">];</span><span class="c1">//复制旧点的信息</span>
<span class="w">    </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">v</span><span class="o">++</span><span class="p">;</span><span class="c1">//点权+1,因为插入的树在now的区间内</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="c1">//查询区间l~r中第k大的数</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="o">-</span><span class="n">tr</span><span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">v</span><span class="p">;</span><span class="c1">//note</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">s</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">s</span><span class="p">);</span><span class="c1">//注意是k-s,因为左子树已经有s个了,所以只要在右子树找第k-s个即可</span>
<span class="p">}</span>

<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// freopen(&quot;chfran.in&quot;, &quot;r&quot;, stdin);</span>
<span class="w">    </span><span class="c1">// freopen(&quot;chfran.out&quot;, &quot;w&quot;, stdout);</span>
<span class="w">    </span><span class="n">n</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span><span class="n">m</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">()),</span><span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">len</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">insert</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">l</span><span class="mi">-1</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">len</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>


<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">1</span>
<span class="cm">2 5 1 </span>
<span class="cm">0 0 1 </span>
<span class="cm">0 0 4 </span>

<span class="cm">*/</span>
</code></pre></div>
<h2 id="noip">NOIP真题<a class="headerlink" href="#noip" title="Permanent link">&para;</a></h2>
<p><a href="https://www.luogu.com.cn/problem/P1972">www.luogu.com.cn</a></p>
<p>题目描述</p>
<p>HH 有一串由贝壳组成的项链。</p>
<p>他提出了一个问题：某一段贝壳中，包含了多少种不同的贝壳？</p>
<p>输入格式</p>
<p>一行一个正整数 <span class="arithmatex">\(n\)</span>，表示项链长度。
第二行 <span class="arithmatex">\(n\)</span> 个正整数 <span class="arithmatex">\(a_i\)</span>，表示项链中第 <span class="arithmatex">\(i\)</span> 个贝壳的种类。</p>
<p>第三行一个整数 <span class="arithmatex">\(m\)</span>，表示 HH 询问的个数。
接下来 <span class="arithmatex">\(m\)</span> 行，每行两个整数 <span class="arithmatex">\(l,r\)</span>，表示询问的区间。</p>
<p>输出格式</p>
<p>输出 <span class="arithmatex">\(m\)</span> 行，每行一个整数，依次表示询问对应的答案。</p>
<p>【数据范围】</p>
<p>对于 <span class="arithmatex">\(20\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m\leq 5000\)</span>；
对于 <span class="arithmatex">\(40\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m\leq 10^5\)</span>；
对于 <span class="arithmatex">\(60\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m\leq 5\times 10^5\)</span>；
对于 <span class="arithmatex">\(100\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m,a_i \leq 10^6\)</span>，<span class="arithmatex">\(1\le l \le r \le n\)</span>。</p>
<p>本题可能需要较快的读入方式，最大数据点读入数据约 20MB</p>
<h2 id="_8">区间二维信息统计 | 数颜色<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>从标准输入中读入数据。 输入第 1 行两个正整数 <span class="arithmatex">\(n\)</span>,<span class="arithmatex">\(m\)</span>。</p>
<p>输入第 2 行 <span class="arithmatex">\(n\)</span> 个正整数，第 <span class="arithmatex">\(i\)</span> 个数表示第 <span class="arithmatex">\(i\)</span> 只兔子的颜色 <span class="arithmatex">\(a_i\)</span>。</p>
<p>输入接下来 <span class="arithmatex">\(m\)</span> 行，每行为以下两种中的一种：</p>
<ul>
<li>
<p>“<span class="arithmatex">\(1\ l_j\ r_j\ c_j\)</span>” ：询问在区间 <span class="arithmatex">\([l_j,r_j]\)</span> 里有多少只颜色为 <span class="arithmatex">\(c_j\)</span> 的兔子；</p>
</li>
<li>
<p>“<span class="arithmatex">\(2\ x_j\)</span>”： <span class="arithmatex">\(x_j\)</span> 和 <span class="arithmatex">\(x_j+1\)</span> 两只兔子交换了位置。</p>
</li>
</ul>
<p>数据范围均为3e5</p>
<hr />
<p>我们用vector+二分即可。vector[i]中记录颜色i的点的下标从小到大。每次在vector[<span class="arithmatex">\(c_j\)</span>]中二分查找值在<span class="arithmatex">\([l_j,r_j]\)</span>范围内的上下界即可。修改时二分定位到vector[<span class="arithmatex">\(col_{x}\)</span>]和vector[<span class="arithmatex">\(col_{x+1}\)</span>]的位置修改。</p>
<h2 id="_9">带修主席树<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<h1 id="_10">树套树<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h1>
<p><a href="https://flowus.cn/4077b622-00bd-4d7d-b2a6-0ca0e0d73b87">动态树（LCT）</a></p>
<h1 id="_11">李超线段树<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h1>
<p><img alt="https://oi-wiki.org/ds/images/li-chao-tree-1.png" src="https://oi-wiki.org/ds/images/li-chao-tree-1.png" /></p>
<p>要求在平面直角坐标系下维护两个操作：</p>
<ol>
<li>
<p>在平面上加入一条线段。记第 <span class="arithmatex">\(i\)</span> 条被插入的线段的标号为 <span class="arithmatex">\(i\)</span>。</p>
</li>
<li>
<p>给定一个数 <span class="arithmatex">\(k\)</span>，询问与直线 <span class="arithmatex">\(x = k\)</span> 相交的线段中，交点纵坐标最大的线段的编号。</p>
</li>
</ol>
<p><strong>本题输入强制在线</strong>。</p>
<h2 id="_12">思路<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>先看看题目，我们要维护的是什么？是对于每个 <span class="arithmatex">\(x\)</span>，其上方最高的线段是那一条。我们想到，当我们往图中加入一条新的线段时，假如这条线段在某个区间是最高的，那么我们就需要把这个区间的答案都修改为这个线段。所以很明显我们可以考虑用类似线段树的数据结构来维护。</p>
<p>但是首先要明确一点，每次加入一条线段可能要修改多个区间，也有可能一个区间都不修改。</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2017.png" /></p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2018.png" /></p>
<p>我们从线段树的模板上来修改。</p>
<h2 id="_13">修改<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p>首先是修改函数。这里我们要实现的功能是添加一条线段，然后修改对应的值。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ql</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">qr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">ql</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">){</span>
<span class="w">        </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">qr</span><span class="o">&gt;</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>这里的代码还是比较简洁的。注意这里应该是拿区间修改的线段树模板来修改（注意最后两行）而不是单点修改的。</p>
<p>解释一下这里的 <span class="arithmatex">\(v\)</span>，这里的 <span class="arithmatex">\(v\)</span> 是插入的线段是编号。我们开一个结构体 <code>line{k,b}</code> 来记录每一条线段的 <span class="arithmatex">\(k,b\)</span>，然后我们使用数组 <code>lne[]</code> 来记录所有线段。</p>
<p>当我们访问到一个区间在要修改的区间 <span class="arithmatex">\([  ql,qr]\)</span> 之内时，我们就需要修改这个区间内的信息了。我们使用  <code>pushup()</code> 函数来修改（实际上叫做 <code>update</code> 更好，但由于是线段树改的，我们姑且叫他 <code>pushup</code>）。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">){</span><span class="c1">//ok</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">bmid</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">mid</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">mid</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bmid</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bmid</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bl</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">l</span><span class="p">));</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">br</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">r</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bl</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bl</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">br</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">br</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="p">);</span><span class="w">  </span>
<span class="p">}</span>
</code></pre></div>
<p>这里的 <code>s[]</code> 数组就相当于线段树中的每个节点，在我的线段树板子里就是 <code>tr[]</code> 数组。我们这颗线段树记录的是“区间最高的线段的编号”，所以 <span class="arithmatex">\(s\)</span> 中记录的信息是线段的编号。那么这里的 <span class="arithmatex">\(x\)</span> 就是线段树上的节点的编号，<code>s[x]</code> 就是原来这个节点上记录的线段的编号。我们要比较这个就线段 <span class="arithmatex">\(v\)</span> 和我们新加入的线段 <span class="arithmatex">\(u\)</span> 的高度关系，并且考虑更新 <code>s[x]</code>。</p>
<p>这里我们需要两个辅助函数。</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">cmp</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">db</span><span class="w"> </span><span class="nf">cal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">1.00</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">b</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">k</span><span class="p">;</span><span class="c1">//计算直线id在x=p处的y</span>
<span class="p">}</span>
</code></pre></div>
<p>第一个是比较大小的。这个不用说了，因为小数运算会出现精度问题。</p>
<p>第二个我来解释一下，其实也没什么，就是我们传入线段的编号和当前的 <span class="arithmatex">\(x\)</span>，计算这条线段在 <span class="arithmatex">\(x=p\)</span> 时的 <span class="arithmatex">\(y\)</span> 值（即高度值）。</p>
<p>我们再回到 <code>pushup</code> 函数 。</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2019.png" /></p>
<p>第一步，我们先计算当 <span class="arithmatex">\(x=mid\)</span> 时两个线段的高度关系。假设线段 <span class="arithmatex">\(u\)</span>（记住在该例子里 <span class="arithmatex">\(u\)</span> 是新加入的线段）在 <span class="arithmatex">\(x =mid\)</span> 时的高度大于 <span class="arithmatex">\(v\)</span> 的，那么我们就把 <span class="arithmatex">\(u,v\)</span> 交换一下，有利于减少讨论情况。注意这里不仅仅是简单交换值，而是把映射关系也交换了。</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2020.png" /></p>
<p>在交换之后，我们就默认 <span class="arithmatex">\(u\)</span> 在 <span class="arithmatex">\(x=mid\)</span> 处比 <span class="arithmatex">\(v\)</span> 低了。那么这时我们来分类讨论一下。我们记录 <span class="arithmatex">\(4\)</span> 个端点的高度值 <span class="arithmatex">\(ul,ur,vl,vr\)</span>。</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2021.png" /></p>
<ul>
<li>
<p>当 <span class="arithmatex">\(vl≥ul\)</span> 且 <span class="arithmatex">\(vr≥ur\)</span> 时，在 <span class="arithmatex">\([l,r]\)</span> 中 <span class="arithmatex">\(u\)</span> 肯定不如 <span class="arithmatex">\(v\)</span>。相反也如此。</p>
</li>
<li>
<p>当 <span class="arithmatex">\(vl&gt;ul\)</span> 但是 <span class="arithmatex">\(vr&lt;ur\)</span> 时，那么说明线段 <span class="arithmatex">\(u,v\)</span> 在 <span class="arithmatex">\([mid,r]\)</span> 区间内肯定有交点。这时区间 <span class="arithmatex">\([l,mid]\)</span> 的答案应该不变（但由于我们不知道 <span class="arithmatex">\(u,v\)</span> 有没有交换过，所以我们还是修改一下。修改也很简单，对应区间修改的线段树，我们把 <span class="arithmatex">\([l,mid]\)</span> 打上 tag），区间 <span class="arithmatex">\([mid,r]\)</span> 我们应该递归下去。（如上图）</p>
</li>
</ul>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2022.png" /></p>
<ul>
<li>当 <span class="arithmatex">\(ul&gt;vl\)</span> 但是 <span class="arithmatex">\(vr&gt;ur\)</span> 时，那么说明线段 <span class="arithmatex">\(u,v\)</span> 在 <span class="arithmatex">\([l,mid]\)</span> 区间内肯定有交点。这时区间 <span class="arithmatex">\([mid,r]\)</span> 的答案应该不变（但由于我们不知道 <span class="arithmatex">\(u,v\)</span> 有没有交换过，所以我们还是修改一下。修改也很简单，对应区间修改的线段树，我们把 <span class="arithmatex">\([mid,r]\)</span> 打上 tag），区间 <span class="arithmatex">\([l,mid]\)</span> 我们应该递归下去。（如上图）</li>
</ul>
<p>注意在讨论时我们要注意到在 <span class="arithmatex">\(x=mid\)</span> 处 <span class="arithmatex">\(v\)</span> 比 <span class="arithmatex">\(u\)</span> 高这个大前提哈。</p>
<p>还有两种特殊情况，即有一个端点重合。那么我们就需要知道 <span class="arithmatex">\(u,v\)</span> 有没有交换过了。我们考察下面的代码。</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bl</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bl</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
</code></pre></div>
<p>我们把 <code>!bl&amp;&amp;u&lt;v</code> 这种情况和 <code>bl==1</code>（即 <span class="arithmatex">\(ul&gt;vl\)</span>）的情况放在一起，因为我们知道新加入的线段的编号一定是大于之前的线段的编号的，所以如果 <span class="arithmatex">\(u&lt;v\)</span>，那么就说明 <span class="arithmatex">\(v\)</span> 是新线段。如下。所以我们应该往左边的区间递归。</p>
<p><img alt="image.png" src="../%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%A9%E5%B1%95%E5%BD%A2%E5%BC%8F%2Be6bba820-32e4-4b67-900b-728465fbe751/image%2023.png" /></p>
<p>另外一种情况类似，请大家自己想一想吧！</p>
<p>那么现在 <span class="arithmatex">\(6\)</span> 种情况我们都讨论过了，请仔细理解鸭。</p>
<h2 id="_14">查询<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>现在我们来看查询的部分。</p>
<div class="highlight"><pre><span></span><code><span class="n">pr</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">&lt;</span><span class="n">l</span><span class="o">||</span><span class="n">q</span><span class="o">&gt;</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">db</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pmax</span><span class="p">({</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]},</span><span class="n">pmax</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">q</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<p>可以发现，这里和普通的线段树还是有一点区别的。这里的返回值是一个 <code>pair&lt;double,int&gt;</code> 分别是在 <span class="arithmatex">\(x=q\)</span> 时的最高的线段的高度和线段的编号。</p>
<p>首先对于无解的情况，即询问的 <span class="arithmatex">\(x\)</span> 在范围之外，我们直接返回最小值 <span class="arithmatex">\(-inf\)</span> 或者 <span class="arithmatex">\(0\)</span>（因为本题求最大值）即可，同时返回 <span class="arithmatex">\(id=0\)</span> 表示不存在这条线段。</p>
<p>然后我们就需要计算当前这个节点对应的线段在 <span class="arithmatex">\(x=q\)</span> 时的高度了，我们记为 <span class="arithmatex">\(res\)</span>。假如 <span class="arithmatex">\(l=r\)</span>，那么说明我们已经找到了叶子节点，直接返回 <span class="arithmatex">\(res\)</span> 即可。但是如果这个点不是叶子节点，我们为什么还需要考虑当前节点的线段呢？直接递归下去不就行了？</p>
<p>注意！这里我们可没有 <code>pushdown</code> 操作！所以也许当前节点存储了新加入的高度更高的线段，但是叶子节点并没有更新！所以我们还需要采纳非叶子节点但也属于区间内的节点信息。当然，既然这个节点 <span class="arithmatex">\([l,r]\)</span> 记录了这个线段，就说明再某个时刻这个区间内的最高点都在这个线段上，也就是说这个线段一定覆盖了这个区间，那么对于 <span class="arithmatex">\(x=q\)</span> 也一定经过了这条线段。但是至于这条线段是否是最终答案我们暂时还不知道。总而言之，<strong>这条线段一定有成为答案的可能。</strong></p>
<p>这里我们还需要引入一个辅助函数 <code>pmax()</code>。</p>
<div class="highlight"><pre><span></span><code><span class="n">pr</span><span class="w"> </span><span class="nf">pmax</span><span class="p">(</span><span class="n">pr</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">pr</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">-1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">ps</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">ps</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>这个函数的功能是传入两个线段 <span class="arithmatex">\(a,b\)</span>（注意这里传入的线段 <span class="arithmatex">\(a,b\)</span> 为 <code>pair&lt;double,int&gt;</code> 类型，即已经计算好了当 <span class="arithmatex">\(x=q\)</span> 时的高度值了，存放在 <code>pair</code> 的 <code>.first</code> 中），我们比较两个线段的 <code>.first</code>（代码中 <code>define</code> 为 <code>pf</code>），返回高的那个即可。请注意回顾 <code>cmp</code> 函数。</p>
<p>当然，题目要求“若有多条线段与查询直线的交点纵坐标都是最大的，则输出编号最小的线段”，所以就有了最后两行。</p>
<h2 id="_15">其他<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>现在线段树部分已经讲完了，我们最后考察加线段的函数（不是在线段树中，而是把线段加入 <code>lne[]</code> 数组中）。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">a</span><span class="p">){</span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">x</span><span class="p">),</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>这里线段的两个端点分别为 <span class="arithmatex">\((x,y)(a,b)\)</span>，注意 <span class="arithmatex">\(x=a\)</span> 的特殊情况。其他就是计算斜率和截距的常规操作了，初中知识即可。</p>
<h2 id="_16">代码<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="cm">/*////////ACACACACACACAC///////////</span>
<span class="cm">       . Coding by Ntsc .</span>
<span class="cm">       . FancyKnowledge .</span>
<span class="cm">       . Prove Yourself .</span>
<span class="cm">/*/</span><span class="c1">///////ACACACACACACAC///////////</span>

<span class="c1">//头文件</span>
<span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="c1">//数据类型</span>
<span class="cp">#define int long long</span>
<span class="cp">#define ull unsigned long long</span>
<span class="cp">#define db double</span>
<span class="cp">#define endl &#39;\n&#39;</span>
<span class="cp">#define pr pair&lt;double,int&gt; </span>
<span class="cp">#define pf first</span>
<span class="cp">#define ps second</span>
<span class="c1">//命名空间</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="c1">//常量</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">4e5</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="o">=</span><span class="mf">1e3</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MOD</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="o">=</span><span class="mf">1e9</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">;</span>
<span class="c1">//变量</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">lans</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">web</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">];</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">line</span><span class="p">{</span>
<span class="w">    </span><span class="n">db</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span><span class="n">lne</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">a</span><span class="p">){</span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="p">);</span><span class="c1">//why max?</span>

<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="n">lne</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">x</span><span class="p">),</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">cmp</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">db</span><span class="w"> </span><span class="nf">cal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">1.00</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">b</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">k</span><span class="p">;</span><span class="c1">//计算直线id在x=p处的y</span>
<span class="p">}</span>

<span class="n">pr</span><span class="w"> </span><span class="nf">pmax</span><span class="p">(</span><span class="n">pr</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">pr</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">-1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">ps</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">ps</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">){</span><span class="c1">//ok</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">bmid</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">mid</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">mid</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bmid</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bmid</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bl</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">l</span><span class="p">));</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">br</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">r</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bl</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bl</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">br</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">br</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>


<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ql</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">qr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span><span class="c1">//ok</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">ql</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">){</span>
<span class="w">        </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">qr</span><span class="o">&gt;</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>


<span class="n">pr</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">){</span><span class="c1">//ok</span>
<span class="c1">//  cerr&lt;&lt;&quot;query l=&quot;&lt;&lt;l&lt;&lt;&quot; r=&quot;&lt;&lt;r&lt;&lt;endl;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">&lt;</span><span class="n">l</span><span class="o">||</span><span class="n">q</span><span class="o">&gt;</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">db</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pmax</span><span class="p">({</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]},</span><span class="n">pmax</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">q</span><span class="p">)));</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">solve</span><span class="p">(){</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">op</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="p">){</span>
<span class="w">            </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="o">&gt;&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="w">            </span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">lans</span><span class="mi">-1</span><span class="o">+</span><span class="mi">39989</span><span class="p">)</span><span class="o">%</span><span class="mi">39989</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">lans</span><span class="mi">-1</span><span class="o">+</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="c1">//注意加上一个MOD</span>
<span class="w">            </span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">lans</span><span class="mi">-1</span><span class="o">+</span><span class="mi">39989</span><span class="p">)</span><span class="o">%</span><span class="mi">39989</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">lans</span><span class="mi">-1</span><span class="o">+</span><span class="n">MOD</span><span class="p">)</span><span class="o">%</span><span class="n">MOD</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">a</span><span class="p">)</span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">),</span><span class="n">swap</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<span class="w">            </span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
<span class="w">            </span><span class="n">change</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">39989</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">k</span><span class="p">;</span>

<span class="c1">//          cerr&lt;&lt;&quot;query k=&quot;&lt;&lt;(k+lans-1+39989)%39989+1&lt;&lt;endl;</span>
<span class="w">            </span><span class="n">lans</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">39989</span><span class="p">,(</span><span class="n">k</span><span class="o">+</span><span class="n">lans</span><span class="mi">-1</span><span class="o">+</span><span class="mi">39989</span><span class="p">)</span><span class="o">%</span><span class="mi">39989</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">ps</span><span class="p">;</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">lans</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//  cin&gt;&gt;T;</span>
<span class="w">    </span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">T</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="n">solve</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>注意这是线段的情况，对于直线，我们把 <code>change(1,1,39989,x,a,cnt);</code> 中的 <span class="arithmatex">\(x,a\)</span> 修改为询问的 <span class="arithmatex">\(x\)</span> 的值域即可。原来的 <span class="arithmatex">\(x,a\)</span> 为线段的两个端点的 <span class="arithmatex">\(x\)</span> 值。</p>
<h2 id="jsoi2008-blue-mary">练习[JSOI2008] Blue Mary 开公司<a class="headerlink" href="#jsoi2008-blue-mary" title="Permanent link">&para;</a></h2>
<p>第一行 ：一个整数 <span class="arithmatex">\(N\)</span>，表示方案和询问的总数。</p>
<p>接下来 <span class="arithmatex">\(N\)</span> 行，每行开头一个单词 <code>Query</code> 或 <code>Project</code>。</p>
<p>若单词为 <code>Query</code>，则后接一个整数 <span class="arithmatex">\(T\)</span>，表示 Blue Mary 询问第 <span class="arithmatex">\(T\)</span> 天的最大收益。</p>
<p>若单词为 <code>Project</code>，则后接两个实数 <span class="arithmatex">\(S, P\)</span>，表示该种设计方案第一天的收益 <span class="arithmatex">\(S\)</span>，以及以后每天比上一天多出的收益 <span class="arithmatex">\(P\)</span>。</p>
<p><strong>分析</strong></p>
<p>本题即不断加入直线 <span class="arithmatex">\(y=S+P\times(x-1)\)</span>，求对于某个 <span class="arithmatex">\(x\)</span> 在所有直线中最高的 <span class="arithmatex">\(y\)</span> 值为？</p>
<p><strong>代码</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">/*////////ACACACACACACAC///////////</span>
<span class="cm">       . Coding by Ntsc .</span>
<span class="cm">       . FancyKnowledge .</span>
<span class="cm">       . Prove Yourself .</span>
<span class="cm">/*/</span><span class="c1">///////ACACACACACACAC///////////</span>

<span class="c1">//头文件</span>
<span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="c1">//数据类型</span>
<span class="cp">#define int long long</span>
<span class="cp">#define ull unsigned long long</span>
<span class="cp">#define db double</span>
<span class="cp">#define endl &#39;\n&#39;</span>
<span class="cp">#define pr pair&lt;double,int&gt; </span>
<span class="cp">#define pf first</span>
<span class="cp">#define ps second</span>
<span class="c1">//命名空间</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="c1">//常量</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">4e5</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="o">=</span><span class="mf">1e3</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MOD</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="o">=</span><span class="mf">1e9</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MT</span><span class="o">=</span><span class="mf">5e4</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">;</span>
<span class="c1">//变量</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">lans</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">web</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">];</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">line</span><span class="p">{</span>
<span class="w">    </span><span class="n">db</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span><span class="n">lne</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="n">db</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<span class="w">    </span><span class="n">lne</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">k</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">lne</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">s</span><span class="o">-</span><span class="n">p</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">cmp</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">db</span><span class="w"> </span><span class="nf">cal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">1.00</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">b</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">k</span><span class="p">;</span><span class="c1">//计算直线id在x=p处的y</span>
<span class="p">}</span>

<span class="n">pr</span><span class="w"> </span><span class="nf">pmax</span><span class="p">(</span><span class="n">pr</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">pr</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">-1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pf</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">pf</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">ps</span><span class="o">&lt;</span><span class="n">b</span><span class="p">.</span><span class="n">ps</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">){</span><span class="c1">//ok</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">bmid</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">mid</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">mid</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bmid</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bmid</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bl</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">l</span><span class="p">));</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">br</span><span class="o">=</span><span class="n">cmp</span><span class="p">(</span><span class="n">cal</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">r</span><span class="p">),</span><span class="n">cal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">bl</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">bl</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">br</span><span class="o">==</span><span class="mi">1</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="n">br</span><span class="o">&amp;&amp;</span><span class="n">u</span><span class="o">&lt;</span><span class="n">v</span><span class="p">))</span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="p">);</span>


<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">ql</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">qr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span><span class="c1">//ok</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">ql</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">){</span>
<span class="w">        </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">qr</span><span class="o">&gt;</span><span class="n">mid</span><span class="p">)</span><span class="n">change</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>


<span class="n">pr</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">){</span><span class="c1">//ok</span>
<span class="c1">//  cerr&lt;&lt;&quot;query l=&quot;&lt;&lt;l&lt;&lt;&quot; r=&quot;&lt;&lt;r&lt;&lt;endl;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="o">&lt;</span><span class="n">l</span><span class="o">||</span><span class="n">q</span><span class="o">&gt;</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">db</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pmax</span><span class="p">({</span><span class="n">res</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]},</span><span class="n">pmax</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">q</span><span class="p">)));</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">solve</span><span class="p">(){</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="w">        </span><span class="n">db</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="n">P</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">s</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="s">&quot;Project&quot;</span><span class="p">){</span>
<span class="w">            </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">S</span><span class="o">&gt;&gt;</span><span class="n">P</span><span class="p">;</span>

<span class="w">            </span><span class="n">add</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">P</span><span class="p">);</span>
<span class="w">            </span><span class="n">change</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MT</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MT</span><span class="p">,</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">T</span><span class="p">;</span>
<span class="w">            </span><span class="n">lans</span><span class="o">=</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MT</span><span class="p">,</span><span class="n">T</span><span class="p">).</span><span class="n">pf</span><span class="p">;</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">lans</span><span class="o">/</span><span class="mi">100</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<span class="w">    </span><span class="n">solve</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h1 id="1">可持久化线段树（数组）→模板1<a class="headerlink" href="#1" title="Permanent link">&para;</a></h1>
<p>如题，你需要维护这样的一个长度为 <span class="arithmatex">\(N\)</span> 的数组，支持如下几种操作</p>
<ol>
<li>
<p>对于操作1，格式为<span class="arithmatex">\(v_i \ 1 \ {loc}_i \ {value}_i\)</span>，即为在版本<span class="arithmatex">\(v_i\)</span>的基础上，将 <span class="arithmatex">\(a_{{loc}_i}\)</span> 修改为 <span class="arithmatex">\({value}_i\)</span>。</p>
</li>
<li>
<p>对于操作2，格式为<span class="arithmatex">\(v_i \ 2 \ {loc}_i\)</span>，即访问版本<span class="arithmatex">\(v_i\)</span>中的 <span class="arithmatex">\(a_{{loc}_i}\)</span>的值，注意：<strong>生成一样版本的对象应为 <span class="arithmatex">\(v_i\)</span></strong>。</p>
</li>
</ol>
<p>此外，每进行一次操作（<strong>对于操作2，即为生成一个完全一样的版本，不作任何改动</strong>），就会生成一个新的版本。版本编号即为当前操作的编号（从1开始编号，版本0表示初始状态数组）</p>
<h2 id="_17">代码<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h2>
<p>还是很简单的。</p>
<div class="highlight"><pre><span></span><code><span class="cm">/*////////ACACACACACACAC///////////</span>
<span class="cm">       . Coding by Ntsc .</span>
<span class="cm">       . FancyKnowledge .</span>
<span class="cm">       . Prove Yourself .</span>
<span class="cm">/*/</span><span class="c1">///////ACACACACACACAC///////////</span>

<span class="c1">//</span>
<span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="c1">//</span>
<span class="cp">#define int long long</span>
<span class="cp">#define ull unsigned long long</span>
<span class="cp">#define db double</span>
<span class="cp">#define endl &#39;\n&#39;</span>
<span class="cp">#define err(fmt, ...) fprintf(stderr, &quot;[%d] : &quot; fmt &quot;\n&quot;, __LINE__, ##__VA_ARGS__)</span>
<span class="c1">///*</span>
<span class="cp">#define pr pair&lt;double,int&gt;</span>
<span class="cp">#define pf first</span>
<span class="cp">#define ps second</span>
<span class="cp">#define pb push_back</span>
<span class="c1">//*/</span>

<span class="c1">//</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="c1">//</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">1e6</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="o">=</span><span class="mf">1e3</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">MOD</span><span class="o">=</span><span class="mf">1e9</span><span class="o">+</span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MMOD</span><span class="o">=</span><span class="mi">903250223</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="o">=</span><span class="mf">1e9</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">IINF</span><span class="o">=</span><span class="mf">1e18</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">;</span>
<span class="c1">//</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">b</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">sw</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ans</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">mul</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="kt">int</span><span class="w">  </span><span class="n">rt</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">vcnt</span><span class="p">;</span><span class="c1">//版本计数</span>
<span class="kt">int</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lc</span><span class="p">,</span><span class="n">rc</span><span class="p">,</span><span class="n">v</span><span class="p">;</span>
<span class="p">}</span><span class="n">tr</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">];</span><span class="c1">//16倍空间</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<span class="w">    </span><span class="c1">//</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">x</span><span class="o">=++</span><span class="n">cnt</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">now</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="n">now</span><span class="o">=++</span><span class="n">cnt</span><span class="p">;</span><span class="c1">//建立新节点</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="c1">//  tr[now]=tr[pre];</span>
<span class="c1">//  tr[now].v=tr[pre].v;//更新,因为如下</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">){</span>
<span class="w">        </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">;</span><span class="c1">//也可以在一开始复制旧的点的信息</span>
<span class="w">        </span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">lc</span><span class="o">=</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">lc</span><span class="p">;</span>
<span class="w">        </span><span class="n">insert</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">pre</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">tr</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="c1">//  pushup(now);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">lc</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">rc</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>

<span class="c1">//  freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span>
<span class="c1">//  freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span>
<span class="c1">//  freopen(&quot;.txt&quot;,&quot;w&quot;,stderr);</span>

<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="c1">//      cin&gt;&gt;a[i];</span>
<span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="n">loc</span><span class="p">,</span><span class="n">val</span><span class="p">;</span>
<span class="c1">//      cin&gt;&gt;v&gt;&gt;op&gt;&gt;loc;</span>
<span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld%lld%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v</span><span class="p">,</span><span class="o">&amp;</span><span class="n">op</span><span class="p">,</span><span class="o">&amp;</span><span class="n">loc</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
<span class="w">            </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
<span class="w">            </span><span class="n">insert</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="o">++</span><span class="n">vcnt</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">loc</span><span class="p">,</span><span class="n">val</span><span class="p">);</span>
<span class="c1">//          cerr&lt;&lt;&quot;rt&quot;&lt;&lt;vcnt&lt;&lt;&quot;]=&quot;&lt;&lt;tr[rt[vcnt]].rc&lt;&lt;endl;</span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">query</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">loc</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">rt</span><span class="p">[</span><span class="o">++</span><span class="n">vcnt</span><span class="p">]</span><span class="o">=</span><span class="n">rt</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//check your long long and the size of memery!!!</span>
</code></pre></div>
<h2 id="k">树上版可持久化线段树求k小（树上主席树）<a class="headerlink" href="#k" title="Permanent link">&para;</a></h2>
<p><a href="https://www.luogu.com.cn/problem/P2633">www.luogu.com.cn</a></p>
<p><strong>模型</strong></p>
<p>求树上从x-y路径上的地k小值</p>
<p><strong>做法</strong></p>
<p>我们考虑进行树上差分。我们对每一个节点x维护一个权值线段树t_x，代表着从x到根节点的路径上的数值发布情况。</p>
<p>对于树的构建，我们这样：在x的父亲的版本基础上加入x，就形成了x版本的线段树。</p>
<p>对于查询，我们工具树上差分得出代表链x-y的树应该是<span class="arithmatex">\(t_x+t_y-t_{lca}-t_{fa(lca)}\)</span>，于是我们4个指针分别指向即可。</p>
<p>时刻记住，主席树的功能是让你快速求出特定区间内某值域范围的数字个数，方便二分，而不是直接记录答案！</p>
<h1 id="_18">吉司机线段树<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h1>
<p>详解</p>
<p><a href="https://www.luogu.com.cn/blog/Sqrtree/solution-p6242">www.luogu.com.cn</a></p>
<p>多个例题</p>
<p><a href="https://www.luogu.com.cn/blog/trsins/post-xue-xi-bi-ji-segment-tree-beats-ji-si-ji-xian-duan-shu">www.luogu.com.cn</a></p>
<p>题型：区间最值笼统地指求区间的最值以及区间所有数对 x 取最值（即令 <span class="arithmatex">\(a_i​=\max/\min(a_i​,x)\)</span>）这一类的查询与修改操作。</p>
<h2 id="hdu5306-gorgeous-sequence">HDU5306 Gorgeous Sequence<a class="headerlink" href="#hdu5306-gorgeous-sequence" title="Permanent link">&para;</a></h2>
<p>维护一个序列 a： </p>
<ul>
<li>
<p>0 l r t <span class="arithmatex">\(\forall l\le i\le r,\ a_i=\min(a_i,t)\)</span>。</p>
</li>
<li>
<p>1 l r 输出区间 [l,r] 中的最大值。 </p>
</li>
<li>
<p>2 l r 输出区间和。 </p>
</li>
<li>
<p>多组数据，<span class="arithmatex">\(T\le 100,n\le 10^6,\sum m\le 10^6\)</span>。 </p>
</li>
</ul>
<blockquote>
<p>引用自 OI wiki</p>
</blockquote>
<p>区间取 min，意味着只对那些大于 t 的数有更改。因此这个操作的对象不再是整个区间，而是「这个区间中大于 t 的数」。于是我们可以有这样的思路：</p>
<p>每个结点维护该区间的最大值 Mx1、次大值 Mx2、区间和 Sum 以及最大值的个数 Cnt。接下来我们考虑区间对 t 取 \min 的操作。 如果 <span class="arithmatex">\(Mx1\le t\)</span>，显然这个 t 是没有意义的，直接返回； 如果 <span class="arithmatex">\(Mx2&lt;t\le Mx1\)</span>，那么这个 t 就能更新当前区间中的最大值。于是我们让区间和加上 Cnt(t-Mx1)，然后更新 Mx1 为 t，并打一个标记。 如果 <span class="arithmatex">\(t\le Mx2\)</span>，那么这时你发现你不知道有多少个数涉及到更新的问题。于是我们的策略就是，暴力递归向下操作。然后上传信息。</p>
<h2 id="3">线段树 3<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>给出一个长度为 <span class="arithmatex">\(n\)</span> 的数列 <span class="arithmatex">\(A\)</span>，同时定义一个辅助数组 <span class="arithmatex">\(B\)</span>，<span class="arithmatex">\(B\)</span> 开始与 <span class="arithmatex">\(A\)</span> 完全相同。接下来进行了 <span class="arithmatex">\(m\)</span> 次操作，操作有五种类型，按以下格式给出：</p>
<ul>
<li>
<p><code>1 l r k</code>：对于所有的 <span class="arithmatex">\(i\in[l,r]\)</span>，将 <span class="arithmatex">\(A_i\)</span> 加上 <span class="arithmatex">\(k\)</span>（<span class="arithmatex">\(k\)</span> 可以为负数）。</p>
</li>
<li>
<p><code>2 l r v</code>：对于所有的 <span class="arithmatex">\(i\in[l,r]\)</span>，将 <span class="arithmatex">\(A_i\)</span> 变成 <span class="arithmatex">\(\min(A_i,v)\)</span>。</p>
</li>
<li>
<p><code>3 l r</code>：求 <span class="arithmatex">\(\sum_{i=l}^{r}A_i\)</span>。</p>
</li>
<li>
<p><code>4 l r</code>：对于所有的 <span class="arithmatex">\(i\in[l,r]\)</span>，求 <span class="arithmatex">\(A_i\)</span> 的最大值。</p>
</li>
<li>
<p><code>5 l r</code>：对于所有的 <span class="arithmatex">\(i\in[l,r]\)</span>，求 <span class="arithmatex">\(B_i\)</span> 的最大值。</p>
</li>
</ul>
<p>在每一次操作后，我们都进行一次更新，让 <span class="arithmatex">\(B_i\gets\max(B_i,A_i)\)</span>。</p>
<ul>
<li>对于全部测试数据，保证 <span class="arithmatex">\(1\leq n,m\leq 5\times 10^5\)</span>，<span class="arithmatex">\(-5\times10^8\leq A_i\leq 5\times10^8\)</span>，<span class="arithmatex">\(op\in[1,5]\)</span>，<span class="arithmatex">\(1 \leq l\leq r \leq n\)</span>，<span class="arithmatex">\(-2000\leq k\leq 2000\)</span>，<span class="arithmatex">\(-5\times10^8\leq v\leq 5\times10^8\)</span>。</li>
</ul>
<h4 id="_19">提示<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>本题输入量较大，请使用合理高效的读入方法。</p>
<h2 id="_20">代码分析<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<p><strong>数据</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mx1a</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">mx2a</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">mx1b</span><span class="p">;</span><span class="c1">//a的最大值，a的最大值的个数，a的次大值，区间和，b的最大值</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tg1</span><span class="p">,</span><span class="n">tg2</span><span class="p">,</span><span class="n">tg3</span><span class="p">,</span><span class="n">tg4</span><span class="p">;</span><span class="c1">//4个tag分别是对应mx1a,mx2a,tg1的max,t2的max</span>
<span class="p">}</span><span class="n">t</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">];</span>
</code></pre></div>
<p><strong>难点：tag对值的更新</strong></p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">tagModify</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t2</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t3</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t4</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">+=</span><span class="n">t1</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">+</span><span class="n">t2</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+</span><span class="n">t3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+=</span><span class="n">t1</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">!=-</span><span class="n">INF</span><span class="p">)</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">+=</span><span class="n">t2</span><span class="p">;</span>


<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+</span><span class="n">t3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+</span><span class="n">t4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+=</span><span class="n">t1</span><span class="p">;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+=</span><span class="n">t2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>难点：两种操作</strong></p>
<ul>
<li>区间加操作</li>
</ul>
<p>线段树框架就省略了，我们只看当找到了要修改的节点时对节点的修改</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">tagAdd</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">+=</span><span class="n">v</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">!=-</span><span class="n">INF</span><span class="p">)</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>

<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>区间min修改操作</li>
</ul>
<p>注意因为吉司机的特殊性，所以我们需要多一些约束条件。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">changeMin</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="o">||</span><span class="n">v</span><span class="o">&gt;=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">;</span><span class="c1">//注意多了条件！！！</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="o">&amp;&amp;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">&lt;</span><span class="n">v</span><span class="p">){</span><span class="c1">//注意多了条件！！！</span>
<span class="w">        </span><span class="n">tagMin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">changeMin</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">changeMin</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>难度：pushdown标记下传操作</strong></p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mx</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">==</span><span class="n">mx</span><span class="p">)</span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">==</span><span class="n">mx</span><span class="p">)</span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//清空tag</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="code-ac">Code <code>AC</code><a class="headerlink" href="#code-ac" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">CB Ntsc</span>
<span class="cm">*/</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="cp">#define int long long</span>
<span class="cp">#define mp make_pair</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">INF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9999973</span><span class="p">;</span>


<span class="cp">#define rd read()</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">read</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ff</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">out</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
<span class="w">        </span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">putchar</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">f1</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">f2</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mx1a</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">mx2a</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">mx1b</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tg1</span><span class="p">,</span><span class="n">tg2</span><span class="p">,</span><span class="n">tg3</span><span class="p">,</span><span class="n">tg4</span><span class="p">;</span><span class="c1">//4个tag分别是对应mx1a,mx2a</span>
<span class="p">}</span><span class="n">t</span><span class="p">[</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">];</span>


<span class="c1">//标记传递</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pushup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<span class="w">    </span><span class="c1">//维护最大值，区间和</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="o">+</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1b</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1b</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//维护次大值及最大值的个数</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">==</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">){</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">cnt</span><span class="o">+</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">cnt</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx2a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx2a</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">&gt;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">){</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">cnt</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx2a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">cnt</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx2a</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">tagModify</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t2</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t3</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">t4</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">+=</span><span class="n">t1</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">+</span><span class="n">t2</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+</span><span class="n">t3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+=</span><span class="n">t1</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">!=-</span><span class="n">INF</span><span class="p">)</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">+=</span><span class="n">t2</span><span class="p">;</span>


<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+</span><span class="n">t3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+</span><span class="n">t4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+=</span><span class="n">t1</span><span class="p">;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+=</span><span class="n">t2</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">pushdown</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mx</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">==</span><span class="n">mx</span><span class="p">)</span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">].</span><span class="n">mx1a</span><span class="o">==</span><span class="n">mx</span><span class="p">)</span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">tagModify</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//清空tag</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//初始化</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">=-</span><span class="n">INF</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>

<span class="w">    </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

<span class="p">}</span>

<span class="c1">//修改部分</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">tagAdd</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">+=</span><span class="n">v</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">!=-</span><span class="n">INF</span><span class="p">)</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>

<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="o">+=</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg3</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg2</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg4</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">changeAdd</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="p">){</span>
<span class="w">        </span><span class="n">tagAdd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">changeAdd</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">changeAdd</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">tagMin</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">-</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="o">-=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">cnt</span><span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="o">=</span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tg1</span><span class="o">-=</span><span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">changeMin</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="o">||</span><span class="n">v</span><span class="o">&gt;=</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="p">;</span><span class="c1">//注意多了条件！！！</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="o">&amp;&amp;</span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx2a</span><span class="o">&lt;</span><span class="n">v</span><span class="p">){</span><span class="c1">//注意多了条件！！！</span>
<span class="w">        </span><span class="n">tagMin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">changeMin</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">changeMin</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">pushup</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//查询部分</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">querySum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">querySum</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">)</span><span class="o">+</span><span class="n">querySum</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">queryMaxA</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">INF</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1a</span><span class="p">;</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">queryMaxA</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">),</span><span class="n">queryMaxA</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">int</span><span class="w"> </span><span class="nf">queryMaxB</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pl</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">pr</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pl</span><span class="o">&gt;</span><span class="n">r</span><span class="o">||</span><span class="n">pr</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">INF</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;=</span><span class="n">pl</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">pr</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">mx1b</span><span class="p">;</span>
<span class="w">    </span><span class="n">pushdown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">queryMaxB</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">),</span><span class="n">queryMaxB</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pl</span><span class="p">,</span><span class="n">pr</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// void updateB(int x,int l,int r){</span>
<span class="c1">//     if(l==r){</span>
<span class="c1">//         tb[x].v=max(tb[x].v,ta[x].v);</span>
<span class="c1">//         return ;</span>
<span class="c1">//     }</span>

<span class="c1">//     int mid=(l+r)&gt;&gt;1;</span>
<span class="c1">//     updateB(x&lt;&lt;1,l,mid);</span>
<span class="c1">//     updateB(x&lt;&lt;1|1,mid+1,r);</span>
<span class="c1">//     tb[x].mx=max(tb[x&lt;&lt;1].mx,tb[x&lt;&lt;1|1].mx);</span>
<span class="c1">// }</span>


<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// freopen(&quot;P6242_1.in&quot;, &quot;r&quot;, stdin);</span>
<span class="w">    </span><span class="c1">// freopen(&quot;chfran.out&quot;, &quot;w&quot;, stdout);</span>
<span class="w">    </span><span class="c1">// cerr&lt;&lt;1.00*(&amp;f2-&amp;f1)/1024/1024&lt;&lt;endl;</span>
<span class="w">    </span><span class="n">n</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span><span class="n">m</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>

<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// int c=0;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// cerr&lt;&lt;&quot;id=&quot;&lt;&lt;++c&lt;&lt;&#39; &#39;;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">op</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">            </span><span class="n">changeAdd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="n">rd</span><span class="p">;</span>
<span class="w">            </span><span class="n">changeMin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">3</span><span class="p">){</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">querySum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

<span class="w">        </span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">4</span><span class="p">){</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">queryMaxA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="mi">5</span><span class="p">){</span>
<span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">queryMaxB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">1</span>
<span class="cm">2 5 1 </span>
<span class="cm">0 0 1 </span>
<span class="cm">0 0 4 </span>

<span class="cm">*/</span>
</code></pre></div>
<h1 id="_21">二维信息维护<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h1>
<h2 id="_22">二维线段树<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h2>
<p>这是一个维护多维度学习的数据结构。如果没有轻质在线的要求，那么我们可以使用CDQ分治来代替。或者外面也可以使用K-D树来维护。</p>
<p>二维线段树——我们在主线段树的每一个节点上都建立一个子线段树。我们考虑下面的问题</p>
<p>给定一个 n×m 的矩阵，初始时元素均为 0，你需要维护一下操作：</p>
<div class="highlight"><pre><span></span><code>1. `1 x y k`，将矩阵中 (x,y) 位置的元素加上 k。

2. `2 x1 y1 x2 y2`，查询左上角为 (x1,y1)，右下角为 (x2,y2) 的矩阵中的元素和。
</code></pre></div>
<p>那么如果使用二维线段树——第一维维护行，第二维维护列，对于修改操作，我们找到对应行的节点，然后在其子线段树上找到对应列即可。对应查询，我们挑选出可以拼凑出询问行的节点，然后在这些节点中分别查询对应列的和信息。时间复杂度<span class="arithmatex">\(O(n\log^2 n)\)</span></p>
<p>如果是区间修改，我们则需要维护些许tag了。在主线段树中每次下传标记时，都要对某个子线段树进行修改。这种修改会修改子线段树中的所有点，因此时间复杂度最差为<span class="arithmatex">\(O(n\log n)\)</span>无法接受。所以我们考虑**标记永久化**。</p>
<p>大概来说，就是标记不下传，不删除。我们在查询时，遇到了一个标记就直接修改<span class="arithmatex">\(res\)</span>的值。但是标记永久化会有很多限制，局限性很大，不推荐使用。</p>
<h2 id="_23">二维树状数组<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h2>
<p>树状数组本是用来单点修改，区间求和的。这里我们让它支持区间修改，区间查询。</p>
<ul>
<li>
<p><code>L a b c d delta</code> —— 代表将 <span class="arithmatex">\((a,b),(c,d)\)</span> 为顶点的矩形区域内的所有数字加上 <span class="arithmatex">\(delta\)</span>。</p>
</li>
<li>
<p><code>k a b c d</code>     —— 代表求 <span class="arithmatex">\((a,b),(c,d)\)</span> 为顶点的矩形区域内所有数字的和。</p>
</li>
</ul>
<h3 id="_24">一维树状数组的区间修改&amp;区间查询<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>首先我们考虑树状数组怎样实现一维的区间修改和区间查询。对应一维的区间修改，因为树状数组本身只支持单点修改但是会自动维护前缀和，所以我们的区间修改就使用差分的形式。</p>
<p>如果我们要把[l,r]都+k，那么我们修改树状数组c_l加上k,c_{r+1}减去k。此时树状数组上正是原数组。</p>
<p>那么现在如果我们要求[l,r]之和，那么我们可以把<span class="arithmatex">\(query(l)\sim query(r)\)</span>都加起来。</p>
<p>位置p的值<span class="arithmatex">\(=\sum_{j = 1}^{p} c[j]\)</span></p>
<p>位置p的前缀和 $\sum_{i = 1}^{p} a[i] = \sum_{i = 1}^{p} \sum_{j = 1}^{i} c[j] $</p>
<p>在等式最右侧的式子<span class="arithmatex">\((\sum_{i = 1}^{p} \sum_{j = 1}^{i} c[j])\)</span>中，(<span class="arithmatex">\(c[1]\)</span>) 被用了(<span class="arithmatex">\(p\)</span>)次，(<span class="arithmatex">\(c[2]\)</span>)被用了(p - 1)次……那么我们可以写出：</p>
<p>位置p的前缀和 =</p>
<p>$\sum_{i = 1}^{p} \sum_{j = 1}^{i} d[j] = \sum_{i = 1}^{p} d[i] * (p - i + 1) = (p + 1) \times \sum_{i = 1}^{p}c[i] - \sum_{i = 1}^{p}c[i]\times i $</p>
<p>那么我们可以维护两个数组的前缀和：
一个数组是 (<span class="arithmatex">\(sum1[i] = c[i]\)</span>)，
另一个数组是 (<span class="arithmatex">\(sum2[i] = c[i] \times i\)</span>)。</p>
<p><strong>查询</strong></p>
<p>位置p的前缀和即： (p + 1) * sum1数组中p的前缀和 - sum2数组中p的前缀和。</p>
<p>区间[l, r]的和即：位置r的前缀和 - 位置l的前缀和。</p>
<p><strong>修改</strong></p>
<p>对于sum1数组的修改同问题2中对d数组的修改。</p>
<p>对于sum2数组的修改也类似，我们给 sum2[l] 加上 l * x，给 sum2[r + 1] 减去 (r + 1) * x。</p>
<h3 id="_25">扩展到二维情况<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>在一维树状数组中，我们用<code>c[x]</code>记录右端点为x，长度为<code>lowbit(x)</code>的区间的区间和。我们同样可以类似地定义<code>c[x][y]</code>为右下端点为<span class="arithmatex">\((x,y)\)</span>，高为<code>lowbit(x)</code>，宽为<code>lowbit(y)</code>的区间的区间和。</p>
<p><strong>区间修改</strong></p>
<p>我们回忆一下我们是如何对一维树状数组进行区间修改的。我们对其进行差分操作，是为了使得到的差分数组前缀和就等于对应位置元素的值。那么我们可以运用类比思想，设计一个二维的差分呢？</p>
<p>我们来看一下二维的前缀和。</p>
<p><span class="arithmatex">\(sum[i][j]=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+a[i][j]\)</span></p>
<p>查询左上角点<span class="arithmatex">\((x1,y1)\)</span>，右下角点<span class="arithmatex">\((x2,y2)\)</span>的区间和则是：<span class="arithmatex">\(sum[x2][y2]-sum[x1-1][y2]-sum[x2][y1-1]+sum[x1-1][y1-1]\)</span></p>
<p>那么我们可以使差分数组<span class="arithmatex">\(d[i][j]\)</span>等于<span class="arithmatex">\(a[i][j]\)</span>和<span class="arithmatex">\(a[i-1][j]+a[i][j-1]-a[i-1][j-1]\)</span>的差。</p>
<p>这些都是差分基本操作了。</p>
<p><strong>区间查询</strong></p>
<p>根据差分数组的定义，我们不难发现，对于点(x,y)，它的二维前缀和就是:</p>
<p><span class="arithmatex">\(\sum_{i=1}^x\sum_{j=1}^y\sum_{h=1}^i\sum_{k=1}^j d[h][k]\)</span></p>
<p>但我们类比一下一维树状数组的区间求和，我们亦可以统计每个<span class="arithmatex">\(d[h][k]\)</span>出现的次数，我们就可以发现<span class="arithmatex">\(d[1][1]\)</span>出现了<span class="arithmatex">\((x\times y)\)</span>次，<span class="arithmatex">\(d[1][2]\)</span>出现了<span class="arithmatex">\(x\times(y-1)\)</span>次……<span class="arithmatex">\(d[h][k]\)</span>出现了<span class="arithmatex">\((x-h+1)\times (y-k+1)\)</span>次。</p>
<p>则原式整理得：</p>
<p><span class="arithmatex">\(\sum_{i=1}^x\sum_{j=1}^y d[i][j]\times (x-i+1)\times (y-j+1)\)</span></p>
<p>分解得：</p>
<p><span class="arithmatex">\(\sum_{i=1}^x\sum_{j=1}^y d[i][j]\times [(xy-xj+x)+(-yi+ij-i)+(y-j+1)]\)</span></p>
<p>最后得：</p>
<p><span class="arithmatex">\(\sum_{i=1}^x\sum_{j=1}^y d[i][j]\times (xy+x+y+1)-d[i][j]\times i(y+1)-d[i][j]\times j(x+1)+d[i][j]\times i\times j\)</span></p>
<p>根据我们最后分解出来的公式，我们需要维护四个数组<span class="arithmatex">\(d[i][j],d[i][j]\times i,d[i][j]\times j,d[i][j]\times ij\)</span>，从而实现区间查询。</p>
<p><a href="https://flowus.cn/e2ee7577-b0cf-49bc-91f2-0f497a91e5c4">学习笔记 | 二维线段树&amp;树状数组</a></p>
<h1 id="k_1">带修主席树（带修改的区间k大值）<a class="headerlink" href="#k_1" title="Permanent link">&para;</a></h1>
<p>Dynamic Rankings</p>
<h2 id="_26">题目描述<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h2>
<p>给定一个含有 <span class="arithmatex">\(n\)</span> 个数的序列 <span class="arithmatex">\(a_1,a_2 \dots a_n\)</span>，需要支持两种操作：</p>
<ul>
<li>
<p><code>Q l r k</code> 表示查询下标在区间 <span class="arithmatex">\([l,r]\)</span> 中的第 <span class="arithmatex">\(k\)</span> 小的数</p>
</li>
<li>
<p><code>C x y</code> 表示将 <span class="arithmatex">\(a_x\)</span> 改为 <span class="arithmatex">\(y\)</span></p>
</li>
</ul>
<p>对于 <span class="arithmatex">\(10\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m \le 100\)</span>；
对于 <span class="arithmatex">\(20\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m \le 1000\)</span>；
对于 <span class="arithmatex">\(50\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m \le 10^4\)</span>；
对于 <span class="arithmatex">\(100\%\)</span> 的数据，<span class="arithmatex">\(1\le n,m \le 10^5\)</span>，<span class="arithmatex">\(1 \le l \le r \le n\)</span>，<span class="arithmatex">\(1 \le k \le r-l+1\)</span>，<span class="arithmatex">\(1\le x \le n\)</span>，<span class="arithmatex">\(0 \le a_i,y \le 10^9\)</span>。</p>
<p>请注意常数优化，但写法正常的整体二分和树套树都可以以大约 <span class="arithmatex">\(1000\text{ms}\)</span> 每个点的时间通过。</p>
<h2 id="_27">树状数组/线段树套线段树<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<p>我们发现，主席树（或者说主席树在求区间k大值时）是满足前缀和性质的，即为了求出[l,r]中在某个值域内的数字的个数，我们用r版本的线段树信息减去l-1版本的线段树信息得到的。</p>
<p>现在考虑修改，若我们要修改位置x上的值，那么我们暴力的写法是要修改在[x,r]上的所有点。实际上就是修改一整个后缀。</p>
<p>这就像极了暴力修改区间每一个数字。于是为了优化这个流程，首先我们认识到原来的主席树的rt[]是线性结构，为了快捷的区间修改，我们相比应该使用树状结构。所以我们把rt[]构建为一颗线段树/树状数组，即我们把rt[]中的每一个位置放到线段树/树状数组上去。</p>
<p>那么现在根据rt[]的数据结构的改变，rt[]记录的信息也要做出改变。以树状数组为例：</p>
<ul>
<li>
<p>rt_2记录的是加入了[1,2]的数字的权值线段树</p>
</li>
<li>
<p>rt_3记录的是加入了[3,3]的数字的权值线段树</p>
</li>
<li>
<p>rt_4记录的是加入了[1,4]的数字的权值线段树</p>
</li>
<li>
<p>rt_5记录的是加入了[5,5]的数字的权值线段树</p>
</li>
<li>
<p>...</p>
</li>
</ul>
<p>现在，我们要在位置x上做修改，前面也说了其实就是修改后缀。倒过来，其实就是修改前缀。那么修改前缀简单啊！不就是树状数组嘛！所以要在位置x上做修改，我们就在树状数组上修改\log级别的rt[]即可，也就是说我们只需要修改\log棵线段树的信息了。时间复杂度减少为O(n\log^2 n)</p>
<p>查询时，依旧是R位置减去L-1位置，这时候不再是两棵线段树作差，而是log棵线段树与log棵线段树作差；跳的时候，log个节点一起跳到左子树/右子树</p>
<h2 id="_28">模板<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">CB Ntsc111</span>
<span class="cm">*/</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="cp">#define ull unsigned int</span>
<span class="cp">#define pii pair&lt;int, int&gt;</span>
<span class="cp">#define pf to</span>
<span class="cp">#define ps second</span>
<span class="cp">#define int long long</span>

<span class="cp">#define err cerr &lt;&lt; &quot;Error&quot;</span>
<span class="cp">#define rd read()</span>

<span class="cp">#define ot write</span>
<span class="cp">#define nl putchar(&#39;\n&#39;)</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">read</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="n">ff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ff</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">out</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
<span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">  </span><span class="n">putchar</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10005</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">segment_tree</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ls</span><span class="p">,</span><span class="w"> </span><span class="n">rs</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">400</span><span class="p">];</span><span class="w"> </span><span class="c1">// 线段树开n log n大小</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">operation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w"> </span><span class="c1">// 离线</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">o</span><span class="p">[</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">rt</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">tot</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">20</span><span class="p">],</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">char</span><span class="w"> </span><span class="n">opt</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">now</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">now</span><span class="p">)</span>
<span class="w">    </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">tot</span><span class="p">;</span>
<span class="w">  </span><span class="n">t</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">v</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span><span class="p">)</span>
<span class="w">    </span><span class="n">change</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">ls</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">change</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">now</span><span class="p">].</span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Modify</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower_bound</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
<span class="w">    </span><span class="n">change</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span><span class="w"> </span><span class="c1">// 处理出需要修改哪log棵主席树</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">ls</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">ls</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">ls</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">ls</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">rs</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]].</span><span class="n">rs</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">temp</span><span class="p">));</span>
<span class="w">  </span><span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
<span class="w">    </span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
<span class="w">    </span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">[</span><span class="o">++</span><span class="n">len</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">opt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;Q&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">)</span>
<span class="w">      </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rd</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">[</span><span class="o">++</span><span class="n">len</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">sort</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">Modify</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">)</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">[</span><span class="n">Query</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">)]);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">Modify</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="w">      </span><span class="n">a</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">;</span>
<span class="w">      </span><span class="n">Modify</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>